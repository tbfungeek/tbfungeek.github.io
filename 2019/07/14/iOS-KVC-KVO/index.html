
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>iOS KVC KVO 总结 | Edgar&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Edgar">
    

    
    <meta name="description" content="KVC  —  Key Value Coding  键值编码KVC 是一种不用通过调用 setter、getter 方法而是直接通过属性字符串名称key来存取属性的机制。 KVC 和 属性访问器的对比如下：  KVC是通过在运行时动态的访问和修改对象的属性而访问器是在编译时确定，单就这一点增加了访问属性的灵活性，但是用访问器访问属性的时候编译器会做预编译处理，访问不存在的属性编译器会报错，使用KV">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS KVC KVO 总结">
<meta property="og:url" content="http://yoursite.com/2019/07/14/iOS-KVC-KVO/index.html">
<meta property="og:site_name" content="Edgar&#39;s Blog">
<meta property="og:description" content="KVC  —  Key Value Coding  键值编码KVC 是一种不用通过调用 setter、getter 方法而是直接通过属性字符串名称key来存取属性的机制。 KVC 和 属性访问器的对比如下：  KVC是通过在运行时动态的访问和修改对象的属性而访问器是在编译时确定，单就这一点增加了访问属性的灵活性，但是用访问器访问属性的时候编译器会做预编译处理，访问不存在的属性编译器会报错，使用KV">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/2019/07/14/iOS-KVC-KVO/00001.png">
<meta property="article:published_time" content="2019-07-14T01:44:24.000Z">
<meta property="article:modified_time" content="2020-02-11T02:46:43.000Z">
<meta property="article:author" content="Edgar">
<meta property="article:tag" content="Objective C 相关">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2019/07/14/iOS-KVC-KVO/00001.png">

    
    <link rel="alternative" href="atom.xml" title="Edgar&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/unnamed4_n_mSY_icon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Edgar&#39;s Blog">Edgar&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/07/14/iOS-KVC-KVO/" title="iOS KVC KVO 总结" itemprop="url">iOS KVC KVO 总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2019-07-14T01:44:24.000Z" itemprop="datePublished"> Published 2019-07-14</time>
    
  </p>
</header>
	<div class="article-content">
		
		<h5 id="KVC-—-Key-Value-Coding-键值编码"><a href="#KVC-—-Key-Value-Coding-键值编码" class="headerlink" title="KVC  —  Key Value Coding  键值编码"></a>KVC  —  Key Value Coding  键值编码</h5><p>KVC 是一种不用通过调用 setter、getter 方法而是直接通过属性字符串名称key来存取属性的机制。</p>
<p>KVC 和 属性访问器的对比如下：</p>
<ul>
<li><p>KVC是通过在运行时动态的访问和修改对象的属性而访问器是在编译时确定，单就这一点增加了访问属性的灵活性，<br>但是用访问器访问属性的时候编译器会做预编译处理，访问不存在的属性编译器会报错，使用KVC方式的时候如果有错误只能在运行的时候才能发现。</p>
</li>
<li><p>相比访问器KVC 效率会低一点。</p>
</li>
<li><p>KVC 可以访问对象的私有属性，修改只读属性</p>
</li>
<li><p>KVC 在字典转模型，集合类操作方面有着普通访问器不能提供的功能</p>
</li>
</ul>
<p>总而言之 KVC的特点是在运行时访问，可以访问对象私有属性和修改只读属性，在字典转模型，集合类操作方面十分便捷。</p>
<p>首先先列下关键的一些方法,后续都会对这些方法进行介绍：</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过KeyPath来取值</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="type">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过KeyPath来设值</span></span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="keyword">nullable</span> <span class="type">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//直接通过Key来取值 </span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="type">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过Key来设值</span></span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="keyword">nullable</span> <span class="type">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认返回YES，表示如果没有找到会按照一定的规则进行搜索，设置成NO如果没有找到就当作没有，会抛出异常。</span></span><br><span class="line">+ (<span class="type">BOOL</span>)accessInstanceVariablesDirectly;</span><br><span class="line"></span><br><span class="line"><span class="comment">//KVC提供属性值正确性验证的API，它可以用来检查set的值是否正确，为不正确的值做一个替换值或者拒绝设置新值并返回错误原因。但是注意这个方法是不会自动调用的需要我们手动调用。</span></span><br><span class="line">- (<span class="type">BOOL</span>)validateValue:(<span class="keyword">inout</span> <span class="type">id</span> __<span class="keyword">nullable</span> * __<span class="keyword">nonnull</span>)ioValue forKey:(<span class="built_in">NSString</span> *)inKey error:(<span class="keyword">out</span> <span class="built_in">NSError</span> **)outError;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果Key不存在，且没有KVC无法搜索到任何和Key有关的字段或者属性，则会调用这个方法，默认是抛出异常。</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="type">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和上一个方法一样，但这个方法是设值，前面一个是取值。</span></span><br><span class="line">- (<span class="type">void</span>)setValue:(<span class="keyword">nullable</span> <span class="type">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果你在SetValue方法时面给Value传nil，则会调用这个方法</span></span><br><span class="line">- (<span class="type">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器类型相关</span></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="built_in">NSMutableOrderedSet</span> *)mutableOrderedSetValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="built_in">NSMutableSet</span> *)mutableSetValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line">- (<span class="built_in">NSMutableOrderedSet</span> *)mutableOrderedSetValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line">- (<span class="built_in">NSMutableSet</span> *)mutableSetValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入key数组, 返回一个成员变量名和变量值的键值对组成的字典(可用于模型转字典)</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="type">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</span><br><span class="line"><span class="comment">// 字典转模型</span></span><br><span class="line">- (<span class="type">void</span>)setValuesForKeysWithDictionary:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="type">id</span>&gt; *)keyedValues;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面是KVC 关键用法的总结：</p>
<h6 id="1-设置和访问策略及访问私有属性和可读属性"><a href="#1-设置和访问策略及访问私有属性和可读属性" class="headerlink" title="1. 设置和访问策略及访问私有属性和可读属性"></a>1. 设置和访问策略及访问私有属性和可读属性</h6><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Teacher</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *readonlyValue;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&quot;Teacher.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Teacher</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span> ,<span class="keyword">readwrite</span>) <span class="built_in">NSInteger</span>      age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span> ,<span class="keyword">readwrite</span>) <span class="built_in">NSString</span>       *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span> ,<span class="keyword">readwrite</span>) <span class="type">BOOL</span>           male;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span> ,<span class="keyword">readwrite</span>) <span class="type">BOOL</span>           isTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Teacher</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;name = %@ \</span></span><br><span class="line"><span class="string">                                        age  = %ld \</span></span><br><span class="line"><span class="string">                               readOnlyValue = %@ \</span></span><br><span class="line"><span class="string">                                     is Male = %d&quot;</span>,</span><br><span class="line">                                     <span class="keyword">self</span>.name, (<span class="type">long</span>)<span class="keyword">self</span>.age, <span class="keyword">self</span>.readonlyValue, <span class="keyword">self</span>.male];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main(<span class="type">int</span> argc, <span class="keyword">const</span> <span class="type">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">    </span><br><span class="line">        Teacher *teacher = [Teacher new];</span><br><span class="line">        [teacher setValue:<span class="string">@&quot;linxiaohai&quot;</span> forKey:<span class="string">@&quot;name&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        [teacher setValue:<span class="string">@&quot;linxiaohai1&quot;</span> forKey:<span class="string">@&quot;_name&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//修改NSInteger要转换成NSNumber*</span></span><br><span class="line">        [teacher setValue:@(<span class="number">29</span>) forKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//修改BOOL要转换成NSNumber*</span></span><br><span class="line">        [teacher setValue:@(<span class="literal">YES</span>) forKey:<span class="string">@&quot;male&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        [teacher setValue:@(<span class="literal">NO</span>) forKey:<span class="string">@&quot;_male&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//修改只读属性</span></span><br><span class="line">        [teacher setValue:<span class="string">@&quot;This is a readOnly Value&quot;</span> forKey:<span class="string">@&quot;readonlyValue&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        [teacher setValue:<span class="string">@&quot;This is a readOnly Value 2&quot;</span> forKey:<span class="string">@&quot;_readonlyValue&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果没有找到将会按照_is&lt;Key&gt; isKey 方式继续查找 </span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;Test: %d&quot;</span>, [[teacher valueForKey:<span class="string">@&quot;test&quot;</span>] boolValue]);</span><br><span class="line">        [teacher setValue:@(<span class="literal">YES</span>) forKey:<span class="string">@&quot;test&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,teacher);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;Test: %d&quot;</span>, [[teacher valueForKey:<span class="string">@&quot;test&quot;</span>] boolValue]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">860598</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">0</span> readOnlyValue = (null)   is Male = <span class="number">0</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">860744</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">29</span> readOnlyValue = (null)  is Male = <span class="number">0</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">860916</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">29</span> readOnlyValue = (null)  is Male = <span class="number">0</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">861087</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">29</span> readOnlyValue = (null)  is Male = <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">861213</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">29</span> readOnlyValue = This is a readOnly Value is Male = <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">861348</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai age= <span class="number">29</span> readOnlyValue = This is a readOnly Value <span class="number">2</span> is Male = <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">861422</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] male: <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">877241</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] ===================================================</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">877501</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] Test: <span class="number">0</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">877765</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] name = linxiaohai  age= <span class="number">29</span> readOnlyValue = This is a readOnly Value <span class="number">2</span> is Male = <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">877824</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] Test: <span class="number">1</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">06</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">36</span>.<span class="number">877867</span>+<span class="number">0800</span> KVC-Demo[<span class="number">42518</span>:<span class="number">5605320</span>] ===================================================</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>-(void)setValue:(id)value forKey:(NSString *)key 规则：</li>
</ul>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">首先搜索 setter 方法，有就直接赋值。</span><br><span class="line">如果上面的 setter 方法没有找到，再检查类方法+ (BOOL)accessInstanceVariablesDirectly</span><br><span class="line">返回 NO，则执行<span class="built_in">set</span>Value：<span class="keyword">for</span>UNdefinedKey：</span><br><span class="line">返回 YES，则按_<span class="variable">&lt;key&gt;</span>，_<span class="variable">&lt;isKey&gt;</span>，<span class="variable">&lt;key&gt;</span>，<span class="variable">&lt;isKey&gt;</span>的顺序搜索[实例变量]注意这里是搜索实例变量，不是属性。</span><br><span class="line">还没有找到的话，就调用<span class="built_in">set</span>Value:<span class="keyword">for</span>UndefinedKey:</span><br></pre></td></tr></table></figure>

<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">总结来说就是KVC设值的顺序如下： <span class="function"><span class="title">setKey</span> -&gt;</span> _<span class="function"><span class="title">key</span> -&gt;</span> _<span class="function"><span class="title">isKey</span> -&gt;</span> <span class="function"><span class="title">key</span> -&gt;</span> isKey</span><br></pre></td></tr></table></figure>

<ul>
<li>-(id)valueForKey:(NSString *)key 规则</li>
</ul>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">* 首先查找 getter 方法，找到直接调用。如果是 bool、<span class="keyword">int</span>、float 等基本数据类型，会做 NSNumber 的转换。</span><br><span class="line">* 如果没查到，再检查类方法+ (BOOL)accessInstanceVariablesDirectly</span><br><span class="line">* 返回 NO，则执行valueForUNdefinedKey:</span><br><span class="line">* 返回 YES，则按_<span class="symbol">&lt;key&gt;</span>,_is<span class="symbol">&lt;Key&gt;</span>,<span class="symbol">&lt;key&gt;</span>,<span class="keyword">is</span><span class="symbol">&lt;Key&gt;</span>的顺序搜索实例变量。</span><br><span class="line">* 如果没有则查找countOf<span class="symbol">&lt;Key&gt;</span>,objectIn<span class="symbol">&lt;Key&gt;</span>AtIndex或<span class="symbol">&lt;Key&gt;</span>AtIndexes格式的方法，如果countOf<span class="symbol">&lt;Key&gt;</span>方法和另外两个方法中的一个被找到，那么就会返回一个可以响应NSArray所有方法的代理集合</span><br><span class="line">* 还没找到则查找countOf<span class="symbol">&lt;Key&gt;</span>，enumeratorOf<span class="symbol">&lt;Key&gt;</span>,memberOf<span class="symbol">&lt;Key&gt;</span>格式的方法，如果这三个方法都找到，那么就返回一个可以响应NSSet所的方法的代理集合。</span><br><span class="line">* 还没有找到的话，调用valueForUndefinedKey:</span><br></pre></td></tr></table></figure>

<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">总结来说就是KVC取值的顺序如下： <span class="function"><span class="title">getKey</span> -&gt;</span> _<span class="function"><span class="title">key</span> -&gt;</span> _<span class="function"><span class="title">isKey</span> -&gt;</span> <span class="function"><span class="title">key</span> -&gt;</span> isKey</span><br><span class="line">-&gt; [<span class="function"><span class="title">countOf</span>&lt;Key&gt; objectIn&lt;Key&gt;AtIndex &lt;Key&gt;AtIndexes] -&gt;</span> [countOf&lt;Key&gt;，enumeratorOf&lt;Key&gt;,memberOf&lt;Key&gt;]</span><br></pre></td></tr></table></figure>

<p>keyPath 用法：</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="symbol">Teacher</span> *teacher = [<span class="symbol">Teacher</span> new];</span><br><span class="line"><span class="symbol">Student</span> *student = [<span class="symbol">Student</span> new];</span><br><span class="line">[student setValue:@<span class="string">&quot;Jimmy&quot;</span> forKey:@<span class="string">&quot;name&quot;</span>];</span><br><span class="line">[teacher setValue:student forKey:@<span class="string">&quot;student&quot;</span>];</span><br><span class="line"><span class="symbol">NSString</span> *studentName = [teacher valueForKeyPath:@<span class="string">&quot;student.name&quot;</span>];</span><br><span class="line"><span class="symbol">NSLog</span>(@<span class="string">&quot;Student name: %@&quot;</span>,studentName);</span><br><span class="line">[teacher setValue:@<span class="string">&quot;linxiaohai&quot;</span> forKeyPath:@<span class="string">&quot;student.name&quot;</span>];</span><br></pre></td></tr></table></figure>

<h6 id="2-异常处理"><a href="#2-异常处理" class="headerlink" title="2. 异常处理"></a>2. 异常处理</h6><p>如果都没找到对应的key就会调用setValue:forUndefinedKey: 和valueForUndefinedKey:<br>下面是一个例子：</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">增加</span><br><span class="line">- (void)setValue:<span class="built_in">(id</span>)<span class="keyword">value</span> forUndefinedKey:(NSString *<span class="built_in">)key</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">[key</span> isEqualToString:@<span class="string">&quot;undefineKey&quot;</span>]) &#123;</span><br><span class="line">        NSLog(@<span class="string">&quot;=========&gt; %@&quot;</span>,<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在调用[teacher setValue:@<span class="string">&quot;valueForUndefineKey&quot;</span> forKey:@<span class="string">&quot;undefineKey&quot;</span>] 的时候就会打出如下log</span><br><span class="line"></span><br><span class="line">=========&gt; valueForUndefineKey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">增加：</span><br><span class="line">- <span class="built_in">(id</span>)valueForUndefinedKey:(NSString *<span class="built_in">)key</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [NSString stringWithFormat:@<span class="string">&quot;This is A default Value for %@&quot;</span><span class="built_in">,key</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在调用</span><br><span class="line">NSLog(@<span class="string">&quot;Test: %@&quot;</span>, [teacher valueForKey:@<span class="string">&quot;undefineKey&quot;</span>]); 就会打出如下Log:</span><br><span class="line"></span><br><span class="line">Test: This <span class="literal">is</span> A <span class="keyword">default</span> Value <span class="keyword">for</span> undefineKey</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其他API</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"><span class="comment">// 这是集合操作的API，里面还有一系列这样的API，如果属性是一个NSMutableArray，那么可以用这个方法来返回</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你在setValue方法时面给Value传nil，则会调用这个方法</span></span><br><span class="line">- (<span class="type">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>

<h6 id="3-字典转模型"><a href="#3-字典转模型" class="headerlink" title="3. 字典转模型"></a>3. 字典转模型</h6><p>使用字典来初始化模型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">NSDictionary *catogiresDic = @&#123;</span><br><span class="line"><span class="meta">@<span class="string">&quot;id&quot;</span> :@<span class="number">1</span>,</span></span><br><span class="line"><span class="meta">@<span class="string">&quot;image&quot;</span>:@<span class="string">&quot;@www.iPhone.com&quot;</span>,</span></span><br><span class="line"><span class="meta">@<span class="string">&quot;name&quot;</span>:@<span class="string">&quot;iPhone&quot;</span>,</span></span><br><span class="line"><span class="meta">@<span class="string">&quot;price&quot;</span>:@<span class="string">&quot;100.03&quot;</span>&#125;;</span></span><br><span class="line">CategoryList *catogires = [[CategoryList alloc] init];</span><br><span class="line">[catogires setValuesForKeysWithDictionary:catogiresDic];</span><br></pre></td></tr></table></figure>

<p>通过key的集合来从一个model中取出值形成一个字典</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">NSDictionary *value = [catogires dictionaryWithValuesForKeys:@[@&quot;name<span class="string">&quot;,@&quot;</span><span class="keyword">image</span><span class="string">&quot;]];</span></span><br></pre></td></tr></table></figure>

<h6 id="4-集合操作"><a href="#4-集合操作" class="headerlink" title="4. 集合操作"></a>4. 集合操作</h6><p>KVC对于数组而言最大的功能还是获取集合类的 count，max，min，avg，sum 这是一个很好用的功能</p>
<p>集合操作的keyPath整体格式如下图所示:</p>
<p><img src="/2019/07/14/iOS-KVC-KVO/00001.png"></p>
<p>左边是当前对象中待操作的集合实例对象，如果是针对自身的某个属性做操作，则可以省略，”@”操作符右边的是需要操作的属性。如果操作符是count的话右边也可以省略，这时候相当于针对当前数量统计。</p>
<ul>
<li><strong><strong>简单运算符</strong></strong></li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;count of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@count&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;count of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@count.price&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;min of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@min.price&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;avg of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@max.price&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;sum of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@sum.price&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;avg of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.@avg.price&quot;</span>])</span>;</span><br></pre></td></tr></table></figure>

<p>如果自身是一NSNumber数组的话右边的可以为self，表示针对的是自身</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;count of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;@count&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;count of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;@count.self&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;min of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.self&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;avg of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.self&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;sum of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.self&quot;</span>])</span>;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;avg of book price : %@&quot;</span>,[<span class="params">student</span> <span class="params">valueForKeyPath</span>:@<span class="string">&quot;bookList.self&quot;</span>])</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><strong>对象运算符</strong></strong></li>
</ul>
<p>通过这个特性能够一个对象集合的所有某个特定字端的值组成一个数组</p>
<p>一共有两种：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@distinctUnionOfObjects</span></span><br><span class="line"><span class="variable">@unionOfObjects</span></span><br></pre></td></tr></table></figure>
<p>它们的返回值都是NSArray，区别是前者返回的元素都是唯一的，是去重以后的结果；后者返回的元素是全集。例子如下：</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">NSArray<span class="symbol">*</span> arrDistinct = [arrBooks valueForKeyPath:<span class="meta">@&quot;</span><span class="meta">@distinctUnionOfObjects.price&quot;];</span></span><br><span class="line">NSArray<span class="symbol">*</span> arrUnion = [arrBooks valueForKeyPath:<span class="meta">@&quot;</span><span class="meta">@unionOfObjects.price&quot;];</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><strong>数组集合运算符</strong></strong></li>
</ul>
<p>这类操作符的操作对象内对象必须是数组&#x2F;集合，也就是元素为数组&#x2F;集合的数组&#x2F;集合：下面是一个简单例子：</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="symbol">IDLProductModel</span> *productA = [[<span class="symbol">IDLProductModel</span> alloc] init];</span><br><span class="line">productA.price = <span class="number">99.0</span>;</span><br><span class="line">productA.name = @<span class="string">&quot;iPod&quot;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="symbol">IDLProductModel</span> *productB = [[<span class="symbol">IDLProductModel</span> alloc] init];</span><br><span class="line">productB.price = <span class="number">199000.0</span>;</span><br><span class="line">productB.name = @<span class="string">&quot;iMac&quot;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="symbol">IDLProductModel</span> *productC = [[<span class="symbol">IDLProductModel</span> alloc] init];</span><br><span class="line">productC.price = <span class="number">2990.0</span>;</span><br><span class="line">productC.name = @<span class="string">&quot;iPhone&quot;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="symbol">IDLProductModel</span> *productD = [[<span class="symbol">IDLProductModel</span> alloc] init];</span><br><span class="line">productD.price = <span class="number">1990.0</span>;</span><br><span class="line">productD.name = @<span class="string">&quot;iPhone&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="symbol">NSArray</span> *product = @[productA, productB, productC, productD];</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">NSArray</span> <span class="operator">*</span>distinctUnionOfArrays <span class="operator">=</span> [@[product, product] valueForKeyPath:@<span class="string">&quot;@distinctUnionOfArrays.price&quot;</span>];</span><br><span class="line"><span class="type">NSArray</span> <span class="operator">*</span>unionOfArrays <span class="operator">=</span> [@[product, product] valueForKeyPath:@<span class="string">&quot;@unionOfArrays.price&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">NSSet</span> <span class="operator">*</span>setA <span class="operator">=</span> [<span class="type">NSSet</span> setWithObjects:productA, productB, <span class="literal">nil</span>];</span><br><span class="line"><span class="type">NSSet</span> <span class="operator">*</span>setB <span class="operator">=</span> [<span class="type">NSSet</span> setWithObjects:productC, productD, <span class="literal">nil</span>];</span><br><span class="line"><span class="type">NSSet</span> <span class="operator">*</span><span class="keyword">set</span> <span class="operator">=</span> [<span class="type">NSSet</span> setWithObjects:setA, setB, <span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">NSSet</span> <span class="operator">*</span>allSet <span class="operator">=</span> [<span class="keyword">set</span> valueForKeyPath:@<span class="string">&quot;@distinctUnionOfSets.name&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>这种其实就是将操作对象的所有数据取出来，展开铺平为一个数组后，再对数组或者集合做操作。</p>
<h6 id="5-键值验证"><a href="#5-键值验证" class="headerlink" title="5. 键值验证"></a>5. 键值验证</h6><p>KVC提供了验证Key对应的Value是否可用的方法，但是这个方法不会自动调用，必须在使用的时候手动调用：</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">- <span class="params">(BOOL)</span>validateValue:<span class="params">(inoutid*)</span>ioValue forKey:<span class="params">(NSString*)</span>inKey error:<span class="params">(outNSError**)</span>outError;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如下例子:</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)validateValue:(<span class="keyword">inout</span> <span class="type">id</span>  _Nullable __autoreleasing *)ioValue forKey:(<span class="built_in">NSString</span> *)inKey error:(<span class="keyword">out</span> <span class="built_in">NSError</span> * _Nullable __autoreleasing *)outError &#123;</span><br><span class="line">    <span class="built_in">NSNumber</span> *age = *ioValue;</span><br><span class="line">    <span class="keyword">if</span> (age.integerValue == <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSNumber</span> *age = @<span class="number">10</span>;</span><br><span class="line"><span class="built_in">NSError</span>* error;</span><br><span class="line"><span class="built_in">NSString</span> *key = <span class="string">@&quot;age&quot;</span>;</span><br><span class="line"><span class="type">BOOL</span> isValid = [test validateValue:&amp;age forKey:key error:&amp;error];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="6-其他用途"><a href="#6-其他用途" class="headerlink" title="6.其他用途"></a>6.其他用途</h6><ul>
<li>指定数组中每个元素的执行方法,然后将新元素放到新数组中返回</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NSArray</span> *arr = @[@<span class="string">&quot;iPod&quot;</span>, @<span class="string">&quot;iPhone&quot;</span>, @<span class="string">&quot;iMac&quot;</span>, @<span class="string">&quot;iPhone8 Plus&quot;</span>];</span><br><span class="line"><span class="attribute">NSArray</span> *uppercaseStrArr = [arr valueForKeyPath:@<span class="string">&quot;uppercaseString&quot;</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>抽取字典数组中的指定key</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">NSArray <span class="symbol">*</span>array = <span class="meta">@[</span><span class="meta">@&#123;</span><span class="meta">@&quot;name&quot;</span> : <span class="meta">@&quot;iPod&quot;,</span>   <span class="meta">@&quot;price&quot;</span> : <span class="meta">@99</span> &#125;,</span><br><span class="line">                   <span class="meta">@&#123;</span><span class="meta">@&quot;name&quot;</span> : <span class="meta">@&quot;iPhone&quot;,</span> <span class="meta">@&quot;price&quot;</span> : <span class="meta">@199&#125;,</span></span><br><span class="line">                   <span class="meta">@&#123;</span><span class="meta">@&quot;name&quot;</span> : <span class="meta">@&quot;iPhone&quot;,</span> <span class="meta">@&quot;price&quot;</span> : <span class="meta">@299&#125;,</span></span><br><span class="line">                   <span class="meta">@&#123;</span><span class="meta">@&quot;name&quot;</span> : <span class="meta">@&quot;iPhone&quot;,</span> <span class="meta">@&quot;price&quot;</span> : <span class="meta">@299&#125;,</span></span><br><span class="line">                       ];</span><br><span class="line">NSLog(<span class="meta">@&quot;%</span><span class="meta">@&quot;,</span> [array valueForKeyPath:<span class="meta">@&quot;name&quot;]);//iPod,iPhone,iPhone,iPhone</span></span><br></pre></td></tr></table></figure>

<h5 id="KVO-—-Key-Value-Observer-键值观察"><a href="#KVO-—-Key-Value-Observer-键值观察" class="headerlink" title="KVO  —  Key Value Observer  键值观察"></a>KVO  —  Key Value Observer  键值观察</h5><h6 id="1-KVO-的基本使用"><a href="#1-KVO-的基本使用" class="headerlink" title="1. KVO 的基本使用"></a>1. KVO 的基本使用</h6><p>KVO 适合任何对象监听另一个对象的改变，这是一个对象与另外一个对象保持同步的一种方法。KVO 只能对属性做出反应，不会用来对方法或者动作做出反应</p>
<p>为某个对象的属性添加观察者：</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">[_person addObserver:<span class="keyword">self</span></span><br><span class="line">          forKeyPath:<span class="string">@&quot;age&quot;</span></span><br><span class="line">             options:<span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span> | <span class="built_in">NSKeyValueObservingOptionInitial</span>|<span class="built_in">NSKeyValueObservingOptionPrior</span></span><br><span class="line">             context:<span class="literal">nil</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>回调方法</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">- <span class="params">(void)</span>observeValueForKeyPath:<span class="params">(NSString *)</span>keyPath</span><br><span class="line">                      ofObject:<span class="params">(id)</span>object</span><br><span class="line">                        change:<span class="params">(NSDictionary&lt;NSString *,id&gt; *)</span>change</span><br><span class="line">                        context:<span class="params">(void *)</span>context &#123;</span><br><span class="line">    NSLog<span class="params">(@<span class="string">&quot;%@对象的%@属性改变了：%@&quot;</span>,object,keyPath,change)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>移除观察者</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">[<span class="variable language_">self</span>.person <span class="symbol">removeObserver:</span><span class="variable language_">self</span> <span class="symbol">forKeyPath:</span>@<span class="string">&quot;age&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>这里比较重要的是option这个参数：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">NSKeyValueObservingOptionNew = 0x01 change字典包括改变后的值</span><br><span class="line">NSKeyValueObservingOptionOld = 0x02 change字典包括改变前的值</span><br><span class="line">NSKeyValueObservingOptionInitial = 0x04 注册后立刻触发KVO通知</span><br><span class="line">NSKeyValueObservingOptionPrior = 0x08</span><br><span class="line">如果指定，则在每次修改属性时，会在修改通知被发送之前预先发送一条通知给观察者，</span><br><span class="line"><span class="section">这与-willChangeValueForKey:被触发的时间是相对应的。</span></span><br><span class="line">这样，在每次修改属性时，实际上是会发送两条通知。</span><br></pre></td></tr></table></figure>

<h6 id="2-KVO-触发规则："><a href="#2-KVO-触发规则：" class="headerlink" title="2. KVO 触发规则："></a>2. KVO 触发规则：</h6><ul>
<li>通过成员变量的setter方法&#x2F;或者通过KVC都可以触发KVO</li>
<li>直接修改成员变量是不会触发KVC的，需要手动添加KVC才能触发。如何手动触发见下面部分。</li>
</ul>
<h6 id="3-设置相互关联的属性"><a href="#3-设置相互关联的属性" class="headerlink" title="3. 设置相互关联的属性"></a>3. 设置相互关联的属性</h6><p>假如有个 Person 类，类里有三个属性，fullName、firstName、lastName。这种情况如果需要观察名字的变化，就要分别添加 fullName、firstName、lastName 三次观察，非常麻烦。通过设置相互关联的属性就会在关联的属性发生变化的时候，另外的属性也受到通知。</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *firstName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *lastName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *fullName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在这里设置与fullName相关的依赖属性，外面一旦设置了这些依赖属性，fullName的观察者就会被触发</span></span><br><span class="line">+ (<span class="built_in">NSSet</span>&lt;<span class="built_in">NSString</span> *&gt; *)keyPathsForValuesAffectingFullName &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@&quot;firstName&quot;</span>,<span class="string">@&quot;lastName&quot;</span>, <span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">[_person addObserver:<span class="keyword">self</span></span><br><span class="line">            forKeyPath:<span class="string">@&quot;fullName&quot;</span></span><br><span class="line">            options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">            context:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">[_person setValue:<span class="string">@&quot;FistName&quot;</span> forKey:<span class="string">@&quot;fistName&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>上面的例子中我们不论设置Person类的firstName或者lastName 都会触发 fullName 的观察。</p>
<h6 id="4-手动KVO-禁用自动KVO"><a href="#4-手动KVO-禁用自动KVO" class="headerlink" title="4. 手动KVO (禁用自动KVO)"></a>4. 手动KVO (禁用自动KVO)</h6><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Target</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">int</span>)age;</span><br><span class="line">- (<span class="type">void</span>)setAge:(<span class="type">int</span>)theAge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Target</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">id</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="variable language_">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> != <span class="keyword">self</span>) &#123;</span><br><span class="line">        age = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">int</span>)age &#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setAge:(<span class="type">int</span>)theAge &#123;</span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">    age = theAge;</span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@&quot;age&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">BOOL</span>)automaticallyNotifiesObserversForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@&quot;age&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> automaticallyNotifiesObserversForKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<ol>
<li>需要手动实现属性的 setter 方法，并在设置操作的前后分别调用 willChangeValueForKey: 和 didChangeValueForKey方法</li>
<li>实现类方法 automaticallyNotifiesObserversForKey，并在其中设置对该 key 不自动发送通知（返回 NO 即可）。这里要注意，对其它非手动实现的 key，要转交给 super 来处理。</li>
</ol>
<h6 id="5-查看某个对象有哪些属性被监听"><a href="#5-查看某个对象有哪些属性被监听" class="headerlink" title="5. 查看某个对象有哪些属性被监听"></a>5. 查看某个对象有哪些属性被监听</h6><p>如果我们想获取一个对象上有哪些观察者正在监听其属性的修改，则可以查看对象的observationInfo属性</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">id info = <span class="keyword">object</span>.observationInfo;</span><br><span class="line"><span class="constructor">NSLog(@<span class="string">&quot;%@&quot;</span>, [<span class="params">info</span> <span class="params">description</span>])</span>;</span><br></pre></td></tr></table></figure>

<h6 id="6-KVO-原理："><a href="#6-KVO-原理：" class="headerlink" title="6.KVO 原理："></a>6.KVO 原理：</h6><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">KVO 是通过 isa-swizzling 实现的,当某个类的对象第一次被观察时，系统就会在运行期动态地创建该类的一个派生类，在这个派生类中做如下的几方面工作：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 重写基类中任何被观察属性的 <span class="keyword">setter</span> 方法，而通过重写就获得了 KVO 需要的通知机制</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setName:(<span class="built_in">NSString</span> *)newName &#123;</span><br><span class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@&quot;name&quot;</span>];    <span class="comment">// KVO在调用存取方法之前总调用</span></span><br><span class="line">    [<span class="variable language_">super</span> setValue:newName forKey:<span class="string">@&quot;name&quot;</span>]; <span class="comment">// 调用父类的存取方法</span></span><br><span class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@&quot;name&quot;</span>];     <span class="comment">// KVO在调用存取方法之后总调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">KVO 在调用存取方法之前总是调用 willChangeValueForKey:，通知系统该 keyPath 的属性值即将变更。 当改变发生后，didChangeValueForKey: 被调用，通知系统该 keyPath 的属性值已经变更。 之后，observeValueForKey:ofObject:change:context: 也会被调用。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 让这个重写的类成为原来类的派生类：</span><br><span class="line"></span><br><span class="line">除了完成上面提到的第一步操作的同时派生类还重写了<span class="keyword">class</span> 方法以“欺骗”外部调用者它就是起初的那个类。然后系统将这个对象的 isa 指针指向这个新诞生的派生类，因此这个对象就成为该派生类的对象了，因而在该对象上对 <span class="keyword">setter</span> 的调用就会调用重写的 <span class="keyword">setter</span>，从而激活键值通知机制</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 重写派生类的dealloc 方法释放资源</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h4><p>*<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e5430487b9fb">KVO进阶——KVO实现探究</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Objective-C-%E7%9B%B8%E5%85%B3/">Objective C 相关</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Objective-C-相关/">Objective C 相关</a>
  </div>

</div>



</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2019/07/14/iOS-学习记录-一-图解生命周期/" title="iOS 学习记录[一] 图解生命周期">
  <span>
  iOS 学习记录[一] 图解生命周期</span>
</a>
</div>


<div class="next">
<a href="/2019/07/12/iOS-Runloop-总结/"  title="iOS Runloop 总结">
 <span>iOS Runloop 总结
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2019/07/14/iOS-KVC-KVO/" data-title="iOS KVC KVO 总结" data-url="http://yoursite.com/2019/07/14/iOS-KVC-KVO/"></div>
</section>


<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#KVC-%E2%80%94-Key-Value-Coding-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">KVC  —  Key Value Coding  键值编码</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E8%AE%BE%E7%BD%AE%E5%92%8C%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E5%8F%8A%E8%AE%BF%E9%97%AE%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7%E5%92%8C%E5%8F%AF%E8%AF%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">1. 设置和访问策略及访问私有属性和可读属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">2. 异常处理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E5%AD%97%E5%85%B8%E8%BD%AC%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">3. 字典转模型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.</span> <span class="toc-text">4. 集合操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-%E9%94%AE%E5%80%BC%E9%AA%8C%E8%AF%81"><span class="toc-number">1.5.</span> <span class="toc-text">5. 键值验证</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-%E5%85%B6%E4%BB%96%E7%94%A8%E9%80%94"><span class="toc-number">1.6.</span> <span class="toc-text">6.其他用途</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#KVO-%E2%80%94-Key-Value-Observer-%E9%94%AE%E5%80%BC%E8%A7%82%E5%AF%9F"><span class="toc-number">2.</span> <span class="toc-text">KVO  —  Key Value Observer  键值观察</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-KVO-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">1. KVO 的基本使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-KVO-%E8%A7%A6%E5%8F%91%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">2. KVO 触发规则：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AE%E7%9B%B8%E4%BA%92%E5%85%B3%E8%81%94%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">3. 设置相互关联的属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E6%89%8B%E5%8A%A8KVO-%E7%A6%81%E7%94%A8%E8%87%AA%E5%8A%A8KVO"><span class="toc-number">2.4.</span> <span class="toc-text">4. 手动KVO (禁用自动KVO)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B1%9E%E6%80%A7%E8%A2%AB%E7%9B%91%E5%90%AC"><span class="toc-number">2.5.</span> <span class="toc-text">5. 查看某个对象有哪些属性被监听</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-KVO-%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">2.6.</span> <span class="toc-text">6.KVO 原理：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="toc-number"></span> <span class="toc-text">扩展阅读</span></a>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/tbfungeek" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:tbfungeek@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android-小经验/" title="Android 小经验">Android 小经验<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android-源码分析/" title="Android 源码分析">Android 源码分析<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android其他/" title="Android其他">Android其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android初步/" title="Android初步">Android初步<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android进阶/" title="Android进阶">Android进阶<sup>100</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript理论/" title="JavaScript理论">JavaScript理论<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
		  
		
		  
			<li><a href="/categories/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ROS/" title="ROS">ROS<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-工具使用/" title="iOS 工具使用">iOS 工具使用<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/个人收藏/" title="个人收藏">个人收藏<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/代码规范/" title="代码规范">代码规范<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/其他/" title="其他">其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/博客分类目录/" title="博客分类目录">博客分类目录<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/叨叨系列/" title="叨叨系列">叨叨系列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源代码分析/" title="开源代码分析">开源代码分析<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源库分析/" title="开源库分析">开源库分析<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/版本控制/" title="版本控制">版本控制<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/直播/" title="直播">直播<sup>6</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
			
		
			
				<li><a href="/tags/Android-设计模式/" title="Android 设计模式">Android 设计模式<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/Android基础/" title="Android基础">Android基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/AOSP-源码/" title="AOSP 源码">AOSP 源码<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/Android-常用第三方库/" title="Android 常用第三方库">Android 常用第三方库<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ROS/" title="ROS">ROS<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Android-动画进阶/" title="Android 动画进阶">Android 动画进阶<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Android-JNI/" title="Android JNI">Android JNI<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-绘图进阶/" title="Android 绘图进阶">Android 绘图进阶<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android性能优化/" title="Android性能优化">Android性能优化<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自动化测试/" title="Android 自动化测试">Android 自动化测试<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/直播/" title="直播">直播<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-开源源码/" title="Android 开源源码">Android 开源源码<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自定义View进阶/" title="Android 自定义View进阶">Android 自定义View进阶<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://pages.github.com/" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="http://pf18.github.io/" target="_blank" title="PF18">PF18</a>
            
          </li>
        
          <li>
            
            	<a href="http://toutiao.io/" target="_blank" title="开发者头条">开发者头条</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.jcodecraeer.com/" target="_blank" title="泡在网上的日子">泡在网上的日子</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/AOSP-%E6%BA%90%E7%A0%81/" style="font-size: 17.14px;">AOSP 源码</a> <a href="/tags/Android-APK-%E7%AD%BE%E5%90%8D/" style="font-size: 10px;">Android APK 签名</a> <a href="/tags/Android-JNI/" style="font-size: 12.86px;">Android JNI</a> <a href="/tags/Android-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E8%BF%9B%E9%98%B6/" style="font-size: 10.71px;">Android 事件处理进阶</a> <a href="/tags/Android-%E5%8A%A8%E7%94%BB%E8%BF%9B%E9%98%B6/" style="font-size: 13.57px;">Android 动画进阶</a> <a href="/tags/Android-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91/" style="font-size: 10px;">Android 多线程开发</a> <a href="/tags/Android-%E5%B0%8F%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">Android 小经验</a> <a href="/tags/Android-%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" style="font-size: 16.43px;">Android 常用第三方库</a> <a href="/tags/Android-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android 开发流程</a> <a href="/tags/Android-%E5%BC%80%E6%BA%90%E6%BA%90%E7%A0%81/" style="font-size: 12.14px;">Android 开源源码</a> <a href="/tags/Android-%E7%BB%98%E5%9B%BE%E8%BF%9B%E9%98%B6/" style="font-size: 12.86px;">Android 绘图进阶</a> <a href="/tags/Android-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" style="font-size: 12.86px;">Android 自动化测试</a> <a href="/tags/Android-%E8%87%AA%E5%AE%9A%E4%B9%89View%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">Android 自定义View进阶</a> <a href="/tags/Android-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 19.29px;">Android 设计模式</a> <a href="/tags/Android%E5%85%B6%E4%BB%96/" style="font-size: 10px;">Android其他</a> <a href="/tags/Android%E5%9F%BA%E7%A1%80/" style="font-size: 17.86px;">Android基础</a> <a href="/tags/Android%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android开发流程</a> <a href="/tags/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 12.86px;">Android性能优化</a> <a href="/tags/Android%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">Android混淆技术</a> <a href="/tags/Android%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" style="font-size: 11.43px;">Android质量管理工具</a> <a href="/tags/Android%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" style="font-size: 10px;">Android逆向工程</a> <a href="/tags/Git-github/" style="font-size: 10px;">Git && github</a> <a href="/tags/Hexo-%E4%BD%BF%E7%94%A8/" style="font-size: 15px;">Hexo 使用</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Linux-%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">Linux 使用</a> <a href="/tags/Objective-C-%E7%9B%B8%E5%85%B3/" style="font-size: 18.57px;">Objective C 相关</a> <a href="/tags/OpenCV/" style="font-size: 12.86px;">OpenCV</a> <a href="/tags/ROS/" style="font-size: 14.29px;">ROS</a> <a href="/tags/iOS-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 10.71px;">iOS 工具使用</a> <a href="/tags/iOS-%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 20px;">iOS 开源库分析</a> <a href="/tags/iOS-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/" style="font-size: 15.71px;">iOS 理论基础</a> <a href="/tags/iOS-%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">iOS 进阶</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 10px;">代码规范</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E7%9B%AE%E5%BD%95/" style="font-size: 10.71px;">博客分类目录</a> <a href="/tags/%E5%8F%A8%E5%8F%A8%E7%B3%BB%E5%88%97/" style="font-size: 10px;">叨叨系列</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" style="font-size: 11.43px;">工具的使用</a> <a href="/tags/%E5%BC%80%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 10.71px;">开源代码分析</a> <a href="/tags/%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 10px;">开源库分析</a> <a href="/tags/%E6%9D%82%E7%B1%BB/" style="font-size: 10px;">杂类</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 12.14px;">树莓派</a> <a href="/tags/%E7%9B%B4%E6%92%AD/" style="font-size: 12.86px;">直播</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" style="font-size: 10.71px;">编程技巧</a> <a href="/tags/%E7%BD%91%E7%AB%99%E6%94%B6%E8%97%8F/" style="font-size: 10px;">网站收藏</a> <a href="/tags/%E9%87%8D%E8%A6%81%E6%8E%A7%E4%BB%B6/" style="font-size: 11.43px;">重要控件</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2022 
		
		<a href="/about" target="_blank" title="Edgar">Edgar</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"tbfungeek"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 


<script type="text/javascript">

var disqus_shortname = 'tbfungeek';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7c9443b0374f1cf6b1dbb5ab84d939cb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
