
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>Edgar&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Edgar">
    

    
    <meta name="description" content="Android | 全栈工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="Edgar&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/18/index.html">
<meta property="og:site_name" content="Edgar&#39;s Blog">
<meta property="og:description" content="Android | 全栈工程师">
<meta property="og:locale">
<meta property="article:author" content="Edgar">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="atom.xml" title="Edgar&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/unnamed4_n_mSY_icon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Edgar&#39;s Blog">Edgar&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/19/Android-进阶之第三方库的介绍-RxJava-RxAndroid-六/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 六 [转]RxJava使用场景小结" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 六 [转]RxJava使用场景小结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-19T10:09:20.000Z" itemprop="datePublished"> Published 2016-06-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>首先要事先声明下这篇博文是转载自如下两篇博客，后续部分也会另外创建一篇博文用于记录自己在RxJava实践中的使用场景：<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/lzyzsd/article/details/50120801">http://blog.csdn.net/lzyzsd/article/details/50120801</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/theone10211024/article/details/50435325">http://blog.csdn.net/theone10211024/article/details/50435325</a></p>
<h4 id="取数据先检查缓存的场景"><a href="#取数据先检查缓存的场景" class="headerlink" title="取数据先检查缓存的场景"></a>取数据先检查缓存的场景</h4><blockquote>
<p>取数据，首先检查内存是否有缓存<br>然后检查文件缓存中是否有<br>最后才从网络中取<br>前面任何一个条件满足，就不会执行后面的</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">final <span class="title class_">Observable</span>&lt;<span class="title class_">String</span>&gt; memory = <span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="keyword">new</span> <span class="title class_">Observable</span>.<span class="property">OnSubscribe</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params">Subscriber&lt;? <span class="variable language_">super</span> <span class="built_in">String</span>&gt; subscriber</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (memoryCache != <span class="literal">null</span>) &#123;</span><br><span class="line">            subscriber.<span class="title function_">onNext</span>(memoryCache);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            subscriber.<span class="title function_">onCompleted</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">String</span>&gt; disk = <span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="keyword">new</span> <span class="title class_">Observable</span>.<span class="property">OnSubscribe</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params">Subscriber&lt;? <span class="variable language_">super</span> <span class="built_in">String</span>&gt; subscriber</span>) &#123;</span><br><span class="line">        <span class="title class_">String</span> cachePref = rxPreferences.<span class="title function_">getString</span>(<span class="string">&quot;cache&quot;</span>).<span class="title function_">get</span>();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">TextUtils</span>.<span class="title function_">isEmpty</span>(cachePref)) &#123;</span><br><span class="line">            subscriber.<span class="title function_">onNext</span>(cachePref);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            subscriber.<span class="title function_">onCompleted</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">String</span>&gt; network = <span class="title class_">Observable</span>.<span class="title function_">just</span>(<span class="string">&quot;network&quot;</span>);</span><br><span class="line"><span class="comment">//主要就是靠concat operator来实现</span></span><br><span class="line"><span class="title class_">Observable</span>.<span class="title function_">concat</span>(memory, disk, network)</span><br><span class="line">.<span class="title function_">first</span>()</span><br><span class="line">.<span class="title function_">subscribeOn</span>(<span class="title class_">Schedulers</span>.<span class="title function_">newThread</span>())</span><br><span class="line">.<span class="title function_">subscribe</span>(s -&gt; &#123;</span><br><span class="line">    memoryCache = <span class="string">&quot;memory&quot;</span>;</span><br><span class="line">    <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;--------------subscribe: &quot;</span> + s);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="界面需要等到多个接口并发取完数据，再更新"><a href="#界面需要等到多个接口并发取完数据，再更新" class="headerlink" title="界面需要等到多个接口并发取完数据，再更新"></a>界面需要等到多个接口并发取完数据，再更新</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//拼接两个Observable的输出，不保证顺序，按照事件产生的顺序发送给订阅者</span></span><br><span class="line"><span class="keyword">private</span> void test<span class="constructor">Merge()</span> &#123;</span><br><span class="line">    Observable&lt;String&gt; observable1 = <span class="module-access"><span class="module"><span class="identifier">DemoUtils</span>.</span></span>create<span class="constructor">Observable1()</span>.subscribe<span class="constructor">On(Schedulers.<span class="params">newThread</span>()</span>);</span><br><span class="line">    Observable&lt;String&gt; observable2 = <span class="module-access"><span class="module"><span class="identifier">DemoUtils</span>.</span></span>create<span class="constructor">Observable2()</span>.subscribe<span class="constructor">On(Schedulers.<span class="params">newThread</span>()</span>);</span><br><span class="line"></span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Observable</span>.</span></span>merge(observable1, observable2)</span><br><span class="line">            .subscribe<span class="constructor">On(Schedulers.<span class="params">newThread</span>()</span>)</span><br><span class="line">            .subscribe(<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="一个接口的请求依赖另一个API请求返回的数据"><a href="#一个接口的请求依赖另一个API请求返回的数据" class="headerlink" title="一个接口的请求依赖另一个API请求返回的数据"></a>一个接口的请求依赖另一个API请求返回的数据</h4><p>举个例子，我们经常在需要登陆之后，根据拿到的token去获取消息列表。<br>这里用RxJava主要解决嵌套回调的问题，有一个专有名词叫Callback hell</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">NetworkService</span>.</span></span>get<span class="constructor">Token(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>)</span></span><br><span class="line">    .flat<span class="constructor">Map(<span class="params">s</span> -&gt; NetworkService.<span class="params">getMessage</span>(<span class="params">s</span>)</span>)</span><br><span class="line">    .subscribe(s -&gt; &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;message: &quot;</span> + s);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="界面按钮需要防止连续点击的情况"><a href="#界面按钮需要防止连续点击的情况" class="headerlink" title="界面按钮需要防止连续点击的情况"></a>界面按钮需要防止连续点击的情况</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">RxView</span>.</span></span>clicks(find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">btn_throttle</span>)</span>)</span><br><span class="line">    .throttle<span class="constructor">First(1, TimeUnit.SECONDS)</span></span><br><span class="line">    .subscribe(aVoid -&gt; &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="响应式的界面"><a href="#响应式的界面" class="headerlink" title="响应式的界面"></a>响应式的界面</h4><p>比如勾选了某个checkbox，自动更新对应的preference</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">SharedPreferences preferences = <span class="module-access"><span class="module"><span class="identifier">PreferenceManager</span>.</span></span>get<span class="constructor">DefaultSharedPreferences(<span class="params">this</span>)</span>;</span><br><span class="line">RxSharedPreferences rxPreferences = <span class="module-access"><span class="module"><span class="identifier">RxSharedPreferences</span>.</span></span>create(preferences);</span><br><span class="line"></span><br><span class="line">Preference&lt;Boolean&gt; checked = rxPreferences.get<span class="constructor">Boolean(<span class="string">&quot;checked&quot;</span>, <span class="params">true</span>)</span>;</span><br><span class="line"></span><br><span class="line">CheckBox checkBox = (CheckBox) find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">cb_test</span>)</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">RxCompoundButton</span>.</span></span>checked<span class="constructor">Changes(<span class="params">checkBox</span>)</span></span><br><span class="line">        .subscribe(checked.<span class="keyword">as</span><span class="constructor">Action()</span>);</span><br></pre></td></tr></table></figure>
<h4 id="复杂的数据变换"><a href="#复杂的数据变换" class="headerlink" title="复杂的数据变换"></a>复杂的数据变换</h4><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">Observable.just(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">    .<span class="keyword">map</span>(Integer::<span class="built_in">parseInt</span>)</span><br><span class="line">    .filter(s -&gt; s &gt; <span class="number">1</span>)</span><br><span class="line">    .distinct()</span><br><span class="line">    .take(<span class="number">3</span>)</span><br><span class="line">    .reduce<span class="function"><span class="params">((integer, integer2) -&gt; integer.intValue() + integer2.intValue())</span></span></span><br><span class="line"><span class="function">    .<span class="title">subscribe</span><span class="params">(System.out::println)</span>;//9</span></span><br></pre></td></tr></table></figure>


<h4 id="Scheduler线程切换"><a href="#Scheduler线程切换" class="headerlink" title="Scheduler线程切换"></a>Scheduler线程切换</h4><p>这种场景经常会在“后台线程取数据，主线程展示”的模式中看见</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">just</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  </span><br><span class="line">        .<span class="title function_">subscribeOn</span>(<span class="title class_">Schedulers</span>.<span class="title function_">io</span>()) <span class="comment">// 指定 subscribe() 发生在 IO 线程  </span></span><br><span class="line">        .<span class="title function_">observeOn</span>(<span class="title class_">AndroidSchedulers</span>.<span class="title function_">mainThread</span>()) <span class="comment">// 指定 Subscriber 的回调发生在主线程  </span></span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Action1</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params">Integer <span class="built_in">number</span></span>) &#123;  </span><br><span class="line">            <span class="title class_">Log</span>.<span class="title function_">d</span>(tag, <span class="string">&quot;number:&quot;</span> + <span class="built_in">number</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;);  </span><br></pre></td></tr></table></figure>
<h4 id="使用debounce做textSearch"><a href="#使用debounce做textSearch" class="headerlink" title="使用debounce做textSearch"></a>使用debounce做textSearch</h4><blockquote>
<p>用简单的话讲就是当N个结点发生的时间太靠近（即发生的时间差小于设定的值T），debounce就会自动过滤掉前N-1个结点。比如在做百度地址联想的时候，可以使用debounce减少频繁的网络请求。避免每输入（删除）一个字就做一次联想</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">RxTextView</span>.<span class="title function_">textChangeEvents</span>(inputEditText)  </span><br><span class="line">        .<span class="title function_">debounce</span>(<span class="number">400</span>, <span class="title class_">TimeUnit</span>.<span class="property">MILLISECONDS</span>)   </span><br><span class="line">        .<span class="title function_">observeOn</span>(<span class="title class_">AndroidSchedulers</span>.<span class="title function_">mainThread</span>())  </span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Observer</span>&lt;<span class="title class_">TextViewTextChangeEvent</span>&gt;() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        log.<span class="title function_">d</span>(<span class="string">&quot;onComplete&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;  </span><br><span class="line">        log.<span class="title function_">d</span>(<span class="string">&quot;Error&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">TextViewTextChangeEvent onTextChangeEvent</span>) &#123;  </span><br><span class="line">        log.<span class="title function_">d</span>(<span class="title function_">format</span>(<span class="string">&quot;Searching for %s&quot;</span>, onTextChangeEvent.<span class="title function_">text</span>().<span class="title function_">toString</span>()));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);  </span><br></pre></td></tr></table></figure>

<h4 id="Retrofit结合RxJava做网络请求框架"><a href="#Retrofit结合RxJava做网络请求框架" class="headerlink" title="Retrofit结合RxJava做网络请求框架"></a>Retrofit结合RxJava做网络请求框架</h4><blockquote>
<p>这里不作详解，具体的介绍可以看扔物线的这篇文章，对RxJava的入门者有很大的启发。其中也讲到了RxJava和Retrofit如何结合来实现更简洁的代码</p>
</blockquote>
<h4 id="RxJava代替EventBus进行数据传递：RxBus"><a href="#RxJava代替EventBus进行数据传递：RxBus" class="headerlink" title="RxJava代替EventBus进行数据传递：RxBus"></a>RxJava代替EventBus进行数据传递：RxBus</h4><blockquote>
<p>注意：RxBus并不是一个库，而是一种模式，是使用了RxJava的思想来达到EventBus的数据传递效果。这篇文章把RxBus讲的比较详细。</p>
</blockquote>
<h4 id="使用combineLatest合并最近N个结点"><a href="#使用combineLatest合并最近N个结点" class="headerlink" title="使用combineLatest合并最近N个结点"></a>使用combineLatest合并最近N个结点</h4><blockquote>
<p>例如：注册的时候所有输入信息（邮箱、密码、电话号码等）合法才点亮注册按钮。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">CharSequence</span>&gt; _emailChangeObservable = <span class="title class_">RxTextView</span>.<span class="title function_">textChanges</span>(_email).<span class="title function_">skip</span>(<span class="number">1</span>);  </span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">CharSequence</span>&gt; _passwordChangeObservable = <span class="title class_">RxTextView</span>.<span class="title function_">textChanges</span>(_password).<span class="title function_">skip</span>(<span class="number">1</span>);  </span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">CharSequence</span>&gt;   _numberChangeObservable = <span class="title class_">RxTextView</span>.<span class="title function_">textChanges</span>(_number).<span class="title function_">skip</span>(<span class="number">1</span>);  </span><br><span class="line">    </span><br><span class="line"><span class="title class_">Observable</span>.<span class="title function_">combineLatest</span>(_emailChangeObservable,  </span><br><span class="line">                _passwordChangeObservable,  </span><br><span class="line">                _numberChangeObservable,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Func3</span>&lt;<span class="title class_">CharSequence</span>, <span class="title class_">CharSequence</span>, <span class="title class_">CharSequence</span>, <span class="title class_">Boolean</span>&gt;() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="title class_">Boolean</span> <span class="title function_">call</span>(<span class="params">CharSequence newEmail,  </span></span><br><span class="line"><span class="params">                                        CharSequence newPassword,  </span></span><br><span class="line"><span class="params">                                        CharSequence newNumber</span>) &#123;  </span><br><span class="line">    </span><br><span class="line">                        <span class="title class_">Log</span>.<span class="title function_">d</span>(<span class="string">&quot;xiayong&quot;</span>,newEmail+<span class="string">&quot; &quot;</span>+newPassword+<span class="string">&quot; &quot;</span>+newNumber);  </span><br><span class="line">                        <span class="built_in">boolean</span> emailValid = !<span class="title function_">isEmpty</span>(newEmail) &amp;&amp;  </span><br><span class="line">                                            <span class="variable constant_">EMAIL_ADDRESS</span>.<span class="title function_">matcher</span>(newEmail).<span class="title function_">matches</span>();  </span><br><span class="line">                        <span class="keyword">if</span> (!emailValid) &#123;  </span><br><span class="line">                            _email.<span class="title function_">setError</span>(<span class="string">&quot;Invalid Email!&quot;</span>);  </span><br><span class="line">                        &#125;  </span><br><span class="line">    </span><br><span class="line">                        <span class="built_in">boolean</span> passValid = !<span class="title function_">isEmpty</span>(newPassword) &amp;&amp; newPassword.<span class="title function_">length</span>() &gt; <span class="number">8</span>;  </span><br><span class="line">                        <span class="keyword">if</span> (!passValid) &#123;  </span><br><span class="line">                            _password.<span class="title function_">setError</span>(<span class="string">&quot;Invalid Password!&quot;</span>);  </span><br><span class="line">                        &#125;  </span><br><span class="line">    </span><br><span class="line">                        <span class="built_in">boolean</span> numValid = !<span class="title function_">isEmpty</span>(newNumber);  </span><br><span class="line">                        <span class="keyword">if</span> (numValid) &#123;  </span><br><span class="line">                            int num = <span class="title class_">Integer</span>.<span class="built_in">parseInt</span>(newNumber.<span class="title function_">toString</span>());  </span><br><span class="line">                            numValid = num &gt; <span class="number">0</span> &amp;&amp; num &lt;= <span class="number">100</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        <span class="keyword">if</span> (!numValid) &#123;  </span><br><span class="line">                            _number.<span class="title function_">setError</span>(<span class="string">&quot;Invalid Number!&quot;</span>);  </span><br><span class="line">                        &#125;  </span><br><span class="line">    </span><br><span class="line">                        <span class="keyword">return</span> emailValid &amp;&amp; passValid &amp;&amp; numValid;  </span><br><span class="line">    </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;)<span class="comment">//  </span></span><br><span class="line">                .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Observer</span>&lt;<span class="title class_">Boolean</span>&gt;() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">d</span>(<span class="string">&quot;completed&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">d</span>(<span class="string">&quot;Error&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params"><span class="built_in">Boolean</span> formValid</span>) &#123;  </span><br><span class="line">                        _btnValidIndicator.<span class="title function_">setEnabled</span>(formValid);    </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br></pre></td></tr></table></figure>


<h4 id="使用merge合并两个数据源。"><a href="#使用merge合并两个数据源。" class="headerlink" title="使用merge合并两个数据源。"></a>使用merge合并两个数据源。</h4><blockquote>
<p>例如一组数据来自网络，一组数据来自文件，需要合并两组数据一起展示。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">merge</span>(<span class="title function_">getDataFromFile</span>(), <span class="title function_">getDataFromNet</span>())  </span><br><span class="line">                .<span class="title function_">observeOn</span>(<span class="title class_">AndroidSchedulers</span>.<span class="title function_">mainThread</span>())  </span><br><span class="line">                .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">String</span>&gt;() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">d</span>(<span class="string">&quot;done loading all data&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">d</span>(<span class="string">&quot;error&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params"><span class="built_in">String</span> data</span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">d</span>(<span class="string">&quot;all merged data will pass here one by one!&quot;</span>)  </span><br><span class="line">                &#125;);  </span><br></pre></td></tr></table></figure>

<h4 id="使用timer做定时操作。当有“x秒后执行y操作”类似的需求的时候，想到使用timer"><a href="#使用timer做定时操作。当有“x秒后执行y操作”类似的需求的时候，想到使用timer" class="headerlink" title="使用timer做定时操作。当有“x秒后执行y操作”类似的需求的时候，想到使用timer"></a>使用timer做定时操作。当有“x秒后执行y操作”类似的需求的时候，想到使用timer</h4><blockquote>
<p>例如：2秒后输出日志“hello world”，然后结束。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">timer</span>(<span class="number">2</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>)  </span><br><span class="line">                .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Observer</span>&lt;<span class="title class_">Long</span>&gt;() &#123;  </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;  </span><br><span class="line">                        log.<span class="property">d</span> (<span class="string">&quot;completed&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;  </span><br><span class="line">                        log.<span class="title function_">e</span>(<span class="string">&quot;error&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">    </span><br><span class="line">                    <span class="meta">@Override</span>  </span><br><span class="line">                    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Long <span class="built_in">number</span></span>) &#123;  </span><br><span class="line">                        log.<span class="property">d</span> (<span class="string">&quot;hello world&quot;</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;);  </span><br></pre></td></tr></table></figure>
<h4 id="使用interval做周期性操作。当有“每隔xx秒后执行yy操作”类似的需求的时候，想到使用interval"><a href="#使用interval做周期性操作。当有“每隔xx秒后执行yy操作”类似的需求的时候，想到使用interval" class="headerlink" title="使用interval做周期性操作。当有“每隔xx秒后执行yy操作”类似的需求的时候，想到使用interval"></a>使用interval做周期性操作。当有“每隔xx秒后执行yy操作”类似的需求的时候，想到使用interval</h4><blockquote>
<p>例如：每隔2秒输出日志“helloworld”。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">interval</span>(<span class="number">2</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>)  </span><br><span class="line">            .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Observer</span>&lt;<span class="title class_">Long</span>&gt;() &#123;  </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;  </span><br><span class="line">                log.<span class="property">d</span> (<span class="string">&quot;completed&quot;</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">    </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;  </span><br><span class="line">                log.<span class="title function_">e</span>(<span class="string">&quot;error&quot;</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">    </span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Long <span class="built_in">number</span></span>) &#123;  </span><br><span class="line">                log.<span class="property">d</span> (<span class="string">&quot;hello world&quot;</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;);  </span><br></pre></td></tr></table></figure>
<h4 id="使用schedulePeriodically做轮询请求"><a href="#使用schedulePeriodically做轮询请求" class="headerlink" title="使用schedulePeriodically做轮询请求"></a>使用schedulePeriodically做轮询请求</h4><figure class="highlight d"><table><tr><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;  </span><br><span class="line">            <span class="keyword">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> call(<span class="keyword">final</span> Subscriber&lt;? <span class="keyword">super</span> String&gt; observer) &#123;  </span><br><span class="line">    </span><br><span class="line">                Schedulers.newThread().createWorker()  </span><br><span class="line">                        .schedulePeriodically(<span class="keyword">new</span> Action0() &#123;  </span><br><span class="line">                            <span class="keyword">@Override</span>  </span><br><span class="line">                            <span class="keyword">public</span> <span class="keyword">void</span> call() &#123;  </span><br><span class="line">                                observer.onNext(doNetworkCallAndGetStringResult());  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;, INITIAL_DELAY, POLLING_INTERVAL, TimeUnit.MILLISECONDS);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;).subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;  </span><br><span class="line">            <span class="keyword">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> call(String s) &#123;  </span><br><span class="line">                log.d(<span class="string">&quot;polling….”));  </span></span><br><span class="line"><span class="string">            &#125;  </span></span><br><span class="line"><span class="string">        &#125;)  </span></span><br></pre></td></tr></table></figure>

<h4 id="RxJava进行数组、list的遍历"><a href="#RxJava进行数组、list的遍历" class="headerlink" title="RxJava进行数组、list的遍历"></a>RxJava进行数组、list的遍历</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">String</span>[] names = &#123;<span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;Lily&quot;</span>, <span class="string">&quot;Alisa&quot;</span>, <span class="string">&quot;Sheldon&quot;</span>, <span class="string">&quot;Bill&quot;</span>&#125;;  </span><br><span class="line"><span class="title class_">Observable</span>  </span><br><span class="line">        .<span class="title function_">from</span>(names)  </span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Action1</span>&lt;<span class="title class_">String</span>&gt;() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params"><span class="built_in">String</span> name</span>) &#123;  </span><br><span class="line">                log.<span class="title function_">d</span>(name);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/19/Android-进阶之第三方库的介绍-RxJava-RxAndroid-六/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/19/Android-进阶之第三方库的介绍-RxJava-RxAndroid-六/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/18/Android-进阶之第三方库的介绍-RxJava-RxAndroid-五/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 五 [线程调度]" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 五 [线程调度]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-18T09:14:00.000Z" itemprop="datePublished"> Published 2016-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>“在不指定线程的情况下， RxJava 遵循的是线程不变的原则，即：在哪个线程调用 subscribe()，就在哪个线程生产事件；在哪个线程生产事件，就在哪个线程消费事件。如果需要切换线程，就需要用到 Scheduler （调度器）。”<br>（来自给 Android 开发者的 RxJava 详解）<br>Scheduler  的作用是用于指定某个代码逻辑应该运行在哪个线程。</p>
<h4 id="RxJava中的5种默认调度器"><a href="#RxJava中的5种默认调度器" class="headerlink" title="RxJava中的5种默认调度器"></a>RxJava中的5种默认调度器</h4><p>RxJava默认情况下提供了5种调度器：<br>.io()	</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">用于读写文件、读写数据库、网络信息交互等IO操作</span><br><span class="line">.io() <span class="keyword">is</span> backed by an unbounded thread-pool <span class="keyword">and</span> <span class="keyword">is</span> the sort of thing yo<span class="string">u&#x27;d use for non-computationally intensive tasks, that is stuff that doesn&#x27;</span>t put much load on the CPU. So yep interaction <span class="keyword">with</span> the file system, interaction <span class="keyword">with</span> databases <span class="keyword">or</span> services on a different host are good examples. </span><br><span class="line">创建一个用于IO操作的线程的调度器，内部实现机制是通过一个自动增长的线程池来实现的，这种机制可以用于异步操作阻塞IO工作，不要使用这个调度器来完成计算类工作，要完成计算类工作请使用computation()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>.computation() </p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">.computation() <span class="keyword">is</span> backed <span class="keyword">by</span> a bounded thread-pool <span class="keyword">with</span> size <span class="keyword">equal</span> <span class="keyword">to</span> <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> available processors. If you tried <span class="keyword">to</span> schedule cpu intensive work <span class="keyword">in</span> parallel across more than <span class="keyword">the</span> available processors (<span class="built_in">say</span> using newThread()) <span class="keyword">then</span> you are up <span class="keyword">for</span> thread creation overhead <span class="keyword">and</span> context switching overhead <span class="keyword">as</span> threads vie <span class="keyword">for</span> a processor <span class="keyword">and</span> <span class="keyword">it</span>&#x27;s potentially a big performance hit.</span><br><span class="line">这个调度器一般用于运行CPU密集型的计算任务，这些任务不会被IO等阻塞操作给阻塞，这个 Scheduler 使用大小为 CPU 核数的线程池来完成工作。同上面介绍的IO调度器一样，不要把 I/O 操作放在 computation() 中，否则 I/O 操作的等待时间会浪费 CPU。</span><br></pre></td></tr></table></figure>
<p>.immediate()	</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Creates <span class="keyword">and</span> <span class="keyword">returns</span> a Scheduler that executes <span class="keyword">work</span> immediately <span class="keyword">on</span> the <span class="keyword">current</span> thread.</span><br><span class="line">使用当前线程来完成任务，这是默认的 Scheduler。</span><br></pre></td></tr></table></figure>
<p>.newThread()	</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Creates <span class="keyword">and</span> returns <span class="keyword">a</span> Scheduler that creates <span class="keyword">a</span> <span class="built_in">new</span> Thread <span class="keyword">for</span> <span class="keyword">each</span> unit <span class="keyword">of</span> work.</span><br><span class="line">创建新线程，并在新线程执行操作。</span><br></pre></td></tr></table></figure>
<p>.trampoline()	</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Creates <span class="keyword">and</span> <span class="keyword">returns</span> a Scheduler that queues <span class="keyword">work</span> <span class="keyword">on</span> the <span class="keyword">current</span> thread <span class="keyword">to</span> be executed <span class="keyword">after</span> the <span class="keyword">current</span> <span class="keyword">work</span> completes.</span><br><span class="line">这种方式拥有一个队列，当我们想在当前线程执行一个任务，而是立即,我们可以先将这个任务存入队列，这个调度器将会按顺序运行队列中每一个任务。</span><br></pre></td></tr></table></figure>

<h4 id="为被观察者及订阅者指定线程"><a href="#为被观察者及订阅者指定线程" class="headerlink" title="为被观察者及订阅者指定线程"></a>为被观察者及订阅者指定线程</h4><p>要为某个任务指定运行在哪个线程可以使用subscribeOn() 和 observeOn()两个方法：<br>subscribeOn(): 指定 subscribe() 所发生的线程，即 Observable.OnSubscribe 被激活时所处的线程。或者叫做事件产生的线程。<br>observeOn(): 指定 Subscriber 所运行在的线程。或者叫做事件消费的线程。<br>这里大家可能会碰到一个 AndroidSchedulers.mainThread()，顾名思义它就是Android的主线程。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> drawableRes = <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>drawable.testImage；</span><br><span class="line">ImageView imageView = (ImageView)findview<span class="constructor">ById(R.<span class="params">id</span>.<span class="params">imageView</span>)</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Observable</span>.</span></span>create(<span class="keyword">new</span> OnSubscribe&lt;Drawable&gt;<span class="literal">()</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void call(Subscriber&lt;? super Drawable&gt; subscriber) &#123;</span><br><span class="line">        Drawable drawable = get<span class="constructor">Theme()</span>.get<span class="constructor">Drawable(<span class="params">drawableRes</span>)</span>);</span><br><span class="line">        subscriber.on<span class="constructor">Next(<span class="params">drawable</span>)</span>;</span><br><span class="line">        subscriber.on<span class="constructor">Completed()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>) </span><br><span class="line">.observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>) </span><br><span class="line">.subscribe(<span class="keyword">new</span> Observer&lt;Drawable&gt;<span class="literal">()</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Next(Drawable <span class="params">drawable</span>)</span> &#123;</span><br><span class="line">        imageView.set<span class="constructor">ImageDrawable(<span class="params">drawable</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Completed()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Error(Throwable <span class="params">e</span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>observeOn() 指定的是它之后的操作所运行的线程。因此如果有多次切换线程的需求，只要在每个想要切换线程的位置调用一次，和observeOn不同的是subscribeOn()只能调用一次。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Observable</span>.</span></span>from(testEventList) <span class="comment">// IO 线程，由 subscribeOn() 指定</span></span><br><span class="line">    .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">    .observe<span class="constructor">On(Schedulers.<span class="params">newThread</span>()</span>)</span><br><span class="line">    .flatmap(......) <span class="comment">// 新线程，由 observeOn() 指定</span></span><br><span class="line">    .observe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">    .map(.......) <span class="comment">// IO 线程，由 observeOn() 指定</span></span><br><span class="line">    .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>)</span> </span><br><span class="line">    .subscribe(subscriber);  <span class="comment">// 回到主线程</span></span><br></pre></td></tr></table></figure>

<p>在学习的期间我们会看到还有个比较有意思是方法-onBackpressureBuffer()<br>它将将告诉Observable发射的数据如果比观察者消费的数据要更快的话,它必须把它们存储在缓存中并提供一个合适的时间给它们。从而不会照成消费者的拥堵。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/18/Android-进阶之第三方库的介绍-RxJava-RxAndroid-五/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/18/Android-进阶之第三方库的介绍-RxJava-RxAndroid-五/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/17/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三-1/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 四 [事件源的组合]" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 四 [事件源的组合]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-17T03:42:24.000Z" itemprop="datePublished"> Published 2016-06-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <ul>
<li>Merege<br>Merge 操作能够将有多个事件源合并起来产生一个事件源，也就是多输入单输出系统。最后的结果就和一个事件源发出事件一样，Merge操作符，在使用的时候有两点需要注意：<br>和flatMap一样生成的数据源有可能会相互交错，并且当某一个Observable出错而导致发出onError的时候，merge的过程会被终止并将错误分发给订阅者，如果不想要在发生异常的时候中断merge，可以使用MeregeDelayError它在merge结束后再将数据分发出去。</li>
</ul>
<ol>
<li>Merege<br><img src="/2016/06/17/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89-1/merge.png"></li>
<li>mergeDelayError<br><img src="/2016/06/17/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89-1/mergedelayerror.png"><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Observable&lt;<span class="type">Integer</span>&gt; odds = Observable.just(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>).subscribeOn(someScheduler);</span><br><span class="line">Observable&lt;<span class="type">Integer</span>&gt; evens = Observable.just(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line">Observable.merge(odds, evens)</span><br><span class="line">          .subscribe(<span class="built_in">new</span> Subscriber&lt;<span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> onNext(<span class="type">Integer</span> item) &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;Next: &quot; + item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> onError(Throwable error) &#123;</span><br><span class="line">            <span class="keyword">System</span>.err.println(&quot;Error: &quot; + error.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> onCompleted() &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;Sequence complete.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>运行结果：</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">5</span></span><br><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">4</span></span><br><span class="line"><span class="built_in">Next</span><span class="operator">:</span> <span class="number">6</span></span><br><span class="line"><span class="built_in">Sequence</span> <span class="variable">complete</span><span class="operator">.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Zip<br><img src="/2016/06/17/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89-1/zip.png"></li>
</ul>
<p>Zip 允许接收多个事件源，并且将对应的事件通过一个方法处理后产生的结果添加到Observable中统一发布出去，这里需要注意的是最终的事件源个数取决于原始数据源中个数最少的那个，看下下面的例子：<br>事件源observable1 有20个事件，而observable2有10个事件，两个合成起来后最终产生的结果事件为10个。也就是最少的那个：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Observable&lt;<span class="type">Integer</span>&gt; observable1 = Observable.range(<span class="number">1</span>,<span class="number">20</span>);</span><br><span class="line">Observable&lt;<span class="type">Integer</span>&gt; observable2 = Observable.range(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">Observable.zip(observable1, observable2, <span class="built_in">new</span> Func2&lt;<span class="type">Integer</span>, <span class="type">Integer</span>, <span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">Integer</span> <span class="keyword">call</span>(<span class="type">Integer</span> <span class="type">integer</span>, <span class="type">Integer</span> integer2) &#123;</span><br><span class="line">        <span class="keyword">Log</span>.i(&quot;xiaohai.lin&quot;, <span class="type">integer</span>.toString() + &quot; + &quot; + integer2.toString() + &quot; = &quot; + (<span class="type">integer</span>.intValue() + integer2.intValue()));</span><br><span class="line">        <span class="keyword">return</span> <span class="type">integer</span>.intValue() + integer2.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="built_in">new</span> Action1&lt;<span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">call</span>(<span class="type">Integer</span> <span class="type">integer</span>) &#123;</span><br><span class="line">        <span class="keyword">Log</span>.i(&quot;xiaohai.lin&quot;, <span class="type">integer</span>.toString() + &quot; =================== &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span> + <span class="number">2</span> = <span class="number">4</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">4</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">3</span> + <span class="number">3</span> = <span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">6</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">246</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">4</span> + <span class="number">4</span> = <span class="number">8</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">8</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">5</span> + <span class="number">5</span> = <span class="number">10</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">10</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">6</span> + <span class="number">6</span> = <span class="number">12</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">12</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">7</span> + <span class="number">7</span> = <span class="number">14</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">14</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">8</span> + <span class="number">8</span> = <span class="number">16</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">16</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">9</span> + <span class="number">9</span> = <span class="number">18</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">18</span> =================== </span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">10</span> + <span class="number">10</span> = <span class="number">20</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">46</span>:<span class="number">16</span>.<span class="number">247</span> <span class="number">16854</span>-<span class="number">16854</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">20</span> =================== </span><br></pre></td></tr></table></figure>

<ul>
<li><p>CombineLatest<br><img src="/2016/06/17/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89-1/combine.png"><br> CombinLatest可以将多个数据源的最新(最后产生的数据)给组装起来，然然后发送出去.</p>
 <figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">Long</span>&gt; observable1 = <span class="title class_">Observable</span>.<span class="title function_">interval</span>(<span class="number">3</span>, <span class="variable constant_">SECONDS</span>);</span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">Long</span>&gt; observable2 = <span class="title class_">Observable</span>.<span class="title function_">interval</span>(<span class="number">1</span>, <span class="variable constant_">SECONDS</span>);</span><br><span class="line"><span class="title class_">Observable</span>.<span class="title function_">combineLatest</span>(observable1, observable2, <span class="keyword">new</span> <span class="title class_">Func2</span>&lt;<span class="title class_">Long</span>, <span class="title class_">Long</span>, <span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">call</span>(<span class="params">Long aLong, Long aLong2</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong + <span class="string">&quot; : aLong2 = &quot;</span> + aLong2);</span><br><span class="line">        <span class="keyword">return</span> (aLong+<span class="string">&quot;=====&quot;</span>+aLong2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params"><span class="built_in">String</span> s</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p> 运行结果如下所示：每次某个事件源有事件产生的时候，都会取另一个事件源的最新事件进行组合：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">23</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">0</span> : aLong2 = <span class="number">1</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">23</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">0</span>=====<span class="number">1</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">23</span>.<span class="number">432</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">0</span> : aLong2 = <span class="number">2</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">23</span>.<span class="number">432</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">0</span>=====<span class="number">2</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">24</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">0</span> : aLong2 = <span class="number">3</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">24</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">0</span>=====<span class="number">3</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">25</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">0</span> : aLong2 = <span class="number">4</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">25</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">0</span>=====<span class="number">4</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">26</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">0</span> : aLong2 = <span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">26</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">0</span>=====<span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">26</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">1</span> : aLong2 = <span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">26</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">1</span>=====<span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">27</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">1</span> : aLong2 = <span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">27</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">1</span>=====<span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">28</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">1</span> : aLong2 = <span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">28</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">1</span>=====<span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">29</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">2</span> : aLong2 = <span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">29</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4839</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span>=====<span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">29</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">2</span> : aLong2 = <span class="number">8</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">29</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span>=====<span class="number">8</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">30</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">2</span> : aLong2 = <span class="number">9</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">30</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span>=====<span class="number">9</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">31</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">2</span> : aLong2 = <span class="number">10</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">31</span>.<span class="number">430</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span>=====<span class="number">10</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">32</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: aLong = <span class="number">2</span> : aLong2 = <span class="number">11</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">37</span>:<span class="number">32</span>.<span class="number">431</span> <span class="number">4781</span>-<span class="number">4841</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span>=====<span class="number">11</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>StartWith</p>
</li>
</ul>
<p>StartWith操作符会在源事件源的前面插上事件后发送：</p>
<p><img src="/2016/06/17/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89-1/start.png"></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">Integer</span>&gt; observable1 = <span class="title class_">Observable</span>.<span class="title function_">range</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">Integer</span>&gt; observable2 = <span class="title class_">Observable</span>.<span class="title function_">range</span>(<span class="number">11</span>, <span class="number">20</span>);</span><br><span class="line">observable1.<span class="title function_">startWith</span>(observable2).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Integer o</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, o.<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">11</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">12</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">13</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">14</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">15</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">16</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">17</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">18</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">19</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">20</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">21</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">555</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">22</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">23</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">24</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">25</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">26</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">27</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">28</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">29</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">30</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">1</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">2</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">3</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">4</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">556</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">557</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">557</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">557</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">8</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">557</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">9</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">48</span>:<span class="number">12</span>.<span class="number">557</span> <span class="number">15979</span>-<span class="number">15979</span>/com.idealist.rxandroiddemo I/xiaohai.lin: <span class="number">10</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/17/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三-1/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/17/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三-1/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/16/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 三 [事件源的转换]" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 三 [事件源的转换]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-16T00:51:41.000Z" itemprop="datePublished"> Published 2016-06-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>前一篇博客我们介绍了如何对原始事件源进行过滤，这一篇我们将给大家介绍如何对事件源进行转换。什么是事件源转换？打个简单的比喻，我们原始事件源发出某个网站的站名，但是我们订阅者需要知道的是网站的地址，<br>这时候就可以通过事件源的转换来实现。</p>
<ul>
<li><p>Buffer<br>顾名思义，就是对事件源进行缓存，这里的缓存可以按照时间进行缓存，也可以按事件源个数进行缓存，缓存后将数据以数组集合的方式发送出去。<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/buffer.png"><br>方式一：<br>只是单纯的缓存，这里buffer方法只有一个参数，那就是缓存大小，下面例子中，该转换器集满5个事件后就以列表的形式发出。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">100</span>)<span class="selector-class">.buffer</span>(<span class="number">5</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;List&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(List&lt;Integer&gt; integers) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, integers.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>整个运行结果如下所示：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [6, 7, 8, 9, 10]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [11, 12, 13, 14, 15]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [16, 17, 18, 19, 20]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [21, 22, 23, 24, 25]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [26, 27, 28, 29, 30]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [31, 32, 33, 34, 35]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [36, 37, 38, 39, 40]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [41, 42, 43, 44, 45]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [46, 47, 48, 49, 50]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [51, 52, 53, 54, 55]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">191</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [56, 57, 58, 59, 60]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [61, 62, 63, 64, 65]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [66, 67, 68, 69, 70]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [71, 72, 73, 74, 75]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [76, 77, 78, 79, 80]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [81, 82, 83, 84, 85]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [86, 87, 88, 89, 90]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [91, 92, 93, 94, 95]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">12</span>:<span class="number">48</span>.<span class="number">192</span> <span class="number">25401</span>-<span class="number">25401</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [96, 97, 98, 99, 100]</span></span><br></pre></td></tr></table></figure>
<p>方式二：<br>每M个事件中抽取N个事件源，以列表的形式发出，比如下面的例子，从1到100，每隔10个事件源，在这10个事件源中发送前5个。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">100</span>)<span class="selector-class">.buffer</span>(<span class="number">5</span>, <span class="number">10</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;List&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onCompleted() &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onError(Throwable e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onNext(List&lt;Integer&gt; integers) &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, integers.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [11, 12, 13, 14, 15]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [21, 22, 23, 24, 25]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [31, 32, 33, 34, 35]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [41, 42, 43, 44, 45]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [51, 52, 53, 54, 55]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [61, 62, 63, 64, 65]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [71, 72, 73, 74, 75]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [81, 82, 83, 84, 85]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">11</span>:<span class="number">03</span>.<span class="number">886</span> <span class="number">23946</span>-<span class="number">23946</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [91, 92, 93, 94, 95]</span></span><br></pre></td></tr></table></figure>
<p>方式三：<br>在某个时间间隔内，缓存数据，时间一到就把缓存的数据以列表的形式发送出去：<br>下面事件源是一个每隔1秒的事件源，缓冲器是一个每隔4秒缓存一次的缓存器，到达4秒后将缓存数据发送出去：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.interval</span>(<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.buffer</span>(<span class="number">4</span>, TimeUnit.SECONDS)<span class="selector-class">.subscribe</span>(new Subscriber&lt;List&lt;Long&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(List&lt;Long&gt; longs) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, longs.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>下面是输出结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">01</span>.<span class="number">614</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [0, 1, 2]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">05</span>.<span class="number">611</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [3, 4, 5, 6]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">09</span>.<span class="number">612</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [7, 8, 9, 10]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">13</span>.<span class="number">611</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [11, 12, 13, 14]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">17</span>.<span class="number">612</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [15, 16, 17, 18]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">21</span>.<span class="number">611</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [19, 20, 21, 22]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">25</span>.<span class="number">611</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [23, 24, 25, 26]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">29</span>.<span class="number">612</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [27, 28, 29, 30]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">33</span>.<span class="number">611</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [31, 32, 33, 34]</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">19</span>:<span class="number">37</span>.<span class="number">612</span> <span class="number">31383</span>-<span class="number">31451</span>/com.idealist.rxandroiddemo I/xiaohai.lin:<span class="meta"> [35, 36, 37, 38]</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>Window<br>Window和上述的buffer类似，不同之处在于window是将数据源以一些小的Observable对象发送出去，这些小的Observable对象封装了每次缓冲的数据。<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/window.png"><br>方式一：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">10</span>)<span class="selector-class">.window</span>(<span class="number">3</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Observable&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(final Observable&lt;Integer&gt; integerObservable) &#123;</span><br><span class="line">        <span class="selector-tag">integerObservable</span><span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onCompleted() &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;-------------------------------------------------------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @<span class="selector-tag">Override</span></span><br><span class="line">            <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">onError</span>(Throwable e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onNext(Integer integer) &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;integer &quot;</span> + integer.toString() +<span class="string">&quot; : &quot;</span>+ integerObservable.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>下面是运行的结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">687</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">1</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">688</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">2</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">688</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">3</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">688</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">4</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">5</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">6</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">7</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">8</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">9</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">689</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">10</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">28</span>.<span class="number">701</span> <span class="number">12664</span>-<span class="number">12664</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">50</span>)<span class="selector-class">.window</span>(<span class="number">5</span>,<span class="number">10</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Observable&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(final Observable&lt;Integer&gt; integerObservable) &#123;</span><br><span class="line">        <span class="selector-tag">integerObservable</span><span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onCompleted() &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;-------------------------------------------------------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @<span class="selector-tag">Override</span></span><br><span class="line">            <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">onError</span>(Throwable e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onNext(Integer integer) &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;integer &quot;</span> + integer.toString() +<span class="string">&quot; : &quot;</span>+ integerObservable.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">1</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">2</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">3</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">4</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">5</span> : rx.internal.operators.UnicastSubject@c9c87a</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">413</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">414</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">11</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">414</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">12</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">414</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">13</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">414</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">14</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">414</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">15</span> : rx.internal.operators.UnicastSubject@<span class="number">95</span>bb82b</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">21</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">22</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">23</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">24</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">25</span> : rx.internal.operators.UnicastSubject@a6cb488</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">31</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">32</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">33</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">415</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">34</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">35</span> : rx.internal.operators.UnicastSubject@<span class="number">87</span>a7e21</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">41</span> : rx.internal.operators.UnicastSubject@d1bf246</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">42</span> : rx.internal.operators.UnicastSubject@d1bf246</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">43</span> : rx.internal.operators.UnicastSubject@d1bf246</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">44</span> : rx.internal.operators.UnicastSubject@d1bf246</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: integer <span class="number">45</span> : rx.internal.operators.UnicastSubject@d1bf246</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">17</span>.<span class="number">416</span> <span class="number">19057</span>-<span class="number">19057</span>/com.idealist.rxandroiddemo I/xiaohai.lin: -------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>方式三：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.interval</span>(<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.window</span>(<span class="number">3</span>, TimeUnit.SECONDS)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Observable&lt;Long&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Observable&lt;Long&gt; longObservable) &#123;</span><br><span class="line">        <span class="selector-tag">longObservable</span><span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onCompleted() &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,<span class="string">&quot;=====================================&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            @<span class="selector-tag">Override</span></span><br><span class="line">            <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">onError</span>(Throwable e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void onNext(Long aLong) &#123;</span><br><span class="line">                <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,<span class="string">&quot;times = &quot;</span>+aLong);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">40</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">0</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">41</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">1</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">42</span>.<span class="number">815</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">42</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">2</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">43</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">3</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">44</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">4</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">45</span>.<span class="number">815</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">45</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">5</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">46</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">47</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">7</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">48</span>.<span class="number">816</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">48</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">8</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">49</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">9</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">50</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">10</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">51</span>.<span class="number">815</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">51</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">11</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">52</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">12</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">53</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">13</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">54</span>.<span class="number">816</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">54</span>.<span class="number">819</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">14</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">55</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">15</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">56</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">16</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">57</span>.<span class="number">815</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">57</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">17</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">58</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">18</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">59</span>.<span class="number">818</span> <span class="number">22345</span>-<span class="number">22431</span>/com.idealist.rxandroiddemo I/xiaohai.lin: times = <span class="number">19</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">00</span>.<span class="number">815</span> <span class="number">22345</span>-<span class="number">22430</span>/com.idealist.rxandroiddemo I/xiaohai.lin: =====================================</span><br></pre></td></tr></table></figure>

</li>
<li><p>Map<br>Map 转换一般用在将原始数据源的每个事件，一个个进行处理后，发送出去，它对数据的转化是直接进行的和后面将要介绍的FlatMap是有一定的区别的，FlatMap 是通过Observables过渡的会产生中间Observables：<br>下面的例子是一个获取手机中的Apk包名然后将其转换为大写的例子，它是一个个直接进行转换的。<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/map.png"></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">final <span class="title class_">Intent</span> mainIntent = <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="title class_">Intent</span>.<span class="property">ACTION_MAIN</span>);</span><br><span class="line">mainIntent.<span class="title function_">addCategory</span>(<span class="title class_">Intent</span>.<span class="property">CATEGORY_LAUNCHER</span>);</span><br><span class="line"><span class="title class_">List</span>&lt;<span class="title class_">ResolveInfo</span>&gt; activityInfoList = <span class="title function_">getPackageManager</span>().<span class="title function_">queryIntentActivities</span>(mainIntent, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Observable</span>.<span class="title function_">from</span>(activityInfoList).<span class="title function_">map</span>(<span class="keyword">new</span> <span class="title class_">Func1</span>&lt;<span class="title class_">ResolveInfo</span>, <span class="title class_">ResolveInfo</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ResolveInfo</span> <span class="title function_">call</span>(<span class="params">ResolveInfo resolveInfo</span>) &#123;</span><br><span class="line">        resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span> = resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span>.<span class="title function_">toUpperCase</span>();</span><br><span class="line">        <span class="keyword">return</span> resolveInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">ResolveInfo</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable throwable</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">ResolveInfo resolveInfo</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>下面是输出的结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.CONTACTS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.DIALER</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.MMS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.VENDING</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.SETTINGS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.CALENDAR</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.MEDIATEK.CAMERA</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.CHROME</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.DESKCLOCK</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.APPS.DOCS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.GM</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.TALK</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.MUSIC</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.APPS.PHOTOS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.YOUTUBE</span><br></pre></td></tr></table></figure>
</li>
<li><p>FlatMap</p>
</li>
</ul>
<p>和Map一样都是能够将原始数据转换后将其发送出去，但是它是将原始的Observable转换成另外一个Observable后将其以Observable形式发送出去。<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/flatmap.png"><br>下面是Map和Flatmap的区别：[来自网上]<br>Map是在一个item被发射之后，到达Map处经过转换变成另一个item，然后继续往下走；<br>flapMap是item被发射之后，到达flatMap 处经过转换变成一个Observable，而这个Observable并不会直接被发射出去，而是会立即被激活，然后把它发射出的每个 item 都传入流中，再继续走下去。<br>所以 flatMap 和 map 有两个区别：<br>经过 Observable 的转换，相当于重新开了一个异步的流；<br>item 被分散了，个数发生了变化。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">final <span class="title class_">Intent</span> mainIntent = <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="title class_">Intent</span>.<span class="property">ACTION_MAIN</span>);</span><br><span class="line">mainIntent.<span class="title function_">addCategory</span>(<span class="title class_">Intent</span>.<span class="property">CATEGORY_LAUNCHER</span>);</span><br><span class="line"><span class="title class_">List</span>&lt;<span class="title class_">ResolveInfo</span>&gt; activityInfoList = <span class="title function_">getPackageManager</span>().<span class="title function_">queryIntentActivities</span>(mainIntent, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Observable</span>.<span class="title function_">from</span>(activityInfoList).<span class="title function_">flatMap</span>(<span class="keyword">new</span> <span class="title class_">Func1</span>&lt;<span class="title class_">ResolveInfo</span>, <span class="title class_">Observable</span>&lt;<span class="title class_">ResolveInfo</span>&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Observable</span>&lt;<span class="title class_">ResolveInfo</span>&gt; <span class="title function_">call</span>(<span class="params">ResolveInfo resolveInfo</span>) &#123;</span><br><span class="line">        resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span> = resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span>.<span class="title function_">toUpperCase</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Observable</span>.<span class="title function_">just</span>(resolveInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">ResolveInfo</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">ResolveInfo resolveInfo</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下面是输出的结果：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.CONTACTS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.DIALER</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.MMS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.VENDING</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.SETTINGS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.CALENDAR</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">200</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.MEDIATEK.CAMERA</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.CHROME</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.ANDROID.DESKCLOCK</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.APPS.DOCS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.GM</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.TALK</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.MUSIC</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.APPS.PHOTOS</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">14</span>.<span class="number">201</span> <span class="number">10071</span>-<span class="number">10071</span>/com.idealist.rxandroiddemo I/xiaohai.lin: COM.GOOGLE.ANDROID.YOUTUBE</span><br></pre></td></tr></table></figure>
<ul>
<li><p>concatMap<br>flatMap()与concatMap()大体的行为是一致的，但是flatMap()可能交错的发送事件，最终结果的顺序可能并是不原始Observable发送时的顺序。这有可能会带来严重的影响，比如我们要计算1到100的每10个元素分成一组，计算每组的和，但是如果有交错发生，<br>这样每组计算的和和我们期望的将会差别很大，这时候就可以使用与之类似的concatMap()操作符来避免数据的交错发生。</p>
</li>
<li><p>SwitchMap<br>switchMap()和flatMap()大体的行为是一致的,除了一点:当原始Observable发射一个新的数据(Observable)时,它将取消订阅并停止监视之前那个数据的Observable产生的Observable,并开始监视当前这一个。</p>
</li>
<li><p>Cast<br>Cast将Observable发射的数据强制转化为另外一种类型，这个用得比较少，在这里先不做介绍：</p>
</li>
<li><p>GroupBy</p>
</li>
</ul>
<p>GroupBy操作符将原始事件源的数据按照key来拆分成一些小的Observable，拆封规则在groupBy中实现，然后将这些同组的事件源封装成一个Observable，再将这些事件源一组一组发送出去：<br>下面的例子将会扫描手机中的apk包名，将其按照报名的前两个前缀分组，并统计每个类别的应用的数量：<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/group.png"></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">final <span class="title class_">Intent</span> mainIntent = <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="title class_">Intent</span>.<span class="property">ACTION_MAIN</span>);</span><br><span class="line">    mainIntent.<span class="title function_">addCategory</span>(<span class="title class_">Intent</span>.<span class="property">CATEGORY_LAUNCHER</span>);</span><br><span class="line">    final <span class="title class_">List</span>&lt;<span class="title class_">ResolveInfo</span>&gt; activityInfoList = <span class="title function_">getPackageManager</span>().<span class="title function_">queryIntentActivities</span>(mainIntent, <span class="number">0</span>);</span><br><span class="line">    <span class="title class_">Observable</span>.<span class="title function_">from</span>(activityInfoList).<span class="title function_">groupBy</span>(<span class="keyword">new</span> <span class="title class_">Func1</span>&lt;<span class="title class_">ResolveInfo</span>, <span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">call</span>(<span class="params">ResolveInfo resolveInfo</span>) &#123;</span><br><span class="line">            <span class="title class_">String</span> packageName = resolveInfo.<span class="property">activityInfo</span>.<span class="property">packageName</span>;</span><br><span class="line">            <span class="keyword">return</span> packageName.<span class="title function_">substring</span>(<span class="number">0</span>,packageName.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">GroupedObservable</span>&lt;<span class="title class_">String</span>, <span class="title class_">ResolveInfo</span>&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">final GroupedObservable&lt;<span class="built_in">String</span>, ResolveInfo&gt; stringResolveInfoGroupedObservable</span>) &#123;</span><br><span class="line">            stringResolveInfoGroupedObservable.<span class="title function_">count</span>().<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Integer integer</span>) &#123;</span><br><span class="line">                    <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, stringResolveInfoGroupedObservable.<span class="title function_">getKey</span>() + <span class="string">&quot;  Contain :&quot;</span> + integer.<span class="title function_">toString</span>() + <span class="string">&quot;  elemnts&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">672</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com  Contain :<span class="number">4</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.flysnow  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.qihoo360  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.everimaging  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.android  Contain :<span class="number">9</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.jianshu  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.sohu.inputmethod  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: io.manong  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.google.android  Contain :<span class="number">7</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.foxit.mobile.pdf  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">674</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.alcatel  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.liangfeizc  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.emoji.keyboard  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.tencent  Contain :<span class="number">3</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.baozou.baozou  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.antonioleiva  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.alpha  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.jrdcom  Contain :<span class="number">3</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.douban  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.zhihu  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.baidu  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.facebook  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: vStudio.Android  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">675</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.ss.android.article  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.android.providers.downloads  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: cn.wps  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.netease  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.ticktick  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.codoon  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.tct  Contain :<span class="number">6</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.google.android.apps  Contain :<span class="number">3</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.dajie  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.tcl  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.idealist  Contain :<span class="number">3</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">676</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.baozoumanhua  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">677</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.hitherejoe  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">677</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.mediatek  Contain :<span class="number">1</span>  elemnts</span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">20</span>.<span class="number">677</span> <span class="number">15638</span>-<span class="number">15638</span>/com.idealist.rxandroiddemo I/xiaohai.lin: com.chinamworld  Contain :<span class="number">1</span>  elemnts</span><br></pre></td></tr></table></figure>

<ul>
<li>Scan<br>Scan操作符用于对一个序列的数据应用一个函数，将函数返回值作为下一个引用这个函数时候的第一个参数使用。<br><img src="/2016/06/16/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%B8%89/scan.png"><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Observable.range(<span class="number">1</span>, <span class="number">10</span>).scan(<span class="built_in">new</span> Func2&lt;<span class="type">Integer</span>, <span class="type">Integer</span>, <span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">Integer</span> <span class="keyword">call</span>(<span class="type">Integer</span> <span class="type">integer</span>, <span class="type">Integer</span> integer2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">integer</span>.intValue() + integer2.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="built_in">new</span> Subscriber&lt;<span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> onError(Throwable e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> onNext(<span class="type">Integer</span> <span class="type">integer</span>) &#123;</span><br><span class="line">        <span class="keyword">Log</span>.i(&quot;xiaohai.lin&quot;, &quot;====&quot; + <span class="type">integer</span>.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
下面是运行的结果，这个例子实际上是求1到10的整数和：<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">484</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">1</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">484</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">3</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">484</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">6</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">484</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">10</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">15</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">21</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">28</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">36</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">45</span></span><br><span class="line"><span class="attribute">05</span>-<span class="number">22</span> <span class="number">10</span>:<span class="number">40</span>:<span class="number">26</span>.<span class="number">485</span> <span class="number">1639</span>-<span class="number">1639</span>/com.idealist.rxandroiddemo I/xiaohai.lin: ====<span class="number">55</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/16/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/16/Android-进阶之第三方库的介绍-RxJava-RxAndroid-三/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/15/Android-进阶之第三方库的介绍-RxJava-RxAndroid-二/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 二 [事件源的过滤]" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 二 [事件源的过滤]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-14T17:51:39.000Z" itemprop="datePublished"> Published 2016-06-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>上一篇博文我们已经介绍了事件源的生成方法，介绍了8种事件源，但是这些事件源只是一些基本的事件源，一般都是触发我们需要事件的触发器，比如我们需要定时刷新网络，那么我们需要使用到interval作为原始的事件源，<br>但是我们一般会在这个事件源的基础上作一定的处理，而对事件源的过滤也属于这些过滤中的一种，在本篇博文中我们就来学习下这些事件源的过滤方法：</p>
<ul>
<li><p>Filter<br>filter()方法根据我们传入的判决方法过滤我们不想要的值.<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/filter.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.timer</span>(<span class="number">10</span>,<span class="number">1</span>, TimeUnit.SECONDS)</span><br><span class="line">     <span class="selector-class">.filter</span>(new Func1&lt;Long, Boolean&gt;() &#123;</span><br><span class="line">        <span class="variable">@Override</span></span><br><span class="line">        public Boolean call(Long aLong) &#123;</span><br><span class="line">            <span class="selector-tag">return</span> (aLong % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long aLong) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个方法返回true的事件将会被选中留下。</p>
</li>
<li><p>Take<br>只接收从原始事件源发出的前N个元素。<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/take.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.timer</span>(<span class="number">10</span>,<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.take</span>(<span class="number">10</span>)</span><br><span class="line"><span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long aLong) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>TakeLast<br>只接收从原始事件源发出的最后N个元素<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/takelast.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">10</span>,<span class="number">100</span>)<span class="selector-class">.takeLast</span>(<span class="number">10</span>)</span><br><span class="line"><span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Skip<br>忽略从原始事件源发出的前N个元素。<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/skip.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.interval</span>(<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.skip</span>(<span class="number">10</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long aLong) &#123;</span><br><span class="line">       <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>SkipLast<br>忽略从原始事件源发出的最后N个元素<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/skiplast.png"></p>
</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>,<span class="number">100</span>)<span class="selector-class">.skipLast</span>(<span class="number">10</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>Fist , Last , firstOrDefault , lastOrDefault</li>
</ul>
<p>first()	 : 只留下原始数据源的第一个元素<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/first.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">10</span>)<span class="selector-class">.first</span>()<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>last()	 : 只留下原始数据源的最后一个元素<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/last.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">10</span>)<span class="selector-class">.last</span>()<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>firstOrDefault()：当事件源不存在的时候指定发射一个默认的值<br>lastOrDefault() : 当事件源不存在的时候指定发射一个默认的值</p>
<ul>
<li><p>ElementAt  ElementAtOrDefault<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/elementat.png"><br>ElementAt 返回第N个元素。<br>ElementAtOrDefault  返回第N个元素如果没有指定的元素将用某个默认值来替代</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">100</span>)<span class="selector-class">.elementAt</span>(<span class="number">50</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">100</span>)<span class="selector-class">.elementAtOrDefault</span>(<span class="number">1000</span>,<span class="number">500</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Timeout<br>这个更好理解了，它一般用于对时效性有要求的事件。在超过规定时间如果没有完成则会调用onError方法。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">interval</span>(<span class="number">3</span>,<span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>).<span class="title function_">timeout</span>(<span class="number">1</span>,<span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">Long</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable throwable</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;Time out Error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Long aLong</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>Distinct distinctUntilChanged<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/distinct.png"><br>distinct()  根据字面意思很好理解就是对原始事件源过滤处理只剩下不重复的元素<br>distinctUntilChanged() 这个可以让我们忽略掉重复的值只有在事件源的值发生改变时才会通过过滤器</p>
</li>
<li><p>Sampling<br>这个按照字面值也很好理解，就是采样的意思，比如一个事件源是按照每秒发布一次数据，但是我们实际只需要30秒采样一次样本数据，这种情况就可以使用Sampling进行处理。<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/sample.png"></p>
</li>
<li><p>Debounce<br>过滤掉由Observable发射的速率过快的数据;如果在一个指定的时间间隔过去了仍旧没有发射一个,那么它将发射最后的那个。<br><img src="/2016/06/15/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava-RxAndroid-%E4%BA%8C/debounce.png"></p>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/15/Android-进阶之第三方库的介绍-RxJava-RxAndroid-二/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/15/Android-进阶之第三方库的介绍-RxJava-RxAndroid-二/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/14/Android-进阶之第三方库的介绍-RxJava/" title="Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 一 [事件源Observable]" itemprop="url">Android 进阶之第三方库的介绍 RxJava &amp;&amp; RxAndroid 一 [事件源Observable]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-14T14:48:19.000Z" itemprop="datePublished"> Published 2016-06-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/rx.png"></p>
<ul>
<li>什么是RxJava<br>RxJava其实就是一个异步的解决方案，是Android中AsyncTask 以及Thread + Handle的替代方案。</li>
<li>为什么要采用RxJava而不用AsyncTask 以及Thread + Handle？<br>因为它随着程序逻辑变得越来越复杂，依然能够保持简洁。而这些正是Thread + Handler 以及AsyncTask 很难做到的，因为当逻辑一多的时候难保证不会出现嵌套。一嵌套整个代码结构就显得很乱。<br>而RxJava是基于序列的，最重要的是两个元素Observable被观察对象，Subscriber事件订阅者，Observable是整个事件的源头，产生原始信息，然后再使用各种操作符建立起链式关系，整个过程就和一条流水线一样把原始数据经过层层加工，过滤最后发送给Subscriber。</li>
<li>如何引入到Android studio中：<br>只需要在module的build.gradle 中添加如下两个依赖关系语句即可：<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">compile</span> &#x27;io.reactivex:rxandroid:<span class="number">1</span>.<span class="number">2</span>.<span class="number">0</span>&#x27;</span><br><span class="line"><span class="attribute">compile</span> &#x27;io.reactivex:rxjava:<span class="number">1</span>.<span class="number">1</span>.<span class="number">5</span>&#x27;</span><br></pre></td></tr></table></figure>
<h5 id="Hello-RxJava"><a href="#Hello-RxJava" class="headerlink" title="Hello RxJava"></a>Hello RxJava</h5></li>
</ul>
<p>我们首先先建立一个Hello RxJava的例子，让大家有个简单的认识:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//创建一个事件源，在事件源中调用每个订阅者的对应响应</span></span><br><span class="line"><span class="title class_">Observable</span>&lt;<span class="title class_">String</span>&gt; stringObservable = <span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="keyword">new</span> <span class="title class_">Observable</span>.<span class="property">OnSubscribe</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params">Subscriber&lt;? <span class="variable language_">super</span> <span class="built_in">String</span>&gt; subscriber</span>) &#123;</span><br><span class="line">        subscriber.<span class="title function_">onNext</span>(<span class="string">&quot;Hello RxJava&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建一个订阅者，实现每个事件节点的响应</span></span><br><span class="line"><span class="title class_">Subscriber</span>&lt;<span class="title class_">String</span>&gt; subscriber = <span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">String</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,<span class="string">&quot;onCompleted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable throwable</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,<span class="string">&quot;onError&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params"><span class="built_in">String</span> s</span>) &#123;</span><br><span class="line">        <span class="title class_">Log</span>.<span class="title function_">i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,<span class="string">&quot;onNext :=&quot;</span> +s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//事件源接受订阅者的订阅</span></span><br><span class="line">stringObservable.<span class="title function_">subscribe</span>(subscriber);</span><br></pre></td></tr></table></figure>
<p>输出结果就是：Hello RxJava。但是这里并没有涉及到事件源的处理，在接下来的章节中将陆续对事件源的创建，订阅者，以及事件处理这些部分展开介绍。</p>
<h4 id="RxJava-事件源介绍："><a href="#RxJava-事件源介绍：" class="headerlink" title="RxJava 事件源介绍："></a>RxJava 事件源介绍：</h4><h5 id="Create"><a href="#Create" class="headerlink" title="* Create"></a>* Create</h5><p>这个是最基本的方法，它没有任何的特效，但是它也是最灵活的，调用传入的Subscriber的onComplete，onError,onNext 来实现自己想要的事件源：<br>下面是Create操作符号的时序图：<br><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/create.png"><br>下面是一个实际的例子：<br>这些都来自官网：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="keyword">new</span> <span class="title class_">Observable</span>.<span class="property">OnSubscribe</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">call</span>(<span class="params">Subscriber&lt;? <span class="variable language_">super</span> Integer&gt; observer</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!observer.<span class="title function_">isUnsubscribed</span>()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (int i = <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    observer.<span class="title function_">onNext</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">                observer.<span class="title function_">onCompleted</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            observer.<span class="title function_">onError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125; ).<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Integer item</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Next: &quot;</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable error</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">err</span>.<span class="title function_">println</span>(<span class="string">&quot;Error: &quot;</span> + error.<span class="title function_">getMessage</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Sequence complete.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>我们来分析下上面的代码：<br>这里会调用Observable.create并传入OnSubscribe 对象，其中call方法的参数Subscriber其实就是它的订阅者，在有订阅者订阅这个被观察对象的时候，它就会被传入，Observerable首先判断下当前订阅者是否还在订阅自己，如果还继续订阅则向订阅者发送0-5的数字，然后调用onCompleted方法，宣告整个过程完毕，整个过程的核心是Subscriber的onNext&#x2F;onComplete&#x2F;onError方法。onNext就是发射处理好的数据给Subscriber， onComplete一般在结束事件源的时候告诉Subscriber所有的数据都已发射完毕；onError是在发生错误的时候发射一个Throwable对象给Subscriber。<br>一般Observable必须调用所有的Subscriber的onComplete方法，并且一般只能调用一次，onError方法也类似，一般发生出错的时候被调用，调用后一般就停止执行任何其他操作。</p>
<h5 id="Just"><a href="#Just" class="headerlink" title="* Just"></a>* Just</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/just.png"><br>Just可以接受最多9个参数，它将这一系列的对象作为一个整体发送出去，这些对象可以是一个数字、一个字符串、数组、Iterate对象等。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Observable</span>.<span class="title function_">just</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">          .<span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;<span class="title class_">Integer</span>&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">Integer item</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Next: &quot;</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable error</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">err</span>.<span class="title function_">println</span>(<span class="string">&quot;Error: &quot;</span> + error.<span class="title function_">getMessage</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Sequence complete.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="From"><a href="#From" class="headerlink" title="* From"></a>* From</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/from.png"></p>
<p>From操作符用来将传入的参数内容拆封开来，依次将其内容发射出去。它和just的区别在于，但是just将对象整个发射出去。而from会将对象拆封开来一次一次发送，比如说一个含有100个数字的数组，使用from就会发射100次，而使用just则一次将整个数组发送出去。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span>[] items = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">Observable myObservable = Observable.<span class="keyword">from</span>(items);</span><br><span class="line"></span><br><span class="line">myObservable.subscribe(</span><br><span class="line">    <span class="built_in">new</span> Action1&lt;<span class="type">Integer</span>&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">call</span>(<span class="type">Integer</span> item) &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">new</span> Action1&lt;Throwable&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">call</span>(Throwable error) &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;Error encountered: &quot; + error.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">new</span> Action0() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">call</span>() &#123;</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;Sequence complete&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h5 id="Defer"><a href="#Defer" class="headerlink" title="* Defer"></a>* Defer</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/defer.png"><br>Defer操作符每次订阅都会得到一个刚创建的最新的Observable对象，从而确保了每次订阅者订阅到的Observable对象里的数据都是最新的。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.defer</span>(new Func0&lt;Observable&lt;Long&gt;&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public Observable&lt;Long&gt; call() &#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">Observable</span><span class="selector-class">.just</span>(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;&#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long t) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;&quot;</span>+t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Interval"><a href="#Interval" class="headerlink" title="* Interval"></a>* Interval</h5><p>这个事件源会在一定的时间间隔后产生一个从0开始的数字。<br><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/interval.png"></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.interval</span>(<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long aLong) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;Current Time = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的例子会间隔1秒时间发射一个数字。这个数值会传递到订阅者的onNext方法中。</p>
<h5 id="Range"><a href="#Range" class="headerlink" title="* Range"></a>* Range</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/range.png"><br>这个事件源可以产生一定范围的数值。需要传入两个表示范围的参数。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.range</span>(<span class="number">4</span>, <span class="number">20</span>)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Integer integer) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>,String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Repeat"><a href="#Repeat" class="headerlink" title="* Repeat"></a>* Repeat</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/repeat.png"><br>这个一般用在某个事件源中，使用repeat后会将原事件源重复一定的次数。</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">Intent</span> mainIntent = new <span class="keyword">Intent</span>(<span class="keyword">Intent</span>.ACTION_MAIN);</span><br><span class="line">mainIntent.addCategory(<span class="keyword">Intent</span>.CATEGORY_LAUNCHER);</span><br><span class="line">List&lt;ResolveInfo&gt; activityInfoList = getPackageManager().queryIntentActivities(mainIntent, <span class="number">0</span>);</span><br><span class="line">Observable.from(activityInfoList).<span class="built_in">repeat</span>(<span class="number">2</span>).subscribe(new Action1&lt;ResolveInfo&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> void <span class="keyword">call</span>(ResolveInfo resolveInfo) &#123;</span><br><span class="line">        <span class="built_in">Log</span>.i(<span class="string">&quot;xiaohai.lin&quot;</span>,resolveInfo.activityInfo.<span class="keyword">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Timmer"><a href="#Timmer" class="headerlink" title="* Timmer"></a>* Timmer</h5><p><img src="/2016/06/14/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-RxJava/timmer.png"><br>这个是在一定的时间间隔之后产生定时周期的事件源。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.timer</span>(<span class="number">10</span>,<span class="number">1</span>, TimeUnit.SECONDS)<span class="selector-class">.subscribe</span>(new Subscriber&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onCompleted() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onError(Throwable throwable) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void onNext(Long aLong) &#123;</span><br><span class="line">        <span class="selector-tag">Log</span><span class="selector-class">.i</span>(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;aLong = &quot;</span> + aLong);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>RxAndroid &amp;&amp; RxJava Github地址</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ReactiveX/</span>RxAndroid  </span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ReactiveX/</span>RxJava </span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/14/Android-进阶之第三方库的介绍-RxJava/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/14/Android-进阶之第三方库的介绍-RxJava/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/13/Android-进阶之第三方库的介绍-Retrofit/" title="Android 进阶之第三方库的介绍 Retrofit" itemprop="url">Android 进阶之第三方库的介绍 Retrofit</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-13T14:48:29.000Z" itemprop="datePublished"> Published 2016-06-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="简单应用实例："><a href="#简单应用实例：" class="headerlink" title="简单应用实例："></a>简单应用实例：</h4><p>在介绍如何使用Retrofit之前先做点准备。首先要有个开放的API供我们使用网络去获取信息，接下来的例子将使用OpenWeather来练习下，如下是openWeather的地址：<br><a target="_blank" rel="noopener" href="http://openweathermap.org/">http://openweathermap.org/</a><br>和众多的API一样都需要申请一个开发者的key，申请key的过程就不在这里介绍了。</p>
<ol>
<li>在AS中引入RxJava + Retrofix</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">&quot;23.0.3&quot;</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.idealist.doumusic&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">23</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">&#x27;libs&#x27;</span>, <span class="keyword">include</span>: [<span class="string">&#x27;*.jar&#x27;</span>])</span><br><span class="line">    testCompile <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.android.support:appcompat-v7:23.3.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.android.support:design:23.3.0&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;io.reactivex:rxjava:1.1.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;io.reactivex:rxandroid:1.1.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:adapter-rxjava:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:retrofit:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.google.code.gson:gson:2.6.2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>开始我们先创建一个接口,关键部分先留空，后面我带大家一点一点往上面填：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDouMusic</span> &#123;</span><br><span class="line">    @GET(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="function">Callback&lt;WheatherResult&gt; <span class="title">getWheatherResult</span>()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先到这一步大家一定都申请了对应的APPID，也就是对应的APIkey，类似f8d8ead8299f963abcded5c40c0bcb81<br>找不到申请地方的我这里贴个地址：<a target="_blank" rel="noopener" href="http://openweathermap.org/appid">http://openweathermap.org/appid</a><br>申请到APPID后怎么使用呢？整个模板是这样的，只要在最后的申请后面添加APIKEY即可<br><a target="_blank" rel="noopener" href="http://api.openweathermap.org/data/2.5/forecast/city?id=524901&amp;APPID=%7BAPIKEY%7D">http://api.openweathermap.org/data/2.5/forecast/city?id=524901&amp;APPID={APIKEY}</a><br>前面的又是什么呢？大家进入这个页面<a target="_blank" rel="noopener" href="http://openweathermap.org/api">http://openweathermap.org/api</a>  这里面有很多的查询方案，作为例子我们选个简单的，当前的天气情况：<br><a target="_blank" rel="noopener" href="http://openweathermap.org/current">http://openweathermap.org/current</a> 这里提供了很多的查询方式，可以按照城市名，城市id等信息查询。<br>你不知道城市id怎么表示？可以到这个地方下载city.list.json 查询 <a target="_blank" rel="noopener" href="http://bulk.openweathermap.org/sample/">http://bulk.openweathermap.org/sample/</a><br>比如我们以广东惠州为例，查询当天天气，那么访问的地址应该是：<a target="_blank" rel="noopener" href="http://api.openweathermap.org/data/2.5/weather?q=Huizhou&amp;APPID=f8d8ead8299f963abcded5c40c0bcb81">http://api.openweathermap.org/data/2.5/weather?q=Huizhou&amp;APPID=f8d8ead8299f963abcded5c40c0bcb81</a><br>注意这里的APIKey需要换成大家自己申请的。将上述的地址拷贝到浏览器上这时候就会返回下面信息：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;coord&quot;: &#123;</span><br><span class="line">        &quot;lon&quot;: <span class="number">114.4</span>,</span><br><span class="line">        <span class="string">&quot;lat&quot;</span>: <span class="number">23.08</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;weather&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: <span class="number">802</span>,</span><br><span class="line">            <span class="string">&quot;main&quot;</span>: <span class="string">&quot;Clouds&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;scattered clouds&quot;</span>,</span><br><span class="line">            <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;03n&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;base&quot;: <span class="string">&quot;stations&quot;</span>,</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: &#123;</span><br><span class="line">        &quot;temp&quot;: <span class="number">300.93</span>,</span><br><span class="line">        <span class="string">&quot;pressure&quot;</span>: <span class="number">995</span>,</span><br><span class="line">        <span class="string">&quot;humidity&quot;</span>: <span class="number">49</span>,</span><br><span class="line">        <span class="string">&quot;temp_min&quot;</span>: <span class="number">300.93</span>,</span><br><span class="line">        <span class="string">&quot;temp_max&quot;</span>: <span class="number">300.93</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;wind&quot;: &#123;</span><br><span class="line">        &quot;speed&quot;: <span class="number">1.03</span>,</span><br><span class="line">        <span class="string">&quot;gust&quot;</span>: <span class="number">7.71</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rain&quot;: &#123;&#125;,</span><br><span class="line">    &quot;clouds&quot;: &#123;</span><br><span class="line">        &quot;<span class="attribute">all</span>&quot;: <span class="number">48</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;<span class="selector-tag">dt</span>&quot;: <span class="number">1463923088</span>,</span><br><span class="line">    <span class="string">&quot;sys&quot;</span>: &#123;</span><br><span class="line">        &quot;type&quot;: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">187827</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="number">0.0145</span>,</span><br><span class="line">        <span class="string">&quot;country&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sunrise&quot;</span>: <span class="number">1463866709</span>,</span><br><span class="line">        <span class="string">&quot;sunset&quot;</span>: <span class="number">1463914799</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;id&quot;: <span class="number">1806776</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Huizhou&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cod&quot;</span>: <span class="number">200</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OK，到这一步我们来实现这个功能：<br>由于要访问到网络所以需要添加网络访问权限：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>紧接着完善刚刚提到的那个接口：<br>为什么是@GET(“weather”)？ 我们上面提到要访问的地址为：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>api.openweathermap.org<span class="regexp">/data/</span><span class="number">2.5</span>/weather?q=Huizhou&amp;APPID=f8d8ead8299f963abcded5c40c0bcb81</span><br></pre></td></tr></table></figure>
<p>去除掉访问参数后的地址为：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>api.openweathermap.org<span class="regexp">/data/</span><span class="number">2.5</span>/weather</span><br></pre></td></tr></table></figure>
<p>我们再看OpenWeather的API，其中<a target="_blank" rel="noopener" href="http://api.openweathermap.org/data/2.5/">http://api.openweathermap.org/data/2.5/</a> 为公共部分，最后一个是变化的，我们将<a target="_blank" rel="noopener" href="http://api.openweathermap.org/data/2.5/">http://api.openweathermap.org/data/2.5/</a> 作为baseUri<br>weather作为地址的区别部分。这里需要注意的是baseuri一定要以’&#x2F;‘结尾，GET(“weather”)这个不能以&#x2F;开头，刚开始使用的时候由于这个原因导致了获取不到返回值，具体为什么，我将会在介绍完这个例子后给大家介绍下。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">IDouWheather</span> &#123;</span><br><span class="line">    <span class="variable">@GET</span>(<span class="string">&quot;weather&quot;</span>)</span><br><span class="line">    Call&lt;WheatherResult&gt; getWheatherResult(<span class="variable">@Query</span>(<span class="string">&quot;q&quot;</span>) String cityName, <span class="variable">@Query</span>(<span class="string">&quot;APPID&quot;</span>) String ApiId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于访问接口还有如下的写法,这里介绍的是Path的用法。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">GitHub</span> &#123;</span><br><span class="line">    <span class="variable">@GET</span>(<span class="string">&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;</span>)</span><br><span class="line">    Call&lt;List&lt;Contributor&gt;&gt; contributors(<span class="variable">@Path</span>(<span class="string">&quot;owner&quot;</span>) String owner,<span class="variable">@Path</span>(<span class="string">&quot;repo&quot;</span>) String repo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="comment">//baseurl 定义</span></span><br><span class="line"><span class="keyword">String</span> baseUrl = <span class="string">&quot;http://api.openweathermap.org/data/2.5/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Retrofit：</span></span><br><span class="line">Retrofit retrofit = <span class="keyword">new</span> <span class="type">Retrofit</span>.Builder()</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        使用Retrofit会将Json数据直接解析转换成java 对象，因此需要用到json 解析库作为转换器</span></span><br><span class="line"><span class="comment">        这里使用GSON解析数据，但是retrofit2还支持如下列表的解析器：</span></span><br></pre></td></tr></table></figure>
<pre><code>    Gson: com.squareup.retrofit2:converter-gson 
    Jackson: com.squareup.retrofit2:converter-jackson 
    Moshi： com.squareup.retrofit2:converter-moshi 
    Protobuf: com.squareup.retrofit2:converter-protobuf 
    Wire: com.squareup.retrofit2:converter-wire 
    Simple XML:com.squareup.retrofit2:converter-simplexml
    <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">        */</span><br><span class="line">        .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">        .base<span class="constructor">Url(<span class="params">baseUrl</span>)</span></span><br><span class="line">        <span class="comment">/*需要注意下BASE_URL这个参数，如果@GET方法里的URl是完整的，则不拼接参数，否则拼接URL*/</span></span><br><span class="line">        .build<span class="literal">()</span>;</span><br><span class="line"> <span class="comment">//创建访问服务：</span></span><br><span class="line">IDouWheather weatherService = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">IDouWheather</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line"><span class="comment">//将参数传递进去：</span></span><br><span class="line">Call&lt;WheatherResult&gt; call = weatherService.get<span class="constructor">WheatherResult(<span class="string">&quot;Huizhou&quot;</span>, <span class="string">&quot;f8d8ead8299f963abcded5c40c0bcb89&quot;</span>)</span>;</span><br><span class="line"><span class="comment">//异步访问：</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;WheatherResult&gt;<span class="literal">()</span> &#123;</span><br><span class="line">    <span class="comment">//回调函数发生在主线程，可以进行UI相关的操作</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Response(Call&lt;WheatherResult&gt; <span class="params">call</span>, Response&lt;WheatherResult&gt; <span class="params">response</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(response.is<span class="constructor">Success()</span>) &#123;</span><br><span class="line">            <span class="comment">//获取返回结果</span></span><br><span class="line">            WheatherResult result = response.body<span class="literal">()</span>;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getName = &quot;</span> + result.get<span class="constructor">Name()</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getTemp = &quot;</span> + result.get<span class="constructor">Main()</span>.get<span class="constructor">Temp()</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getLat = &quot;</span> + result.get<span class="constructor">Coord()</span>.get<span class="constructor">Lat()</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getLon = &quot;</span> + result.get<span class="constructor">Coord()</span>.get<span class="constructor">Lon()</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getDescription = &quot;</span> + result.get<span class="constructor">Weather()</span>.get(<span class="number">0</span>).get<span class="constructor">Description()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Failure(Call&lt;WheatherResult&gt; <span class="params">call</span>, Throwable <span class="params">t</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
<p>下面是返回数据对应的Bean，这个我是使用GSONFormat插件自动生成的：注意这里可以不用实现全部的节点，但是一定要注意，参数名一定要和返回的json数据的key一致：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WheatherResult</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lon : 114.4</span></span><br><span class="line"><span class="comment">     * lat : 23.08</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">CoordBean</span> coord;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * coord : &#123;&quot;lon&quot;:114.4,&quot;lat&quot;:23.08&#125;</span></span><br><span class="line"><span class="comment">     * weather : [&#123;&quot;id&quot;:803,&quot;main&quot;:&quot;Clouds&quot;,&quot;description&quot;:&quot;broken clouds&quot;,&quot;icon&quot;:&quot;04n&quot;&#125;]</span></span><br><span class="line"><span class="comment">     * base : stations</span></span><br><span class="line"><span class="comment">     * main : &#123;&quot;temp&quot;:302.04,&quot;pressure&quot;:994,&quot;humidity&quot;:56,&quot;temp_min&quot;:302.04,&quot;temp_max&quot;:302.04&#125;</span></span><br><span class="line"><span class="comment">     * wind : &#123;&quot;speed&quot;:2.49,&quot;deg&quot;:144&#125;</span></span><br><span class="line"><span class="comment">     * rain : &#123;&#125;</span></span><br><span class="line"><span class="comment">     * clouds : &#123;&quot;all&quot;:68&#125;</span></span><br><span class="line"><span class="comment">     * dt : 1464103691</span></span><br><span class="line"><span class="comment">     * sys : &#123;&quot;type&quot;:3,&quot;id&quot;:187827,&quot;message&quot;:0.0114,&quot;country&quot;:&quot;CN&quot;,&quot;sunrise&quot;:1464039473,&quot;sunset&quot;:1464087657&#125;</span></span><br><span class="line"><span class="comment">     * id : 1806776</span></span><br><span class="line"><span class="comment">     * name : Huizhou</span></span><br><span class="line"><span class="comment">     * cod : 200</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> base;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * temp : 302.04</span></span><br><span class="line"><span class="comment">     * pressure : 994</span></span><br><span class="line"><span class="comment">     * humidity : 56</span></span><br><span class="line"><span class="comment">     * temp_min : 302.04</span></span><br><span class="line"><span class="comment">     * temp_max : 302.04</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">MainBean</span> main;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * speed : 2.49</span></span><br><span class="line"><span class="comment">     * deg : 144</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">WindBean</span> wind;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">RainBean</span> rain;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * all : 68</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">CloudsBean</span> clouds;</span><br><span class="line">    <span class="keyword">private</span> int dt;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * type : 3</span></span><br><span class="line"><span class="comment">     * id : 187827</span></span><br><span class="line"><span class="comment">     * message : 0.0114</span></span><br><span class="line"><span class="comment">     * country : CN</span></span><br><span class="line"><span class="comment">     * sunrise : 1464039473</span></span><br><span class="line"><span class="comment">     * sunset : 1464087657</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">SysBean</span> sys;</span><br><span class="line">    <span class="keyword">private</span> int id;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> int cod;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * id : 803</span></span><br><span class="line"><span class="comment">     * main : Clouds</span></span><br><span class="line"><span class="comment">     * description : broken clouds</span></span><br><span class="line"><span class="comment">     * icon : 04n</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">List</span>&lt;<span class="title class_">WeatherBean</span>&gt; weather;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CoordBean</span> <span class="title function_">getCoord</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> coord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCoord</span>(<span class="params">CoordBean coord</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">coord</span> = coord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getBase</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setBase</span>(<span class="params"><span class="built_in">String</span> base</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">base</span> = base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">MainBean</span> <span class="title function_">getMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> main;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMain</span>(<span class="params">MainBean main</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">main</span> = main;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">WindBean</span> <span class="title function_">getWind</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> wind;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWind</span>(<span class="params">WindBean wind</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wind</span> = wind;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">RainBean</span> <span class="title function_">getRain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> rain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setRain</span>(<span class="params">RainBean rain</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rain</span> = rain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CloudsBean</span> <span class="title function_">getClouds</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> clouds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setClouds</span>(<span class="params">CloudsBean clouds</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clouds</span> = clouds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getDt</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> dt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setDt</span>(<span class="params">int dt</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dt</span> = dt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">SysBean</span> <span class="title function_">getSys</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> sys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSys</span>(<span class="params">SysBean sys</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sys</span> = sys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getId</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setId</span>(<span class="params">int id</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setName</span>(<span class="params"><span class="built_in">String</span> name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getCod</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCod</span>(<span class="params">int cod</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cod</span> = cod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">WeatherBean</span>&gt; <span class="title function_">getWeather</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> weather;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWeather</span>(<span class="params">List&lt;WeatherBean&gt; weather</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">weather</span> = weather;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CoordBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> double lon;</span><br><span class="line">        <span class="keyword">private</span> double lat;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getLon</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> lon;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setLon</span>(<span class="params">double lon</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">lon</span> = lon;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getLat</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> lat;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setLat</span>(<span class="params">double lat</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">lat</span> = lat;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MainBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> double temp;</span><br><span class="line">        <span class="keyword">private</span> int pressure;</span><br><span class="line">        <span class="keyword">private</span> int humidity;</span><br><span class="line">        <span class="keyword">private</span> double temp_min;</span><br><span class="line">        <span class="keyword">private</span> double temp_max;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getTemp</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> temp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setTemp</span>(<span class="params">double temp</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">temp</span> = temp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getPressure</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> pressure;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setPressure</span>(<span class="params">int pressure</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pressure</span> = pressure;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getHumidity</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> humidity;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setHumidity</span>(<span class="params">int humidity</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">humidity</span> = humidity;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getTemp_min</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> temp_min;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setTemp_min</span>(<span class="params">double temp_min</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">temp_min</span> = temp_min;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getTemp_max</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> temp_max;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setTemp_max</span>(<span class="params">double temp_max</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">temp_max</span> = temp_max;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WindBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> double speed;</span><br><span class="line">        <span class="keyword">private</span> int deg;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getSpeed</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> speed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSpeed</span>(<span class="params">double speed</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">speed</span> = speed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getDeg</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> deg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setDeg</span>(<span class="params">int deg</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">deg</span> = deg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RainBean</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CloudsBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> int all;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setAll</span>(<span class="params">int all</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">all</span> = all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SysBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> int <span class="keyword">type</span>;</span><br><span class="line">        <span class="keyword">private</span> int id;</span><br><span class="line">        <span class="keyword">private</span> double message;</span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">String</span> country;</span><br><span class="line">        <span class="keyword">private</span> int sunrise;</span><br><span class="line">        <span class="keyword">private</span> int sunset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getType</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">type</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setType</span>(<span class="params">int <span class="keyword">type</span></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">type</span> = <span class="keyword">type</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getId</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setId</span>(<span class="params">int id</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> double <span class="title function_">getMessage</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMessage</span>(<span class="params">double message</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">message</span> = message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getCountry</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> country;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCountry</span>(<span class="params"><span class="built_in">String</span> country</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">country</span> = country;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getSunrise</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> sunrise;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSunrise</span>(<span class="params">int sunrise</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">sunrise</span> = sunrise;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getSunset</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> sunset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSunset</span>(<span class="params">int sunset</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">sunset</span> = sunset;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WeatherBean</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> int id;</span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">String</span> main;</span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">String</span> description;</span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">String</span> icon;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> int <span class="title function_">getId</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setId</span>(<span class="params">int id</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> main;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMain</span>(<span class="params"><span class="built_in">String</span> main</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">main</span> = main;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getDescription</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> description;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setDescription</span>(<span class="params"><span class="built_in">String</span> description</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">description</span> = description;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getIcon</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> icon;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setIcon</span>(<span class="params"><span class="built_in">String</span> icon</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">icon</span> = icon;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击运行就可以直接获取返回的结果了。</p>
<h4 id="基本用法："><a href="#基本用法：" class="headerlink" title="基本用法："></a>基本用法：</h4><h4 id="Retrofix-amp-amp-RxJava："><a href="#Retrofix-amp-amp-RxJava：" class="headerlink" title="Retrofix &amp;&amp; RxJava："></a>Retrofix &amp;&amp; RxJava：</h4><p>使用RXJava会使得整个流程会显得更加清晰，在原先项目中加入RxJava步骤很简单只需要在原有的基础上作如下改动即可：</p>
<p>在build.gradle中加入：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">compile</span> &#x27;io.reactivex:rxjava:<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;</span><br><span class="line"><span class="attribute">compile</span> &#x27;io.reactivex:rxandroid:<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;</span><br><span class="line"><span class="attribute">compile</span> &#x27;com.squareup.retrofit2:adapter-rxjava:<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>-beta4&#x27;</span><br></pre></td></tr></table></figure>
<p>这时候接口就不能是Call了，而应该是Observable：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">IDouMusic</span> &#123;</span><br><span class="line">    <span class="variable">@GET</span>(<span class="string">&quot;weather&quot;</span>)</span><br><span class="line">    Observable&lt;WheatherResult&gt; getWheatherResult(<span class="variable">@Query</span>(<span class="string">&quot;q&quot;</span>) String cityName, <span class="variable">@Query</span>(<span class="string">&quot;APPID&quot;</span>) String ApiId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">String baseUrl = <span class="string">&quot;http://api.openweathermap.org/data/2.5/&quot;</span>;</span><br><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.<span class="constructor">Builder()</span></span><br><span class="line">        .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">        <span class="comment">//添加RxJavaCallAdapterFactory</span></span><br><span class="line">        .add<span class="constructor">CallAdapterFactory(RxJavaCallAdapterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">        .base<span class="constructor">Url(<span class="params">baseUrl</span>)</span></span><br><span class="line">        .build<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">IDouMusic weatherService = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">IDouMusic</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">Observable&lt;WheatherResult&gt; observable = weatherService.get<span class="constructor">WheatherResult(<span class="string">&quot;Huizhou&quot;</span>, <span class="string">&quot;f8d8ead8299f963abcded5c40c0bcb89&quot;</span>)</span>;</span><br><span class="line"><span class="comment">//在IO线程执行网络查询</span></span><br><span class="line">observable.subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">        .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line"><span class="comment">//切换到主线程在主线程更新UI</span></span><br><span class="line">        .subscribe(<span class="keyword">new</span> Subscriber&lt;WheatherResult&gt;<span class="literal">()</span> &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void on<span class="constructor">Completed()</span> &#123;&#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void on<span class="constructor">Error(Throwable <span class="params">e</span>)</span> &#123;&#125;</span><br><span class="line">            @Override</span><br><span class="line">            public void on<span class="constructor">Next(WheatherResult <span class="params">wheatherResult</span>)</span> &#123;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getName = &quot;</span> + wheatherResult.get<span class="constructor">Name()</span>);</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getTemp = &quot;</span> + wheatherResult.get<span class="constructor">Main()</span>.get<span class="constructor">Temp()</span>);</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getLat = &quot;</span> + wheatherResult.get<span class="constructor">Coord()</span>.get<span class="constructor">Lat()</span>);</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getLon = &quot;</span> + wheatherResult.get<span class="constructor">Coord()</span>.get<span class="constructor">Lon()</span>);</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;xiaohai.lin&quot;</span>, <span class="string">&quot;getDescription = &quot;</span> + wheatherResult.get<span class="constructor">Weather()</span>.get(<span class="number">0</span>).get<span class="constructor">Description()</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Retrofix-amp-amp-Realm："><a href="#Retrofix-amp-amp-Realm：" class="headerlink" title="Retrofix &amp;&amp; Realm："></a>Retrofix &amp;&amp; Realm：</h3><p>Realm 可以与 Retrofit 1.x 和 2.x 无缝配合工作。但注意 Retrofit 不会自动将对象存入 Realm。<br>你需要通过调用 Realm.copyToRealm() 或 Realm.copyToRealmOrUpdate() 来将它们存入 Realm。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">GitHubService service = restAdapter.create(<span class="module-access"><span class="module"><span class="identifier">GitHubService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">List&lt;Repo&gt; repos = service.<span class="built_in">list</span><span class="constructor">Repos(<span class="string">&quot;octocat&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Copy elements from Retrofit to Realm to persist them.</span></span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">List&lt;Repo&gt; realmRepos = realm.copy<span class="constructor">ToRealmOrUpdate(<span class="params">repos</span>)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>
<h4 id="Retrofix2-新特性："><a href="#Retrofix2-新特性：" class="headerlink" title="Retrofix2 新特性："></a>Retrofix2 新特性：</h4><p><a target="_blank" rel="noopener" href="http://api.openweathermap.org/data/2.5/weather?q=Huizhou&amp;APPID=f8d8ead8299f963abcded5c40c0bcb89">http://api.openweathermap.org/data/2.5/weather?q=Huizhou&amp;APPID=f8d8ead8299f963abcded5c40c0bcb89</a><br><a target="_blank" rel="noopener" href="https://gank.io/post/56e80c2c677659311bed9841">https://gank.io/post/56e80c2c677659311bed9841</a><br><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/26705">https://yq.aliyun.com/articles/26705</a></p>
<p><a target="_blank" rel="noopener" href="http://www.07net01.com/program/2016/02/1307334.html">http://www.07net01.com/program/2016/02/1307334.html</a><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/c1a3a881a144">http://www.jianshu.com/p/c1a3a881a144</a><br><a target="_blank" rel="noopener" href="https://twiceyuan.com/2015/12/26/retrofit2-0/?utm_source=tuicool&amp;utm_medium=referral">https://twiceyuan.com/2015/12/26/retrofit2-0/?utm_source=tuicool&amp;utm_medium=referral</a><br><a target="_blank" rel="noopener" href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0915/3460.html">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0915/3460.html</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/liuhongwei123888/article/details/50375283">http://blog.csdn.net/liuhongwei123888/article/details/50375283</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/angeldevil/p/3757335.html">http://www.cnblogs.com/angeldevil/p/3757335.html</a><br><a target="_blank" rel="noopener" href="http://www.bkjia.com/Androidjc/995850.html">http://www.bkjia.com/Androidjc/995850.html</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/lizelinll/article/details/42361327">http://blog.csdn.net/lizelinll/article/details/42361327</a><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/6zIvQbb">http://www.tuicool.com/articles/6zIvQbb</a><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/fQju2uQ">http://www.tuicool.com/articles/fQju2uQ</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/tiankong1206/article/details/46486401">http://blog.csdn.net/tiankong1206/article/details/46486401</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/caroline_wendy/article/details/50557470">http://blog.csdn.net/caroline_wendy/article/details/50557470</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cxbiao.com/2016/05/14/Retrofit2%E4%B8%8ERxJava%E7%94%A8%E6%B3%95%E8%A7%A3%E6%9E%90/">http://www.cxbiao.com/2016/05/14/Retrofit2%E4%B8%8ERxJava%E7%94%A8%E6%B3%95%E8%A7%A3%E6%9E%90/</a><br><a target="_blank" rel="noopener" href="http://www.jcodecraeer.com/plus/view.php?aid=3460">http://www.jcodecraeer.com/plus/view.php?aid=3460</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/13/Android-进阶之第三方库的介绍-Retrofit/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/13/Android-进阶之第三方库的介绍-Retrofit/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/12/Android-进阶之第三方库的介绍-Realm-二/" title="Android 进阶之第三方库的介绍 Realm [二] 进阶用法" itemprop="url">Android 进阶之第三方库的介绍 Realm [二] 进阶用法</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-11T16:29:39.000Z" itemprop="datePublished"> Published 2016-06-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="多线程情况下的Realm"><a href="#多线程情况下的Realm" class="headerlink" title="多线程情况下的Realm"></a>多线程情况下的Realm</h4><p>我们可以实时地在不同线程中读取和写入Realm对象，不用担心其它线程会对同一对象进行操作。在使用事务改变对象时，在下一次事件循环中，另一线程中指向同一对象的数据会被即时更新。唯一局限是不能随意跨线程传递 Realm 对象。如果您在另一线程使用同一对象，请在哪个线程使用查询重新获得该对象。请谨记所有的 Realm 对象都会在不同线程中保持更新——Realm 会在数据改变时通知您。</p>
<h4 id="使用JSON数据"><a href="#使用JSON数据" class="headerlink" title="使用JSON数据"></a>使用JSON数据</h4><p>对于JSON，我们可以直接将它添加到Realm中，这些 JSON 对象可以是一个 String、一个 JSONObject 或者是一个 InputStream。Realm 会忽略 JSON 中存在但未定义在 Realm 模型类里的字段。<br>单独对象可以通过 Realm.createObjectFromJson() 添加。对象列表可以通过 Realm.createAllFromJson() 添加。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A RealmObject that represents a city</span></span><br><span class="line">public <span class="keyword">class</span> City extends RealmObject &#123;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="comment">// getters and setters left out ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Insert from a string</span></span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">realm.create<span class="constructor">ObjectFromJson(City.<span class="params">class</span>, <span class="string">&quot;&#123; city: \&quot;Copenhagen\&quot;, id: 1 &#125;&quot;</span>)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Insert multiple items using a InputStream</span></span><br><span class="line">InputStream is = <span class="keyword">new</span> <span class="constructor">FileInputStream(<span class="params">new</span> File(<span class="string">&quot;path_to_file&quot;</span>)</span>);</span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    realm.create<span class="constructor">AllFromJson(City.<span class="params">class</span>, <span class="params">is</span>)</span>;</span><br><span class="line">    realm.commit<span class="constructor">Transaction()</span>;</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">    realm.cancel<span class="constructor">Transaction()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h4><p>当后台线程向 Realm 添加数据，UI 线程或者其它线程可以添加一个监听器来获取数据改变的通知。监听器在 Realm 数据改变的时候会被触发。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Realm</span> realm;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">RealmChangeListener</span> realmListener;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">      reamlListener = <span class="keyword">new</span> <span class="type">RealmChangeListener</span>&lt;<span class="type">Realm</span>&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        public void onChange(<span class="type">Realm</span> realm) &#123;</span><br><span class="line">            <span class="comment">// ... do something with the updates (UI, etc.) ...</span></span><br><span class="line">        &#125;&#125;;</span><br><span class="line">      realm.addChangeListener(realmListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onDestroy() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="comment">// Remove the listener.</span></span><br><span class="line">        realm.removeChangeListener(realmListener);</span><br><span class="line">        <span class="comment">// Close the realm instance.</span></span><br><span class="line">        realm.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>移除所有监听器。<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">realm.removeAllChangeListeners()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
除了在 Realm 实例上添加监听器以外，您还可以在 RealmObject 和 RealmResults 实例上添加监听器。<br>你可以通过下面的方式来监视对象和查询结果的改变。另外，当监听回调函数被调用时，相应的数据已经被更新，我们不需要去做刷新操作。<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MyActivity extends Activity &#123;</span><br><span class="line">    <span class="keyword">private</span> Realm realm;</span><br><span class="line">    <span class="keyword">private</span> RealmChangeListener puppiesListener;</span><br><span class="line">    <span class="keyword">private</span> RealmChangeListener dogListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RealmResults&lt;Dog&gt; puppies;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">      super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">      realm = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">DefaultInstance()</span>;</span><br><span class="line">      puppiesListener = <span class="keyword">new</span> RealmChangeListener&lt;RealmResults&lt;Dog&gt;&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Change(RealmResults&lt;Dog&gt; <span class="params">puppies</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ... do something with the updated puppies instance</span></span><br><span class="line">        &#125;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Find all the puppies</span></span><br><span class="line">      puppies = realm.where(<span class="module-access"><span class="module"><span class="identifier">Dog</span>.</span></span><span class="keyword">class</span>).less<span class="constructor">ThanOrEqualTo(<span class="string">&quot;age&quot;</span>, 2)</span>.find<span class="constructor">All()</span>;</span><br><span class="line">      puppies.add<span class="constructor">ChangeListener(<span class="params">puppiesListener</span>)</span>;</span><br><span class="line"></span><br><span class="line">      dogListener = <span class="keyword">new</span> RealmChangeListener&lt;Dog&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Change(Dog <span class="params">dog</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ... do something with the updated Dog instance</span></span><br><span class="line">        &#125;&#125;;</span><br><span class="line"></span><br><span class="line">      dog = realm.where(<span class="module-access"><span class="module"><span class="identifier">Dog</span>.</span></span><span class="keyword">class</span>).equals(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Fido&quot;</span>).find<span class="constructor">First()</span>;</span><br><span class="line">      dog.add<span class="constructor">ChangeListener(<span class="params">dogListener</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Destroy()</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Destroy()</span>;</span><br><span class="line">        <span class="comment">// Remove the listeners</span></span><br><span class="line">        puppies.remove<span class="constructor">ChangeListener(<span class="params">puppiesListener</span>)</span>;</span><br><span class="line">        dog.remove<span class="constructor">ChangeListener(<span class="params">dogListener</span>)</span>;</span><br><span class="line">        <span class="comment">// Close the realm instance.</span></span><br><span class="line">        realm.close<span class="literal">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
最后，这些监听器同样会在监听对象的引用对象改变时被触发，请见示例：<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Person person = realm.where(<span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">First()</span>;</span><br><span class="line">person.get<span class="constructor">Dogs()</span>; <span class="comment">// =&gt; 2 - Assume there are 2 dogs in the list</span></span><br><span class="line">person.add<span class="constructor">ChangeListener(<span class="params">new</span> RealmChangeListener&lt;Person&gt;()</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Change(Person <span class="params">person</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// React to the change in the Person instance.</span></span><br><span class="line">        <span class="comment">// This will also get called when any referenced dogs are updated.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">Dog dog = person.get<span class="constructor">Dogs()</span>.get(<span class="number">0</span>);</span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">dog.set<span class="constructor">Age(5)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br><span class="line"><span class="comment">// Person change listener is called on the next iteration of the run loop because</span></span><br><span class="line"><span class="comment">// a referenced dog object changed.</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>总结如下：</p>
<ul>
<li>可以对Realm添加监听</li>
<li>可以对RealmObject，RealmResults添加监听，在这种情况下对应的数据发生变化或者引用发生变化都会出发监听响应事件。</li>
</ul>
<h4 id="迁移（Migrations）"><a href="#迁移（Migrations）" class="headerlink" title="迁移（Migrations）"></a>迁移（Migrations）</h4><p>下面例子使得相应的 migration 代码在有迁移需要的时候被自动执行。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmConfiguration config = <span class="keyword">new</span> RealmConfiguration.<span class="constructor">Builder(<span class="params">context</span>)</span></span><br><span class="line">    .schema<span class="constructor">Version(2)</span> <span class="comment">// Must be bumped when the schema changes</span></span><br><span class="line">    .migration(<span class="keyword">new</span> <span class="constructor">MyMigration()</span>) <span class="comment">// Migration to run instead of throwing an exception</span></span><br><span class="line">    .build<span class="literal">()</span></span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Example migration adding a new class</span></span><br><span class="line">RealmMigration migration = <span class="keyword">new</span> <span class="constructor">RealmMigration()</span> &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public void migrate(DynamicRealm realm, long oldVersion, long newVersion) &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// DynamicRealm exposes an editable schema</span></span><br><span class="line">     RealmSchema schema = realm.get<span class="constructor">Schema()</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Migrate to version 1: Add a new class</span></span><br><span class="line">     <span class="comment">// Example:</span></span><br><span class="line">     <span class="comment">// public Person extends RealmObject &#123;</span></span><br><span class="line">     <span class="comment">//     private String name;</span></span><br><span class="line">     <span class="comment">//     private int age;</span></span><br><span class="line">     <span class="comment">//     // getters and setters left out for brevity</span></span><br><span class="line">     <span class="comment">// &#125;</span></span><br><span class="line">     <span class="keyword">if</span> (oldVersion<span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">        schema.create(<span class="string">&quot;Person&quot;</span>)</span><br><span class="line">            .add<span class="constructor">Field(<span class="string">&quot;name&quot;</span>, String.<span class="params">class</span>)</span></span><br><span class="line">            .add<span class="constructor">Field(<span class="string">&quot;age&quot;</span>, <span class="params">int</span>.<span class="params">class</span>)</span>;</span><br><span class="line">        oldVersion++;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Migrate to version 2: Add a primary key + object references</span></span><br><span class="line">     <span class="comment">// Example:</span></span><br><span class="line">     <span class="comment">// public Person extends RealmObject &#123;</span></span><br><span class="line">     <span class="comment">//     private String name;</span></span><br><span class="line">     <span class="comment">//     @PrimaryKey</span></span><br><span class="line">     <span class="comment">//     private int age;</span></span><br><span class="line">     <span class="comment">//     private Dog favoriteDog;</span></span><br><span class="line">     <span class="comment">//     private RealmList&lt;Dog&gt; dogs;</span></span><br><span class="line">     <span class="comment">//     // getters and setters left out for brevity</span></span><br><span class="line">     <span class="comment">// &#125;</span></span><br><span class="line">     <span class="keyword">if</span> (oldVersion<span class="operator"> == </span><span class="number">1</span>) &#123;</span><br><span class="line">        schema.get(<span class="string">&quot;Person&quot;</span>)</span><br><span class="line">            .add<span class="constructor">Field(<span class="string">&quot;id&quot;</span>, <span class="params">long</span>.<span class="params">class</span>, FieldAttribute.PRIMARY_KEY)</span></span><br><span class="line">            .add<span class="constructor">RealmObjectField(<span class="string">&quot;favoriteDog&quot;</span>, <span class="params">schema</span>.<span class="params">get</span>(<span class="string">&quot;Dog&quot;</span>)</span>)</span><br><span class="line">            .add<span class="constructor">RealmListField(<span class="string">&quot;dogs&quot;</span>, <span class="params">schema</span>.<span class="params">get</span>(<span class="string">&quot;Dog&quot;</span>)</span>);</span><br><span class="line">        oldVersion++;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有旧 Realm 数据文件存在，那么迁移并不需要，在这种情况下，Realm 会创建一个新的以 .realm 为后缀，基于新的对象模型的数据文件。在开发和调试过程中，假如您需要频繁改变数据模型，并且不介意损失旧数据，您可以直接删除 .realm 文件（这里包含所有的数据！）而不用关心迁移的问题。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmConfiguration config = <span class="keyword">new</span> RealmConfiguration.<span class="constructor">Builder(<span class="params">context</span>)</span></span><br><span class="line">    .delete<span class="constructor">RealmIfMigrationNeeded()</span></span><br><span class="line">    .build<span class="literal">()</span></span><br></pre></td></tr></table></figure>

<h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><p>Realm 文件可以通过传递一个512位（64字节）的密钥参数给 Realm.getInstance().encryptionKey() 来加密存储在磁盘上。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">byte<span class="literal">[]</span> key = <span class="keyword">new</span> byte<span class="literal">[<span class="number">64</span>]</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="constructor">SecureRandom()</span>.next<span class="constructor">Bytes(<span class="params">key</span>)</span>;</span><br><span class="line">RealmConfiguration config = <span class="keyword">new</span> RealmConfiguration.<span class="constructor">Builder(<span class="params">context</span>)</span></span><br><span class="line">  .encryption<span class="constructor">Key(<span class="params">key</span>)</span></span><br><span class="line">  .build<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">Realm realm = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">Instance(<span class="params">config</span>)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="与-Android-相关"><a href="#与-Android-相关" class="headerlink" title="与 Android 相关"></a>与 Android 相关</h4><ul>
<li>适配器（Adapter）</li>
</ul>
<p>RealmBaseAdapter 可以与 ListView 配合使用。<br>RealmRecyclerViewAdapter 可以与 RecyclerView 配合使用。</p>
<p>要使用这些适配器需要添加如下的依赖：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">	<span class="keyword">compile</span> <span class="string">&#x27;io.realm:android-adapters:1.2.1&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Intents</li>
</ul>
<p>因为Realm 中不可以直接通过 intent 传递 RealmObject，所以一般只传递 RealmObject 的标识符。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Assuming we had a person class with a @PrimaryKey on the &#x27;id&#x27; field ...</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> <span class="constructor">Intent(<span class="params">getActivity</span>()</span>, <span class="module-access"><span class="module"><span class="identifier">ReceivingService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">intent.put<span class="constructor">Extra(<span class="string">&quot;person_id&quot;</span>, <span class="params">person</span>.<span class="params">getId</span>()</span>);</span><br><span class="line">get<span class="constructor">Activity()</span>.start<span class="constructor">Service(<span class="params">intent</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>在接受方（Activty、Service、IntentService、BroadcastReceiver 及其它）从 bundle 中解析出这个主键然后打开 Realm 查询得到这个 RealmObject。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// in onCreate(), onHandleIntent(), etc.</span></span><br><span class="line">String personId = intent.get<span class="constructor">StringExtra(<span class="string">&quot;person_id&quot;</span>)</span>;</span><br><span class="line">Realm realm = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">DefaultInstance()</span>;</span><br><span class="line">Person person = realm.where(<span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>).equal<span class="constructor">To(<span class="string">&quot;id&quot;</span>, <span class="params">personId</span>)</span>.find<span class="constructor">First()</span>;</span><br><span class="line"><span class="comment">// do something with the person ...</span></span><br><span class="line">realm.close<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Android-Framework-多线程-API-相关"><a href="#Android-Framework-多线程-API-相关" class="headerlink" title="Android Framework 多线程 API 相关"></a>Android Framework 多线程 API 相关</h4><p>当使用下列 API 时需要格外注意：</p>
<ul>
<li>AsyncTask</li>
<li>IntentService<br>AsyncTask 的 doInBackground() 方法会运行在一个后台线程。IntentService 的 onHandleIntent(Intent intent) 方法会运行在一个后台工作线程。<br>如果需要在这些方法中使用 Realm，在对 Realm 的调用结束后关闭 Realm 实例。</li>
</ul>
<p>AsyncTask<br>在 doInBackground 方法中打开并关闭 Realm，如下所示：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadOrders</span> <span class="keyword">extends</span> <span class="title">AsyncTask&lt;Void</span>, <span class="title">Void</span>, <span class="title">Long&gt;</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Long</span> doInBackground(<span class="type">Void</span>... voids) &#123;</span><br><span class="line">        <span class="comment">// Now in a background thread.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Realm</span></span><br><span class="line">        <span class="type">Realm</span> realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">        <span class="comment">// Work with Realm</span></span><br><span class="line">        realm.createAllFromJson(<span class="type">Order</span>.<span class="keyword">class</span>, api.getNewOrders());</span><br><span class="line">        <span class="type">Order</span> firstOrder = realm.where(<span class="type">Order</span>.<span class="keyword">class</span>).findFirst();</span><br><span class="line">        long orderId = firstOrder.getId(); <span class="comment">// Id of order</span></span><br><span class="line">        realm.close();</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> void onPostExecute(<span class="type">Long</span> orderId) &#123;</span><br><span class="line">        <span class="comment">// Back on the Android mainThread</span></span><br><span class="line">        <span class="comment">// do something with orderId such as query Realm</span></span><br><span class="line">        <span class="comment">// for the order and perform some operation with it.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>IntentService<br>在 onHandleIntent() 方法中打开并关闭 Realm，如下所示：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">OrdersIntentService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>&#123;</span><br><span class="line">    public <span class="type">OrdersIntentService</span>(<span class="type">String</span> name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;OrdersIntentService&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onHandleIntent(<span class="type">Intent</span> intent) &#123;</span><br><span class="line">        <span class="comment">// Now in a background thread.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Open the Realm</span></span><br><span class="line">        <span class="type">Realm</span> realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">        <span class="comment">// Work with Realm</span></span><br><span class="line">        realm.createAllFromJson(<span class="type">Order</span>.<span class="keyword">class</span>, api.getNewOrders());</span><br><span class="line">        <span class="type">Order</span> firstOrder = realm.where(<span class="type">Order</span>.<span class="keyword">class</span>).findFirst();</span><br><span class="line">        long orderId = firstOrder.getId(); <span class="comment">// Id of order</span></span><br><span class="line">        realm.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对其它库的支持"><a href="#对其它库的支持" class="headerlink" title="对其它库的支持"></a>对其它库的支持</h4><ul>
<li><p>GSON<br>GSON 是 Google 开发的 JSON 处理库。GSON 与 Realm 可以无缝配合使用。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Using the User class</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> email;</span><br><span class="line">    <span class="comment">// getters and setters left out ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Gson</span> gson = <span class="keyword">new</span> <span class="type">GsonBuilder</span>().create();</span><br><span class="line"><span class="type">String</span> json = <span class="string">&quot;&#123; name : &#x27;John&#x27;, email : &#x27;john@corporation.com&#x27; &#125;&quot;</span>;</span><br><span class="line"><span class="type">User</span> user = gson.fromJson(json, <span class="type">User</span>.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Retrofit</p>
</li>
</ul>
<p>Realm 可以与 Retrofit 1.x 和 2.x 无缝配合工作。但注意 Retrofit 不会自动将对象存入 Realm。<br>你需要通过调用 Realm.copyToRealm() 或 Realm.copyToRealmOrUpdate() 来将它们存入 Realm。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">GitHubService service = restAdapter.create(<span class="module-access"><span class="module"><span class="identifier">GitHubService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">List&lt;Repo&gt; repos = service.<span class="built_in">list</span><span class="constructor">Repos(<span class="string">&quot;octocat&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Copy elements from Retrofit to Realm to persist them.</span></span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">List&lt;Repo&gt; realmRepos = realm.copy<span class="constructor">ToRealmOrUpdate(<span class="params">repos</span>)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>RxJava</li>
</ul>
<p>Realm 包含了对 RxJava 的原生支持。如下类可以被暴露为一个 Observable：Realm, RealmResults, RealmObject, DynamicRealm and DynamicRealmObject。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Combining Realm, Retrofit and RxJava (Using Retrolambda syntax for brevity)</span></span><br><span class="line"><span class="comment">// Load all persons and merge them with their latest stats from GitHub (if they have any)</span></span><br><span class="line">Realm realm = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">DefaultInstance()</span>;</span><br><span class="line">GitHubService api = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">GitHubService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">realm.where(<span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>).is<span class="constructor">NotNull(<span class="string">&quot;username&quot;</span>)</span>.find<span class="constructor">AllAsync()</span>.<span class="keyword">as</span><span class="constructor">Observable()</span></span><br><span class="line">    .filter(persons.isLoaded)</span><br><span class="line">    .flat<span class="constructor">Map(<span class="params">persons</span> -&gt; Observable.<span class="params">from</span>(<span class="params">persons</span>)</span>)</span><br><span class="line">    .flat<span class="constructor">Map(<span class="params">person</span> -&gt; <span class="params">api</span>.<span class="params">user</span>(<span class="params">person</span>.<span class="params">getGithubUserName</span>()</span>)</span><br><span class="line">    .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">    .subscribe(user -&gt; show<span class="constructor">User(<span class="params">user</span>)</span>);</span><br></pre></td></tr></table></figure>
<p>请注意异步查询不会阻塞当前线程，如上代码会立即返回一个 RealmResults 实例。如果您想确定该 RealmResults 已经加载完成请使用 filter operator 和 RealmResults<E>.isLoaded() 方法。通过判断 RealmResults 是否已经加载可以得知查询是否已经完成。</E></p>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ul>
<li>防止出现 ANR</li>
</ul>
<p>一般来说 Realm 的读写是足够快的，甚至在 UI 线程中读写也不是问题。但是，写事务是互相阻塞的，所以为了避免 ANR 的出现，我们建议你在后台线程中执行写操作。</p>
<ul>
<li>控制 Realm 实例的生命周期</li>
</ul>
<p>RealmObjects 和 RealmResults 在访问其引用数据时都是懒加载的。因为这个原因，请不要关闭你的 Realm 实例如果你仍然需要访问其中的 Realm 对象或者查询结果。为了避免不必要的 Realm 数据连接的打开和关闭，<br>Realm 内部有一个基于引用计数的缓存。这表示在同一线程内调用 Realm.getDefaultInstance() 多次是基本没有开销的，并且底层资源会在所有实例都关闭的时候才被释放。<br>以 UI 线程举例，最简单安全的途径是，在你所有的 Activity 和 Fragment 初始化时取得 Realm 实例，并在它们销毁时关闭 Realm 实例。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Setup Realm in your Application</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="type">RealmConfiguration</span> realmConfiguration = <span class="keyword">new</span> <span class="type">RealmConfiguration</span>.<span class="type">Builder</span>(<span class="keyword">this</span>).build();</span><br><span class="line">        <span class="type">Realm</span>.setDefaultConfiguration(realmConfiguration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// onCreate()/onDestroy() overlap when switching between activities so onCreate()</span></span><br><span class="line"><span class="comment">// on Activity 2 will be called before onDestroy() on Activity 1.</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Realm</span> realm;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onDestroy() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        realm.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use onStart()/onStop() for Fragments as onDestroy() might not be called.</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Realm</span> realm;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onStart() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onStop() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        realm.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重用 RealmResults 和 RealmObjects<br>在 UI 线程和其它拥有 Looper 的线程中，RealmObject 和 RealmResults 都会在 Realm 数据改变时自动刷新。这意味着你不需要在 RealmChangeListener 中重新获取这些对象。它们已经被更新并且准备好被重绘在屏幕上了。<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MyActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Realm realm;</span><br><span class="line">    <span class="keyword">private</span> RealmResults&lt;Person&gt; allPersons;</span><br><span class="line">    <span class="keyword">private</span> RealmChangeListener realmListener = <span class="keyword">new</span> RealmChangeListener&lt;Realm&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Change(Realm <span class="params">realm</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// Just redraw the views. `allPersons` already contain the</span></span><br><span class="line">            <span class="comment">// latest data.</span></span><br><span class="line">            invalidate<span class="constructor">View()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">        realm = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">DefaultInstance()</span>;</span><br><span class="line">        realm.add<span class="constructor">RealmChangeListener(<span class="params">listener</span>)</span>;</span><br><span class="line">        allPerson = realm.where(<span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">All()</span>; <span class="comment">// Create the &quot;live&quot; query result</span></span><br><span class="line">        setup<span class="constructor">Views()</span>; <span class="comment">// Initial setup of views</span></span><br><span class="line">        invalidate<span class="constructor">View()</span>; <span class="comment">// Redraw views with data</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/12/Android-进阶之第三方库的介绍-Realm-二/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/12/Android-进阶之第三方库的介绍-Realm-二/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/11/Android-进阶之第三方库的介绍-Realm/" title="Android 进阶之第三方库的介绍 Realm [一] 基础用法" itemprop="url">Android 进阶之第三方库的介绍 Realm [一] 基础用法</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-11T14:49:15.000Z" itemprop="datePublished"> Published 2016-06-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>对于Realm的学习主要分成篇博文，这篇如果只是想要单纯简单应用的话只要学会本篇博文的内容即可上手在项目中使用，如果对于Realm想要进一步深入了解它的高级用法可以查看Android 进阶之第三方库的介绍 Realm [二] 高级用法：<br>注意本篇博文大多数的内容都来自Realm官网，只不过是通过自己的认知规律重新组织下，来加深这些内容的理解。读大学那会儿老师说过看的东西永远是别人的，所以需要自己动手实践，哪怕梳理下内容也会转化成自己的。觉得非常有道理。</p>
</blockquote>
<h3 id="官网地址：https-realm-io"><a href="#官网地址：https-realm-io" class="headerlink" title="官网地址：https://realm.io"></a>官网地址：<a target="_blank" rel="noopener" href="https://realm.io/">https://realm.io</a></h3><h3 id="为什么选用Realm？"><a href="#为什么选用Realm？" class="headerlink" title="为什么选用Realm？"></a>为什么选用Realm？</h3><p>官网给出了如下的原因</p>
<ul>
<li>易用<br>Ream 不是在SQLite基础上的ORM，它有自己的数据查询引擎。并且十分容易使用。</li>
<li>快速<br>由于它是完全重新开始开发的数据库实现，所以它比任何的ORM速度都快很多，甚至比SLite速度都要快。</li>
<li>跨平台<br>Realm 支持 iOS &amp; OS X (Objective‑C &amp; Swift) &amp; Android. 我们可以在这些平台上共享Realm数据库文件，并且上层逻辑可以不用任何改动的情况下实现移植。</li>
<li>高级<br>Ream支持加密，格式化查询，易于移植，支持JSON，流式api，数据变更通知等高级特性</li>
<li>可信赖的<br>这个就不用解释了吧，每个库都这么说。</li>
<li>社区支持</li>
</ul>
<h3 id="有什么限制？"><a href="#有什么限制？" class="headerlink" title="有什么限制？"></a>有什么限制？</h3><p>目前Realm还不支持 Android 以外的 Java 环境；<br>Android Studio &gt;&#x3D; 1.5.1 ；<br>较新的 Android SDK 版本；<br>JDK 版本 &gt;&#x3D;7；<br>支持 Android API 9 以上的所有版本（Android 2.3 Gingerbread 及以上）。</p>
<hr>
<h4 id="1-添加Realm到工程"><a href="#1-添加Realm到工程" class="headerlink" title="1. 添加Realm到工程"></a>1. 添加Realm到工程</h4><p>在module的build.gradle文件中添加realm依赖：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">compile</span> &#x27;io.realm:realm-android:<span class="number">0</span>.<span class="number">84</span>.<span class="number">1</span>&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="2-创建一个Realm数据库"><a href="#2-创建一个Realm数据库" class="headerlink" title="2. 创建一个Realm数据库"></a>2. 创建一个Realm数据库</h4><ul>
<li>创建一个持久化Realm数据库<br>和SQLite数据库类似，每个Realm对应一个数据库文件。但是它的数据库后缀不是.db而是.realm<br>可以调用Realm.getInstance方法来创建一个Realm数据库：<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Realm musicRealmDB = <span class="module-access"><span class="module"><span class="identifier">Realm</span>.</span></span>get<span class="constructor">Instance(<span class="params">context</span>)</span>;</span><br></pre></td></tr></table></figure>
注意这里只是传入一个context，并没有传入数据库文件的文件名，这时候会创建一个叫做 default.realm的Realm文件，一般来说，这个文件位于&#x2F;data&#x2F;data&#x2F;<packagename>&#x2F;files&#x2F;，可以通过realm.getPath()来获得该Realm的绝对路径。<br>需要注意的是Realm的实例是线程单例化的，也就是说，在同一个线程内多次调用静态方法获得针对同路径的Realm，会返回同一个Realm实例。<br>但是如果在这个基础上还想创建一个新的数据库，或者你不想用default.realm这个名字，那么就需要使用如下的方式创建了：</packagename></li>
</ul>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Realm musicRealmDB <span class="operator">=</span></span><br><span class="line">    Realm.getInstance(</span><br><span class="line">            new RealmConfiguration.Builder(context)</span><br><span class="line">                    .name(<span class="string">&quot;musicRealmDB.realm&quot;</span>)</span><br><span class="line">                    .build()</span><br><span class="line">)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>除了上述的方法还可以使用：</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Realm realm <span class="operator">=</span> Realm.getDefaultInstance()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>来获得默认的Realm实例</p>
<p>默认RealmConfiguration：<br>RealmConfiguration可以保存为默认配置。通过在自定义的Application设置默认的Realm配置，可以使您在代码中的其他地方更加方便地创建针对该默认配置的Realm。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  public void onCreate() &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    <span class="comment">// The realm file will be located in Context.getFilesDir() with name &quot;default.realm&quot;</span></span><br><span class="line">    <span class="type">RealmConfiguration</span> config = <span class="keyword">new</span> <span class="type">RealmConfiguration</span>.<span class="type">Builder</span>(<span class="keyword">this</span>).build();</span><br><span class="line">    <span class="type">Realm</span>.setDefaultConfiguration(config);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="type">Realm</span> realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">    <span class="comment">// ... Do something ...</span></span><br><span class="line">    realm.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建非持久化的Realm</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmConfiguration myConfig = <span class="keyword">new</span> RealmConfiguration.<span class="constructor">Builder(<span class="params">context</span>)</span></span><br><span class="line">    .name(<span class="string">&quot;myrealm.realm&quot;</span>)</span><br><span class="line">    .<span class="keyword">in</span><span class="constructor">Memory()</span></span><br><span class="line">    .build<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>
<p>这样就可以创建一个存在于“内存中的” Realm。“内存中的”Realm 在内存紧张的情况下仍有可能使用到磁盘存储，但是这些磁盘空间都会在Realm实例完全关闭的时候被释放。<br>请注意使用同样的名称同时创建“内存中的”Realm 和常规的（持久化）Realm 是不允许的。<br>当某个“内存中的”Realm 的所有实例引用都被释放，该Realm 下的数据也同时会被清除。建议在您的应用生命周期中保持对“内存中的” Realm 实例的引用以避免非期望的数据丢失。</p>
</li>
<li><p>关闭Realm实例<br>Realm 实现了 Closeable 接口以便与释放 native 内存和文件描述符，请务必在使用完毕后关闭 Realm 实例。<br>Realm 实例是基于引用计数的, 也就是说假设您在同一个线程中调用了 getInstance() 两次，您需要同样调用 close() 两次以关闭该实例。<br>需要实现 Runnable，简单地在函数开始的时候调用 getInstance()，在函数结束的时候调用 close() 即可！<br>对于UI线程，您可以选择在 onDestroy() 方法内调用 realm.close()。<br>对于 AsyncTask，可以参照如下方式，在退出的时候关闭</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">protected Void doInBackground(Void... params) &#123;</span><br><span class="line">    Realm realm = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        realm = Realm.getDefaultInstance();</span><br><span class="line">        // ... Use the Realm<span class="built_in"> instance </span>...</span><br><span class="line">    &#125;<span class="keyword"> final</span>ly &#123;</span><br><span class="line">       <span class="built_in"> if </span>(realm != null) &#123;</span><br><span class="line">            realm.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="built_in"> return </span>null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果需要创建一个包含 Looper 的线程，可以参考如下的用法：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Realm</span> realm;</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        <span class="type">Looper</span>.prepare();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            realm = <span class="type">Realm</span>.getDefaultInstance();</span><br><span class="line">            <span class="comment">//... Setup the handlers using the Realm instance ...</span></span><br><span class="line">            <span class="type">Lopper</span>.loop();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (realm != <span class="literal">null</span>) &#123;</span><br><span class="line">                realm.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果minSdkVersion &gt;&#x3D; 19，可以使用try-with-resources,这种情况下就不需要手动来关闭了</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">try (Realm realm = Realm.getDefaultInstance()) &#123;</span><br><span class="line">    // No need to close the Realm<span class="built_in"> instance </span>manually</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-数据模型定义"><a href="#3-数据模型定义" class="headerlink" title="3. 数据模型定义"></a>3. 数据模型定义</h4><blockquote>
<p>Define you model class by extending the RealmObject</p>
</blockquote>
</li>
</ul>
<p>要想将某个JavaBean对象存储到Ream数据库中必须继承RealmObject类,但是需要注意的是Realm 数据模型不可以继承自除了 RealmObject 以外的其它对象</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MusicItemBean</span> extends RealmObject &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> title;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> path;</span><br><span class="line">    <span class="comment">//................</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MusicItemBean</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">String</span> <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setTitle</span><span class="params">(<span class="type">String</span> title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">getPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setPath</span><span class="params">(<span class="type">int</span> path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.path = path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Realm 数据模型不仅仅支持 private 成员变量，您还可以使用 public、protected 以及自定义的成员方法。目前不支持 final、transient 和 volatile 修饰的成员变量</p>
</li>
<li><p>Realm 支持boolean、byte、short、int、long、float、double、String、Date和byte [] 等类型字段。还可以使用 RealmObject 的子类和 RealmList&lt;? extends RealmObject&gt; 来表示模型关系。<br>Realm 对象中还可以声明包装类型（boxed type）属性，包括：Boolean、Byte、Short、Integer、Long、Float和Double。</p>
</li>
<li><p>Realm常用的注释：</p>
<ul>
<li><p>@PrimaryKey 属性：<br>  如果想让RealmObject的一个成员变量作为主键，可以使用@PrimaryKey注解。需要注意的是该字段类型必须为字符串（String）或整数（short、int 或 long）以及它们的包装类型（Short、Int 或 Long）。</p>
</li>
<li><p>@Required 属性：<br>  @Required 表示该字段不能为null，只有 Boolean，Byte，Short，Integer，Long，Float，Double，String，byte[] 以及 Date 可以被 @Required 修饰。<br>  在其它类型属性上使用 @Required 修饰会导致编译失败。基本数据类型（primitive types）不需要使用注解 @Required，因为他们本身就不可为空。RealmObject 属性永远可以为空。<br>  主键的存在意味着可以使用 createOrUpdate() 方法，它会用此主键尝试寻找一个已存在的对象，如果对象存在，就更新该对象；反之，它会创建一个新的对象。<br>  使用主键会对性能产生影响。创建和更新对象将会慢一点，而查询则会变快。很难量化这些性能的差异，因为性能的改变跟您数据库的大小息息相关。</p>
</li>
<li><p>@Ignore 属性：<br>  注解 @Ignore 意味着一个字段不应该被保存到 Realm。</p>
</li>
<li><p>@Index 属性：<br>  注解 @Index 会为字段增加搜索索引。这会导致插入速度变慢，同时数据文件体积有所增加，但能加速查询。因此建议仅在需要加速查询时才添加索引。目前仅支持索引的属性类型包括：String、byte、short、int、long、boolean和Date。</p>
</li>
</ul>
</li>
</ul>
<h4 id="4-存储数据项目："><a href="#4-存储数据项目：" class="headerlink" title="4. 存储数据项目："></a>4. 存储数据项目：</h4><p>Realm强制所有的写操作（添加、修改和删除对象）都在一个事务中执行从而确保数据的一致性。<br>要开始一个事务可以使用beginTransaction方法。反之要结束当前事务，可以使用commitTransaction方法。要取消事务可以调用cancelTransaction()方法：如下所示：<br>写入事务可以提交或取消。在提交期间，所有更改都将被写入磁盘，并且，只有当所有更改可以被持久化时，提交才会成功。通过取消一个写入事务，所有更改将被丢弃。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">musicRealmDB.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">MusicItemBean music = musicRealmDB.create<span class="constructor">Object(MusicItemBean.<span class="params">class</span>)</span>; </span><br><span class="line">music.set<span class="constructor">Title(<span class="string">&quot;何以爱情&quot;</span>)</span>;</span><br><span class="line">music.set<span class="constructor">Path(<span class="string">&quot;/storage/sdcard0/test01.mp3&quot;</span>)</span>;</span><br><span class="line">musicRealmDB.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>
<p>注意这里并没有调用MusicItemBean构造方法创建新的对象，如果你真的需要使用构造方法也可以，下面是使用构造方法的示例，它调用copyToRealm写入，Realm对象支持多个构造函数，只要其中之一是公共无参数构造函数即可。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">MusicItemBean music = <span class="keyword">new</span> <span class="constructor">MusicItemBean()</span>;</span><br><span class="line">music.set<span class="constructor">Title(<span class="string">&quot;何以爱情&quot;</span>)</span>;</span><br><span class="line">music.set<span class="constructor">Path(<span class="string">&quot;/storage/sdcard0/test01.mp3&quot;</span>)</span>;</span><br><span class="line"> </span><br><span class="line">musicRealmDB.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">MusicItemBean musicbean = musicRealmDB.copy<span class="constructor">ToRealm(<span class="params">music</span>)</span>;</span><br><span class="line">musicRealmDB.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">MyObject obj = <span class="keyword">new</span> <span class="constructor">MyObject()</span>;</span><br><span class="line">obj.set<span class="constructor">Id(42)</span>;</span><br><span class="line">obj.set<span class="constructor">Name(<span class="string">&quot;Fish&quot;</span>)</span>;</span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line"><span class="comment">// This will create a new one in Realm</span></span><br><span class="line"><span class="comment">// realm.copyToRealm(obj);</span></span><br><span class="line"><span class="comment">// This will update a existing one with the same id or create a new one instead</span></span><br><span class="line">realm.copy<span class="constructor">ToRealmOrUpdate(<span class="params">obj</span>)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，写入事务之间会互相阻塞，如果一个写入事务正在进行，那么其他的线程的写入事务就会阻塞它们所在的线程。同时在 UI线程和后台线程使用写入事务有可能导致ANR问题。可以使用异步事务（async transactions）以避免阻塞UI线程。<br>当正在进行一个写入事务时读取操作并不会被阻塞，这意味着，除非需要从多个线程进行并发写入操作，否则，可以尽量使用更大的写入事务来做更多的事情而不是使用多个更小的写入事务。<br>当写入事务被提交到 Realm 时，该Realm的所有其他实例都将被通知，读入隐式事务将自动刷新您每个Realm对象。</p>
<h4 id="5-Transaction-事务"><a href="#5-Transaction-事务" class="headerlink" title="5 Transaction 事务"></a>5 Transaction 事务</h4><p>除了上述的beginTransectiion，commitTransection外还有事务执行块以及异步事务这两种：</p>
<ul>
<li>事务执行块（Transaction blocks）</li>
</ul>
<p>异步执行块会自动处理写入事物的开始和提交，并在错误发生时取消写入事物。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">realm.executeTransaction(<span class="built_in">new</span> Realm.<span class="keyword">Transaction</span>() &#123;</span><br><span class="line">	@Override</span><br><span class="line">	<span class="built_in">public</span> <span class="type">void</span> <span class="keyword">execute</span>(Realm realm) &#123;</span><br><span class="line">		<span class="keyword">User</span> <span class="keyword">user</span> = realm.createObject(<span class="keyword">User</span>.<span class="keyword">class</span>);</span><br><span class="line">		<span class="keyword">user</span>.setName(&quot;John&quot;);</span><br><span class="line">		<span class="keyword">user</span>.setEmail(&quot;john@corporation.com&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>异步事务（Asynchronous Transactions）<br>事务会相互阻塞其所在的线程，在后台线程中开启事务进行写入操作可以有效避免 UI 线程被阻塞。通过使用异步事务，Realm 会在后台线程中进行写入操作，并在事务完成时将结果传回调用线程。<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">realm.<span class="title function_">executeTransactionAsync</span>(<span class="keyword">new</span> <span class="title class_">Realm</span>.<span class="title class_">Transaction</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">execute</span>(<span class="params">Realm bgRealm</span>) &#123;</span><br><span class="line">        <span class="title class_">User</span> user = bgRealm.<span class="title function_">createObject</span>(<span class="title class_">User</span>.<span class="property">class</span>);</span><br><span class="line">        user.<span class="title function_">setName</span>(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">        user.<span class="title function_">setEmail</span>(<span class="string">&quot;john@corporation.com&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> <span class="title class_">Realm</span>.<span class="property">Transaction</span>.<span class="title class_">OnSuccess</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onSuccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// Transaction was a success.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> <span class="title class_">Realm</span>.<span class="property">Transaction</span>.<span class="title class_">OnError</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable error</span>) &#123;</span><br><span class="line">        <span class="comment">// Transaction failed and was automatically canceled.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
OnSuccess 和 OnError 并不是必须重载的，重载了的回调函数会在事务成功或者失败时在被调用发生的线程执行。回调函数是通过 Looper 被执行的，所以在非 Looper 线程中只有空（null）回调函数被允许使用。<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">RealmAsyncTask <span class="keyword">transaction</span> = realm.executeTransactionAsync(<span class="built_in">new</span> Realm.<span class="keyword">Transaction</span>() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">execute</span>(Realm bgRealm) &#123;</span><br><span class="line">                <span class="keyword">User</span> <span class="keyword">user</span> = bgRealm.createObject(<span class="keyword">User</span>.<span class="keyword">class</span>);</span><br><span class="line">                <span class="keyword">user</span>.setName(&quot;John&quot;);</span><br><span class="line">                <span class="keyword">user</span>.setEmail(&quot;john@corporation.com&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>异步事务调用会返回一个 RealmAsyncTask 对象。当你退出 Activity 或者 Fragment 时可以使用该对象取消异步事务。如果你在回调函数中更新UI，那么忘记取消异步事务可能会造成你的应用崩溃。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="type">void</span> onStop () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">transaction</span> != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">transaction</span>.isCancelled()) &#123;</span><br><span class="line">        <span class="keyword">transaction</span>.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-查询数据条目："><a href="#6-查询数据条目：" class="headerlink" title="6. 查询数据条目："></a>6. 查询数据条目：</h4><p>要创建一个查询，使用相关Realm对象的where方法并传入相关的类。创建完查询之后，将会返回一个RealmResults。可以通过RealmResults对象的findAll方法获取所有的结果。<br>当查询没有任何匹配时，返回的 RealmResults 对象将不会为 null，取而代之的是它的 size() 方法将返回 0。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;MusicItemBean&gt; results1 =</span><br><span class="line">        musicRealmDB.where(<span class="module-access"><span class="module"><span class="identifier">MusicItemBean</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">All()</span>;</span><br><span class="line"><span class="keyword">for</span>(MusicItemBean music:results1) &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(<span class="string">&quot;xiaohai.lin&quot;</span>, music.set<span class="constructor">Title()</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Realm 支持如下的查询条件：</li>
</ul>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">between</span>()、<span class="built_in">greaterThan</span>()、<span class="built_in">lessThan</span>()、<span class="built_in">greaterThanOrEqualTo</span>() 和 <span class="built_in">lessThanOrEqualTo</span>()</span><br><span class="line"><span class="built_in">equalTo</span>() 和 <span class="built_in">notEqualTo</span>()</span><br><span class="line"><span class="built_in">contains</span>()、<span class="built_in">beginsWith</span>() 和 <span class="built_in">endsWith</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;MusicItemBean&gt; qury2 =</span><br><span class="line">        musicRealmDB.where(<span class="module-access"><span class="module"><span class="identifier">MusicItemBean</span>.</span></span><span class="keyword">class</span>)</span><br><span class="line">                .begins<span class="constructor">With(<span class="string">&quot;path&quot;</span>, “<span class="operator">/</span><span class="params">storage</span><span class="operator">/</span><span class="params">sdcard0</span><span class="operator">/</span>”)</span></span><br><span class="line">                .find<span class="constructor">All()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询条件的组合：</li>
</ul>
<p>字符串查询条件可以通过使用 Case.INSENSITIVE 修饰符来忽略字母 A-Z 和 a-z 的大小写。<br>并且可以使用 beginGroup()（相当于左括号）和 endGroup()（相当于右括号）来将查询条件组合起来：<br>此外，也可以用 not() 否定一个条件。该 not() 运算符可以与 beginGroup()&#x2F;endGroup() 一起使用来否定子条件。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; r = realm.where(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>)</span><br><span class="line">                            .greater<span class="constructor">Than(<span class="string">&quot;age&quot;</span>, 10)</span>  <span class="comment">//implicit AND</span></span><br><span class="line">                            .<span class="keyword">begin</span><span class="constructor">Group()</span></span><br><span class="line">                                .equal<span class="constructor">To(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Peter&quot;</span>)</span></span><br><span class="line">                                .<span class="keyword">or</span><span class="literal">()</span></span><br><span class="line">                                .contains(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jo&quot;</span>)</span><br><span class="line">                            .<span class="keyword">end</span><span class="constructor">Group()</span></span><br><span class="line">                            .find<span class="constructor">All()</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>对查询结果进行排序：</li>
</ul>
<p>如果想要查询的结果按照某项进行排序，那么可以使用findAllSorted，并传入一个boolean指定归类顺序，true表示升序排序，false表示降序排序。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;MusicItemBean&gt; qury2 =</span><br><span class="line">        musicRealmDB.where(<span class="module-access"><span class="module"><span class="identifier">Country</span>.</span></span><span class="keyword">class</span>)</span><br><span class="line">                .find<span class="constructor">AllSorted(<span class="string">&quot;title&quot;</span>, <span class="params">true</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>还可以通过sort来进行排序：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; result = realm.where(User.<span class="keyword">class</span>).<span class="keyword">findAll</span>();</span><br><span class="line">result = result.<span class="keyword">sort</span>(<span class="string">&quot;age&quot;</span>); <span class="comment">// Sort ascending</span></span><br><span class="line">result = result.<span class="keyword">sort</span>(<span class="string">&quot;age&quot;</span>, <span class="keyword">Sort</span>.DESCENDING);</span><br></pre></td></tr></table></figure>

<ul>
<li>为某个查询添加监听事件：</li>
</ul>
<p>下面是来自官网的，它将会监控age小于2的查询结果，如果我们往这里面添加了数据那么这个接口将会被回调：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">final RealmResults&lt;Dog&gt; puppies = realm.where(<span class="module-access"><span class="module"><span class="identifier">Dog</span>.</span></span><span class="keyword">class</span>).less<span class="constructor">Than(<span class="string">&quot;age&quot;</span>, 2)</span>.find<span class="constructor">All()</span>;</span><br><span class="line">puppies.add<span class="constructor">ChangeListener(<span class="params">new</span> RealmChangeListener&lt;RealmResults&lt;Dog&gt;&gt;()</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Change(RealmResults&lt;Dog&gt; <span class="params">results</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Queries are updated in real time</span></span><br><span class="line">        puppies.size<span class="literal">()</span>; <span class="comment">// =&gt; 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>聚合<br>RealmResult 自带一些聚合方法：<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; results <span class="operator">=</span> realm.where(User.class).findAll()<span class="comment">;</span></span><br><span class="line">long   sum     <span class="operator">=</span> results.sum(<span class="string">&quot;age&quot;</span>).longValue()<span class="comment">;</span></span><br><span class="line">long   min     <span class="operator">=</span> results.min(<span class="string">&quot;age&quot;</span>).longValue()<span class="comment">;</span></span><br><span class="line">long   max     <span class="operator">=</span> results.max(<span class="string">&quot;age&quot;</span>).longValue()<span class="comment">;</span></span><br><span class="line">double average <span class="operator">=</span> results.average(<span class="string">&quot;age&quot;</span>)<span class="comment">;</span></span><br><span class="line">long   matches <span class="operator">=</span> results.size()<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
<li>遍历查询结果：<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; results = realm.where(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">All()</span>;</span><br><span class="line"><span class="keyword">for</span> (User u : results) &#123;</span><br><span class="line">    <span class="comment">// ... do something with the object ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; results <span class="operator">=</span> realm.where(User.class).findAll()<span class="comment">;</span></span><br><span class="line">for (int i <span class="operator">=</span> <span class="number">0</span><span class="comment">; i &lt; results.size(); i++) &#123;</span></span><br><span class="line">    User u <span class="operator">=</span> results.get(i)<span class="comment">;</span></span><br><span class="line">    // ... do something with the object ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>异步查询</li>
</ul>
<p>声明并注册回调方法：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> RealmChangeListener callback = <span class="keyword">new</span> RealmChangeListener&lt;RealmResults&lt;User&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChange</span>(<span class="params">RealmResults&lt;User&gt; results</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// called once the query complete and on every update</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span>()</span> &#123;</span><br><span class="line">    RealmResults&lt;User&gt; result = realm.<span class="keyword">where</span>(User.<span class="keyword">class</span>).findAllAsync();</span><br><span class="line">    result.addChangeListener(callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在退出 Activity 或者 Fragment 时移除监听器的注册以避免内存泄漏。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStop</span> ()</span> &#123;</span><br><span class="line">    result.removeChangeListener(callback); <span class="comment">// remove a particular listener</span></span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    result.removeChangeListeners(); <span class="comment">// remove all registered listeners</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主动检查查询是否完成</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">RealmResults&lt;User&gt; result = realm.where(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">AllAsync()</span>;</span><br><span class="line"><span class="keyword">if</span> (result.is<span class="constructor">Loaded()</span>) &#123;</span><br><span class="line">  <span class="comment">// Results are now available</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意同步查询返回的 RealmResults 实例的 isLoaded 方法会永远返回 true。可以在 Looper线程中使用异步查询异步查询需要使用Handler来传递查询结果在没有Looper的线程中使用异步查询会导致IllegalStateException 异常被抛出。</p>
<h4 id="7-自动更新数据条目："><a href="#7-自动更新数据条目：" class="headerlink" title="7. 自动更新数据条目："></a>7. 自动更新数据条目：</h4><p>在Realm中只要调用set方法就会自动更新对应的条目，而不用像其他的数据库那样调用update方法：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">Dog myDog = realm.create<span class="constructor">Object(Dog.<span class="params">class</span>)</span>;</span><br><span class="line">myDog.set<span class="constructor">Name(<span class="string">&quot;Fido&quot;</span>)</span>;</span><br><span class="line">myDog.set<span class="constructor">Age(1)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br><span class="line"></span><br><span class="line">Dog myPuppy = realm.where(<span class="module-access"><span class="module"><span class="identifier">Dog</span>.</span></span><span class="keyword">class</span>).equal<span class="constructor">To(<span class="string">&quot;age&quot;</span>, 1)</span>.find<span class="constructor">First()</span>;</span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">myPuppy.set<span class="constructor">Age(2)</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="8-异步查询和更新数据"><a href="#8-异步查询和更新数据" class="headerlink" title="8. 异步查询和更新数据"></a>8. 异步查询和更新数据</h4><p>下面的示例是通过异步方式查询小狗的年龄等于1的狗并将其年龄设置为3.如果设置成功onSuccess方法将会被调用：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">realm.executeTransactionAsync(<span class="keyword">new</span> Realm.Transaction() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>(<span class="params">Realm realm</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// begin &amp; end transcation calls are done for you</span></span><br><span class="line">        Dog theDog = realm.<span class="keyword">where</span>(Dog.<span class="keyword">class</span>).<span class="keyword">equals</span>(<span class="string">&quot;age&quot;</span>, <span class="number">1</span>).findFirst();</span><br><span class="line">        theDog.setAge(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Realm.Transaction.Callback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span>()</span> &#123;</span><br><span class="line">	<span class="comment">// Original Queries and Realm objects are automatically updated.</span></span><br><span class="line">	puppies.size(); <span class="comment">// =&gt; 0 because there are no more puppies (less than 2 years old)</span></span><br><span class="line">	dog.getAge();   <span class="comment">// =&gt; 3 the dogs age is updated</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="9-删除数据"><a href="#9-删除数据" class="headerlink" title="9. 删除数据"></a>9. 删除数据</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// obtain the results of a query</span></span><br><span class="line">RealmResults&lt;Dog&gt; results = realm.where(<span class="module-access"><span class="module"><span class="identifier">Dog</span>.</span></span><span class="keyword">class</span>).find<span class="constructor">All()</span>;</span><br><span class="line"><span class="comment">// All changes to data must happen in a transaction</span></span><br><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line"><span class="comment">// remove single match</span></span><br><span class="line">results.delete<span class="constructor">FromRealm(0)</span>;</span><br><span class="line">results.delete<span class="constructor">LastFromRealm()</span>;</span><br><span class="line"><span class="comment">// remove a single object</span></span><br><span class="line">Dog dog = results.get(<span class="number">5</span>);</span><br><span class="line">dog.delete<span class="constructor">FromRealm()</span>;</span><br><span class="line"><span class="comment">// Delete all matches</span></span><br><span class="line">results.delete<span class="constructor">AllFromRealm()</span>;</span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10-多表关系"><a href="#10-多表关系" class="headerlink" title="10. 多表关系"></a>10. 多表关系</h3><p>任意两个 RealmObject 可以相互关联。<br>下面的例子中Contact与Email建立了关联：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> address;</span><br><span class="line">    <span class="keyword">private</span> boolean active;</span><br><span class="line">    <span class="comment">// ... setters and getters left out</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Email</span> email;</span><br><span class="line">    <span class="comment">// ... setters and getters left out</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>多对一 关系</li>
</ul>
<p>要实现多对一的关联只需要简单地声明一个 Realm 模型类的属性即可：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Email</span> email;</span><br><span class="line">    <span class="comment">// Other fields…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置一个类型为 RealmObject 的属性为空值（null）会清除该属性的引用，但并不会删除对应的 RealmObject。</p>
<ul>
<li>多对多 关系</li>
</ul>
<p>要实现多对多的关联可以通过使用 RealmList<T> 为一个对象关联0或多个其它对象。</T></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">RealmList</span>&lt;<span class="type">Email</span>&gt; emails;</span><br><span class="line">    <span class="comment">// Other fields…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RealmList 是 Realm 模型对象的容器，其行为与 Java 的普通 List 近乎一样。<br>同一个 Realm 模型对象可以存在于多个 RealmList 中。<br>同一个 Realm 模型对象可以在同一个 RealmList 中存在多次。</p>
<p>使用 Contact 和 Email 类</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> address;</span><br><span class="line">    <span class="keyword">private</span> boolean active;</span><br><span class="line">    <span class="comment">// ... setters and getters left out</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Email</span> email;</span><br><span class="line">    <span class="comment">// ... setters and getters left out</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以通过标准的 getter 和 setter 来访问 RealmList.</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">realm.<span class="keyword">begin</span><span class="constructor">Transaction()</span>;</span><br><span class="line">Contact contact = realm.create<span class="constructor">Object(Contact.<span class="params">class</span>)</span>;</span><br><span class="line">contact.set<span class="constructor">Name(<span class="string">&quot;John Doe&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line">Email email1 = realm.create<span class="constructor">Object(Email.<span class="params">class</span>)</span>;</span><br><span class="line">email1.set<span class="constructor">Address(<span class="string">&quot;john@example.com&quot;</span>)</span>;</span><br><span class="line">email1.set<span class="constructor">Active(<span class="params">true</span>)</span>;</span><br><span class="line">contact.get<span class="constructor">Emails()</span>.add(email1);</span><br><span class="line"></span><br><span class="line">Email email2 = realm.create<span class="constructor">Object(Email.<span class="params">class</span>)</span>;</span><br><span class="line">email2.set<span class="constructor">Number(<span class="string">&quot;jd@example.com&quot;</span>)</span>;</span><br><span class="line">email2.set<span class="constructor">Active(<span class="params">false</span>)</span>;</span><br><span class="line">contact.get<span class="constructor">Emails()</span>.add(email2);</span><br><span class="line"></span><br><span class="line">realm.commit<span class="constructor">Transaction()</span>;</span><br></pre></td></tr></table></figure>


<p>Realm支持关联查询。以如下模型举例：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> id;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">RealmList</span>&lt;<span class="type">Dog</span>&gt; dogs;</span><br><span class="line">  <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">RealmObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> id;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> color;</span><br><span class="line">  <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个 User 对象都与多个 Dog 对象相关联，如下图所示：</p>
<p><img src="/2016/06/11/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D-Realm/2.png"></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// users =&gt; [U1,U2]</span></span><br><span class="line">RealmResults&lt;User&gt; users = realm.where(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>)</span><br><span class="line">                                .equal<span class="constructor">To(<span class="string">&quot;dogs.color&quot;</span>, <span class="string">&quot;Brown&quot;</span>)</span></span><br><span class="line">                                .find<span class="constructor">All()</span>;</span><br></pre></td></tr></table></figure>
<p>以上的查询含义为“所有至少含有一个 color 为 Brown 的 User”。请务必注意，这里的返回的 User 中，有可能包含 color 不为 Brown 的 Dog 对象，因为在其 RealmList 列表中，其它的 Dog 对象满足查询条件：</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">// <span class="built_in">r1</span> =&gt; [U1,U2]</span><br><span class="line">RealmResults&lt;User&gt; <span class="built_in">r1</span> = realm<span class="number">.</span>where(User<span class="number">.</span>class)</span><br><span class="line"><span class="meta">                             .equalTo</span>(<span class="string">&quot;dogs.name&quot;</span>, <span class="string">&quot;Fluffy&quot;</span>)</span><br><span class="line"><span class="meta">                             .findAll</span>()<span class="comment">;</span></span><br><span class="line">// <span class="built_in">r2</span> =&gt; [U1,U2]</span><br><span class="line">RealmResults&lt;User&gt; <span class="built_in">r2</span> = <span class="built_in">r1</span><span class="number">.</span>where()</span><br><span class="line"><span class="meta">                          .equalTo</span>(<span class="string">&quot;dogs.color&quot;</span>, <span class="string">&quot;Brown&quot;</span>)</span><br><span class="line"><span class="meta">                          .findAll</span>()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>请注意第一个查询返回两个 User 对象，因为它们都满足查询条件。每个 User 对象都包含一个 Dog 对象列表——列表中至少有一个 Dog 对象满足查询条件。谨记我们是在寻找其拥有的 Dog 对象满足条件（name 和 color）的 User，不是在针对 Dog 对象进行查询。<br>因此第二个查询建立在第一个的 User 结果（r1）以及 r1 的每个 User 的 Dog 列表之上。两个 User 仍然满足第二个查询，但这次是 color 满足查询条件。</p>
<p>我们再深入了解下这个概念，请看以下代码：</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">// <span class="built_in">r1</span> =&gt; [u1,u2]</span><br><span class="line">realmresults&lt;user&gt; <span class="built_in">r1</span> = realm<span class="number">.</span>where(user<span class="number">.</span>class)</span><br><span class="line"><span class="meta">                             .equalto</span>(<span class="string">&quot;dogs.name&quot;</span>, <span class="string">&quot;fluffy&quot;</span>)</span><br><span class="line"><span class="meta">                             .equalto</span>(<span class="string">&quot;dogs.color&quot;</span>, <span class="string">&quot;brown&quot;</span>)</span><br><span class="line"><span class="meta">                             .findall</span>()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// <span class="built_in">r2</span> =&gt; [u2]</span><br><span class="line">realmresults&lt;user&gt; <span class="built_in">r2</span> = realm<span class="number">.</span>where(user<span class="number">.</span>class)</span><br><span class="line"><span class="meta">                             .equalto</span>(<span class="string">&quot;dogs.name&quot;</span>, <span class="string">&quot;fluffy&quot;</span>)</span><br><span class="line"><span class="meta">                             .findall</span>()</span><br><span class="line"><span class="meta">                             .where</span>()</span><br><span class="line"><span class="meta">                             .equalto</span>(<span class="string">&quot;dogs.color&quot;</span>, <span class="string">&quot;brown&quot;</span>)</span><br><span class="line"><span class="meta">                             .findall</span>()<span class="comment">;</span></span><br><span class="line"><span class="meta">                             .where</span>()</span><br><span class="line"><span class="meta">                             .equalto</span>(<span class="string">&quot;dogs.color&quot;</span>, <span class="string">&quot;yellow&quot;</span>)</span><br><span class="line"><span class="meta">                             .findall</span>()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>第一个查询表示找到所有的User他至少有一个Dog的名字为fluffy并且找到所有User他至少有一个Dog的颜色是brown 然后返回这两个结果的交集。<br>第二个查询表示找到所有的User他至少有一个Dog的名字为fluffy；然后在这个结果之上找到所有的User他至少有一个Dog的颜色为brown；<br>最后在之前的结果之上找到所有的 User 他至少有一个 Dog 的颜色为 yellow。</p>
<p>我们来解释一下第一个查询以深入了解下这个行为。两个条件分别是equalto(“dogs.name”, “fluffy”) 和 equalto(“dogs.color”, “brown”)。<br>u1和u2 完全满足第一个条件 ——我们称其c1集合。u1和u2也同时完全满足第二个条件——我们称其 c2 集合。查询中的逻辑与即是c1与c2的交集c1与c2的交集就是u1和u2。因此r1就包含u1和u2。</p>
<p>第二个查询不一样。我们来分别讲解。该查询第一部分看起来是这样的：realmresults<user> r2a &#x3D; realm.where(user.class).equalto(“dogs.name”, “fluffy”).findall()。<br>它的结果包含 u1 和 u2。然后 r2b &#x3D; r2a.where().equalto(“dogs.color”, “brown”).findall();<br>的结果仍然包含 u1 和 u2 （两个 User 都有颜色为 brown 的 Dog）。最后的查询 r2 &#x3D; r2b.where().equalto(“dogs.color”, “yellow”).findall();<br> 结果只包含 u2，因为只有 u2 同时有一个颜色为 brown 的 Dog 和一个颜色为 yellow 的 Dog。</user></p>
<h3 id="11-自动更新（Auto-Refresh）"><a href="#11-自动更新（Auto-Refresh）" class="headerlink" title="11 自动更新（Auto-Refresh）"></a>11 自动更新（Auto-Refresh）</h3><p>如果 Realm 实例存在于一个带有 Looper 的线程，那么这个 Realm 实例即具有自动更新的功能。这意味这如果发生了 Realm 数据库的变化，那么该 Realm 实例会在下一个事件循环（event loop）中自动更新。这个便捷的功能使您不必花费太多的精力就能保证的UI与数据的实时同步。<br>如果 Realm 的实例所在线程没有绑定 Looper，那么该实例不会被更新直到您手动调用 waitForChange() 方法。请注意，不更新 Realm 以保持对旧数据的引用会造成而外的磁盘和内存开销。这也是为什么要在线程结束时调用 close() 关闭 Realm 实例的一个重要原因。<br>如果您想确定当前 Realm 实例是否有自动更新功能，可以通过调用 isAutoRefresh() 方法查询。</p>
<h4 id="12-实际例子"><a href="#12-实际例子" class="headerlink" title="12 实际例子"></a>12 实际例子</h4><p>下面是官网给出的一些学习Demo建议大家通过这些代码来学习会比较快点：<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/introExample">introExample</a> 包含了如何使用当前的API的简单例子。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/gridViewExample">gridViewExample</a> 用来展示如何使用 Realm 作为 GridView 的后端存储。它同时也展示了如何用 JSON 来填充数据库。另外还有怎么通过 ABI splits 来缩小 APK 体积。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/threadExample">threadExample</a> 展示了如何在多线程环境中使用 Realm。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/adapterExample">adapterExample</a> 展示了如何以一个非常便捷的方式使用 RealmBaseAdapter 绑定 RealmResults 到安卓的 ListView。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/jsonExample">jsonExample</a> 展示了 Realm 与 JSON 相关的功能。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/encryptionExample">encryptionExample</a> 向您展示如何使用加密的 Realm。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/rxJavaExample">rxJavaExamples</a> 展示了如何与 RxJava 结合使用 Realm。<br><a target="_blank" rel="noopener" href="https://github.com/realm/realm-java/tree/master/examples/unitTestExample">unitTestExample</a> 展示了如何写与 Realm 相关的单元测试。</p>
<p>下面是API文档链接：<br>！<a target="_blank" rel="noopener" href="https://realm.io/cn/docs/java/latest/api/">Realm API</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/11/Android-进阶之第三方库的介绍-Realm/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/11/Android-进阶之第三方库的介绍-Realm/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/10/Android-进阶之第三方库的介绍-Gson/" title="Android 进阶之第三方库的介绍 Gson" itemprop="url">Android 进阶之第三方库的介绍 Gson</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-06-10T14:25:23.000Z" itemprop="datePublished"> Published 2016-06-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>做Android开发的每位工程师想必都会接触到Json，它是客户端与服务器进行数据交互时使用的一种数据交换格式。当然大家也可能只接触过XML，但是这种可能性不是很大，因为涉及到客户端和服务端交互这种事情，一般都不是自己能够说得算的，还要取决于服务端开发工程师的习惯，一般大家都比较推崇JSON格式，因为XML方式解析较为麻烦，并且XML形式的交换方式数据较大，不如JSON来得轻量。Java中最常用的JSON解析库有：JSON-Java、Gson、Jackson、FastJson等，这些类库就我个人来说并没都使用过，网上有其他人做过对比，这些解析库中来自阿里的FastJson性能最好。这个我自己没有亲自做过这方面的对比所以也不肯定，大家如果有兴趣找找对应的文章看看。</p>
<h4 id="JSON语法简介"><a href="#JSON语法简介" class="headerlink" title="JSON语法简介"></a>JSON语法简介</h4><p>如果大家对JSON还不了解，可以到如下网站上了解下。它其实也是一种key&#x2F;value的形式的数据交换方式.<br><a target="_blank" rel="noopener" href="http://www.json.org.cn/">http://www.json.org.cn/</a><br><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/json/json_syntax.asp">http://www.w3school.com.cn/json/json_syntax.asp</a><br>下面是最核心的语法，大家如果不想花太多时间在这部分的话，可以简单下看下下面的语法，其实Json语法很简单花一两分钟就可以完全掌握了。</p>
<ul>
<li><p>总体语法：</p>
<ul>
<li>数据在名称&#x2F;值对中</li>
<li>两个数据之间由逗号分隔</li>
<li>花括号保存对象</li>
<li>方括号保存数组</li>
</ul>
</li>
<li><p>名值对定义：<br>  JSON 名称&#x2F;值对 定义如下</p>
  <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;firstName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;John&quot;</span></span><br></pre></td></tr></table></figure>
<p>  变量名和数值使用冒号隔开。</p>
<p>  JSON 值可以是：</p>
<ul>
<li>数字（整数或浮点数）</li>
<li>字符串（在双引号中）</li>
<li>逻辑值（true 或 false）</li>
<li>数组（在方括号中）</li>
<li>对象（在花括号中）</li>
<li>null</li>
</ul>
</li>
<li><p>JSON 对象<br>  JSON 对象在花括号中书写：<br>  对象可以包含多个名称&#x2F;值对：</p>
  <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span><span class="string">&quot;John&quot;</span> <span class="punctuation">,</span> <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Doe&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>JSON 数组<br>  JSON 数组在方括号中书写：<br>  数组可包含多个对象：</p>
  <figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;employees&quot;</span>: [</span><br><span class="line">        &#123; <span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;John&quot;</span> , <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Doe&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Anna&quot;</span> , <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Smith&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Peter&quot;</span> , <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Jones&quot;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  下面是一个比较简单的例子：</p>
  <figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">     <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">     <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;female&quot;</span>,</span><br><span class="line">     <span class="string">&quot;age&quot;</span>: <span class="number">28</span>,</span><br><span class="line">     <span class="string">&quot;address&quot;</span>: </span><br><span class="line">     &#123;</span><br><span class="line">         <span class="string">&quot;streetAddress&quot;</span>: <span class="string">&quot;21 2nd Street&quot;</span>,</span><br><span class="line">         <span class="string">&quot;city&quot;</span>: <span class="string">&quot;New York&quot;</span>,</span><br><span class="line">         <span class="string">&quot;state&quot;</span>: <span class="string">&quot;NY&quot;</span>,</span><br><span class="line">         <span class="string">&quot;postalCode&quot;</span>: <span class="string">&quot;10021&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">&quot;phoneNumber&quot;</span>: </span><br><span class="line">     [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="string">&quot;type&quot;</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">           <span class="string">&quot;number&quot;</span>: <span class="string">&quot;212 555-1234&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="string">&quot;type&quot;</span>: <span class="string">&quot;fax&quot;</span>,</span><br><span class="line">           <span class="string">&quot;number&quot;</span>: <span class="string">&quot;646 555-4567&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="往Android-Studio中添加-GSON："><a href="#往Android-Studio中添加-GSON：" class="headerlink" title="往Android Studio中添加 GSON："></a>往Android Studio中添加 GSON：</h4><p>下面是GitHub的地址，上面给出了GSON的源码，文档地址等<br><a target="_blank" rel="noopener" href="https://github.com/google/gson">https://github.com/google/gson</a><br>下面是一个推荐的GSON教程供进一步深入学习。<br><a target="_blank" rel="noopener" href="http://www.studytrails.com/java/json/java-google-json-introduction.jsp">http://www.studytrails.com/java/json/java-google-json-introduction.jsp</a></p>
<p>要在Android studio中导入GSON，需要在gradle.build中添加如下依赖关系：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">compile</span> &#x27;com.google.code.gson:gson:<span class="number">2</span>.<span class="number">6</span>.<span class="number">2</span>&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="基本使用："><a href="#基本使用：" class="headerlink" title="基本使用："></a>基本使用：</h4><p>Gson中提供了fromJson() 和toJson() 两个直接用于解析和生成的方法，前者可以将数据从JSON中取出这个过程称为反序列化，后者用于将数据转化为JSON格式，称为序列化。</p>
<ul>
<li><p>序列化</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> <span class="constructor">Gson()</span>;</span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(100)</span>;            		<span class="comment">//int</span></span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(<span class="string">&quot;jimmy&quot;</span>)</span>;       		<span class="comment">//String</span></span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(<span class="params">new</span> Long(1000000000)</span>);  <span class="comment">//Long</span></span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(<span class="params">true</span>)</span>;         			<span class="comment">//boolean</span></span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(<span class="params">new</span> Date()</span>);   			<span class="comment">//Date</span></span><br><span class="line"><span class="built_in">int</span><span class="literal">[]</span> values = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">gson.<span class="keyword">to</span><span class="constructor">Json(<span class="params">values</span>)</span>;       			<span class="comment">//array</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>反序列化</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">int one = gson.fromJson(<span class="string">&quot;100&quot;</span>, int.<span class="keyword">class</span>);</span><br><span class="line"><span class="type">Integer</span> oneInteger = gson.fromJson(<span class="string">&quot;100&quot;</span>, <span class="type">Integer</span>.<span class="keyword">class</span>);</span><br><span class="line"><span class="type">Long</span> oneLong = gson.fromJson(<span class="string">&quot;1000&quot;</span>, <span class="type">Long</span>.<span class="keyword">class</span>);</span><br><span class="line"><span class="type">Boolean</span> falseBoolean = gson.fromJson(<span class="string">&quot;false&quot;</span>, <span class="type">Boolean</span>.<span class="keyword">class</span>);</span><br><span class="line"><span class="type">String</span> str = gson.fromJson(<span class="string">&quot;\&quot;</span>abc\<span class="string">&quot;&quot;</span>, <span class="type">String</span>.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>POJO类的序列化和反序列化：<br>  上面介绍的是最基本类的序列化和反序列化，但是上面的使用范围十分有限，更为常见的是POJO的序列化和反序列化：</p>
<ul>
<li><p>JavaBean 序列化<br>  定义 Bean对象：</p>
  <figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id = <span class="number">000001</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> name = <span class="string">&quot;jimmy&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age = <span class="number">28</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  序列化 JavaBean</p>
  <figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> <span class="type">Gson</span>();</span><br><span class="line"><span class="keyword">String</span> customjson = gson.toJson(<span class="keyword">new</span> <span class="type">User</span>());</span><br></pre></td></tr></table></figure>
</li>
<li><p>JavaBean 反序列化：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">String jsonRes = &quot;&#123;\&quot;id\&quot;:000001,\&quot;<span class="type">name</span>\&quot;:\&quot;jimmy\&quot;,\&quot;age\&quot;:25&#125;&quot;</span><br><span class="line"><span class="keyword">User</span> <span class="keyword">user</span> = gson.fromJson(jsonRes, <span class="keyword">User</span>.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="GSON-流式序列化反序列化"><a href="#GSON-流式序列化反序列化" class="headerlink" title="GSON 流式序列化反序列化"></a>GSON 流式序列化反序列化</h4><ul>
<li>Gson的流式反序列化<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">String gsonString = &quot;&#123;\&quot;<span class="type">name</span>\&quot;:\&quot;jimmy\&quot;,\&quot;age\&quot;:\&quot;<span class="number">28</span>\&quot;&#125;&quot;;</span><br><span class="line"><span class="keyword">User</span> <span class="keyword">user</span> = <span class="built_in">new</span> <span class="keyword">User</span>();</span><br><span class="line">JsonReader gsonReader = <span class="built_in">new</span> JsonReader(<span class="built_in">new</span> StringReader(gsonString));</span><br><span class="line">gsonReader.beginObject();</span><br><span class="line"><span class="keyword">while</span> (gsonReader.hasNext()) &#123;</span><br><span class="line">    String tag = gsonReader.nextName();</span><br><span class="line">    switch (tag) &#123;</span><br><span class="line">        <span class="keyword">case</span> &quot;name&quot;:</span><br><span class="line">            <span class="keyword">user</span>.name = gsonReader.nextString();</span><br><span class="line">            break;</span><br><span class="line">        <span class="keyword">case</span> &quot;age&quot;:</span><br><span class="line">            <span class="keyword">user</span>.age = gsonReader.nextInt();</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">gsonReader.endObject();</span><br></pre></td></tr></table></figure></li>
<li>Gson的流式序列化<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">JsonWriter gsonwriter = <span class="keyword">new</span> <span class="constructor">JsonWriter(<span class="params">new</span> OutputStreamWriter(System.<span class="params">out</span>)</span>);</span><br><span class="line">gsonwriter.<span class="keyword">begin</span><span class="constructor">Object()</span></span><br><span class="line">        .name(<span class="string">&quot;name&quot;</span>).value(<span class="string">&quot;jimmy&quot;</span>)</span><br><span class="line">        .name(<span class="string">&quot;age&quot;</span>).value(<span class="number">28</span>)</span><br><span class="line">        .<span class="keyword">end</span><span class="constructor">Object()</span>;</span><br><span class="line">gsonwriter.flush<span class="literal">()</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Gson中使用泛型"><a href="#Gson中使用泛型" class="headerlink" title="Gson中使用泛型"></a>Gson中使用泛型</h4><p>要在GSON中使用泛型必须使用TypeToken，当我们希望将数据解析为List<String>时可以写成：</String></p>
<figure class="highlight wren"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="variable">new</span> <span class="title class_">Gson</span>();</span><br><span class="line"><span class="title class_">String</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="string">&quot;[<span class="char escape_">\&quot;</span>Android<span class="char escape_">\&quot;</span>,<span class="char escape_">\&quot;</span>IOS<span class="char escape_">\&quot;</span>,<span class="char escape_">\&quot;</span>WINDPHONE<span class="char escape_">\&quot;</span>]&quot;</span>;</span><br><span class="line"><span class="title class_">String</span>[] <span class="variable">strings</span> <span class="operator">=</span> <span class="variable">gson</span>.<span class="property">fromJson</span>(<span class="variable">jsonArray</span>, <span class="title class_">String</span>[].<span class="property">class</span>);</span><br><span class="line"><span class="title class_">List</span><span class="operator">&lt;</span><span class="title class_">String</span><span class="operator">&gt;</span> <span class="variable">stringList</span> <span class="operator">=</span> <span class="variable">gson</span>.<span class="property">fromJson</span>(<span class="variable">jsonArray</span>, <span class="variable">new</span> <span class="title class_">TypeToken</span><span class="operator">&lt;</span><span class="title class_">List</span><span class="operator">&lt;</span><span class="title class_">String</span><span class="operator">&gt;&gt;</span>() &#123;&#125;.<span class="property">getType</span>());</span><br></pre></td></tr></table></figure>
<p>使用泛型</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">ResponeResult</span>&lt;<span class="symbol">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> code;</span><br><span class="line">    <span class="keyword">public</span> String message;</span><br><span class="line">    <span class="keyword">public</span> T data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如何使用：</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">Type <span class="keyword">user</span> = new TypeToken<span class="variable">&lt;ResponeResult&lt;User&gt;</span>&gt;()&#123;&#125;.getType();</span><br><span class="line">Result<span class="variable">&lt;User&gt;</span> <span class="keyword">user</span>Result = gson.<span class="keyword">from</span>Json(json,<span class="keyword">user</span>Type);</span><br><span class="line">User <span class="keyword">user</span> = <span class="keyword">user</span>Result.data;</span><br><span class="line"></span><br><span class="line">Type <span class="keyword">user</span>List = new TypeToken<span class="variable">&lt;ResponeResult&lt;List&lt;User&gt;</span>&gt;&gt;()&#123;&#125;.getType();</span><br><span class="line">ResponeResult<span class="variable">&lt;List&lt;User&gt;</span>&gt; <span class="keyword">user</span>ListResult = gson.<span class="keyword">from</span>Json(json,<span class="keyword">user</span>List);</span><br><span class="line">List<span class="variable">&lt;User&gt;</span> users = <span class="keyword">user</span>ListResult.data;</span><br></pre></td></tr></table></figure>


<h4 id="默认GSON-的定制化："><a href="#默认GSON-的定制化：" class="headerlink" title="默认GSON 的定制化："></a>默认GSON 的定制化：</h4><p>一般情况下上面介绍的GSON已经够大家用了，但是还是有些常用的配置需要我们在序列化和反序列化的时候对其进行序列化和反序列化规则的配置：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> <span class="constructor">GsonBuilder()</span></span><br><span class="line">        <span class="comment">//序列化null，默认的情况下null值是不序列化的</span></span><br><span class="line">        .serialize<span class="constructor">Nulls()</span></span><br><span class="line">        <span class="comment">// 设置日期时间格式，在序列化和反序化时均生效</span></span><br><span class="line">        .set<span class="constructor">DateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span></span><br><span class="line">        <span class="comment">//禁此序列化内部类</span></span><br><span class="line">        .disable<span class="constructor">InnerClassSerialization()</span></span><br><span class="line">        <span class="comment">//生成不可执行的Json（多了 )]&#125;&#x27; 这4个字符）</span></span><br><span class="line">        .generate<span class="constructor">NonExecutableJson()</span></span><br><span class="line">        <span class="comment">//禁止转义html标签</span></span><br><span class="line">        .disable<span class="constructor">HtmlEscaping()</span></span><br><span class="line">        <span class="comment">//格式化输出</span></span><br><span class="line">        .set<span class="constructor">PrettyPrinting()</span></span><br><span class="line">        .create<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="常用的注释标志"><a href="#常用的注释标志" class="headerlink" title="常用的注释标志"></a>常用的注释标志</h4><ul>
<li><p>属性重命名 @SerializedName 注解的使用</p>
<p>  从上面POJO的生成与解析可以看出在默认情况下GSON要求Bean的成员变量名和json字段名以及变量类型都应该一致，但是这个是很难保证的，一般客户端的开发和服务端的开发是分开来的，不可能服务端一修改我们这边就跟着改，特别是两个开发语言命名的规则不同的时候，一般都会存在纷争，GSON为了克服这个问题引入了@SerializedName。</p>
</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SerializedName(<span class="string">&quot;office_tel&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> String officeTel;</span><br></pre></td></tr></table></figure>
<p>这样GSON就会将来自服务端的json中的office_tel与Bean中的officeTel关联起来：<br>还有种比较难搞定的情况,Bean 中的某个字段对应对应服务器端的多个变量名的时候，可以使用如下方式为<br>为POJO字段提供备选属性名：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SerializedName(value = <span class="string">&quot;officeTel&quot;</span>, alternate = &#123;<span class="string">&quot;tel&quot;</span>, <span class="string">&quot;office_tel&quot;</span>&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String officeTel;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>选择性导出</p>
<ul>
<li>@Expose</li>
</ul>
</li>
</ul>
<p>有的时候我们需要对POJO中的某些字段进行有选择性的导出，这时候我们就可以通过在要导出的字段上加上@Expose注解，不导出的字段不加的方式来达到这个目的：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Expose</span>(deserialize = true,serialize = true) 	<span class="comment">//序列化和反序列化都生效</span></span><br><span class="line"><span class="variable">@Expose</span>(deserialize = true,serialize = false) 	<span class="comment">//反序列化时生效</span></span><br><span class="line"><span class="variable">@Expose</span>(deserialize = false,serialize = true) 	<span class="comment">//序列化时生效</span></span><br><span class="line"><span class="variable">@Expose</span>(deserialize = false,serialize = false) <span class="comment">//序列化和反序列化都不生效</span></span><br></pre></td></tr></table></figure>

<pre><code>这种情况下就不能使用默认的GSON了，而必须使用上面介绍的GsonBuild进行定制：
</code></pre>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> <span class="constructor">GsonBuilder()</span></span><br><span class="line">        .exclude<span class="constructor">FieldsWithoutExposeAnnotation()</span></span><br><span class="line">        .create<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<pre><code>* @Since @Until基于版本号导出：
有时候我们的某些字段在某个版本是不需要导出的，这种情形就可以通过@Since 和 @Until,并结合GsonBuilder.setVersion(Double)来实现。这种情况个人是没有用到过，但是以后的开发中应该会有这种需求。

* 基于访问修饰符：
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">.excludeFieldsWithModifiers(Modifier.<span class="keyword">FINAL</span>, Modifier.<span class="keyword">STATIC</span>, Modifier.<span class="keyword">PRIVATE</span>)</span><br><span class="line">.create();</span><br></pre></td></tr></table></figure>
* 自定义排除规则：
</code></pre>
<p>要自定义排除规则可以通过在创建GsonBuilder的时候通过addSerializationExclusionStrategy 和addDeserializationExclusionStrategy方法分别添加序列化和反序列化的排除规则。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Gson</span> gson = <span class="keyword">new</span> <span class="title class_">GsonBuilder</span>()</span><br><span class="line">        .<span class="title function_">addSerializationExclusionStrategy</span>(<span class="keyword">new</span> <span class="title class_">ExclusionStrategy</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">shouldSkipField</span>(<span class="params">FieldAttributes f</span>) &#123;</span><br><span class="line">                <span class="comment">// 这里作判断，决定要不要排除该字段,return true为排除</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">shouldSkipClass</span>(<span class="params">Class&lt;?&gt; clazz</span>) &#123;</span><br><span class="line">                <span class="comment">// 直接排除某个类 ，return true为排除</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">       .<span class="title function_">create</span>();</span><br></pre></td></tr></table></figure>

<h4 id="某种类型序列化和反序列化过程的自定义："><a href="#某种类型序列化和反序列化过程的自定义：" class="headerlink" title="某种类型序列化和反序列化过程的自定义："></a>某种类型序列化和反序列化过程的自定义：</h4><ul>
<li><p>TypeAdapter<br>首先定义一个User类型的TypeAdapter，覆写里面的write以及read方法。这两个方法会在后续操作User.class的时候被调用。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> UserTypeAdapter extends TypeAdapter&lt;<span class="keyword">User</span>&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">write</span>(JsonWriter <span class="keyword">out</span>, <span class="keyword">User</span> <span class="keyword">value</span>) throws IOException &#123;</span><br><span class="line">        <span class="keyword">out</span>.beginObject();</span><br><span class="line">        <span class="keyword">out</span>.name(&quot;name&quot;).<span class="keyword">value</span>(<span class="keyword">value</span>.name);</span><br><span class="line">        <span class="keyword">out</span>.name(&quot;age&quot;).<span class="keyword">value</span>(<span class="keyword">value</span>.age);</span><br><span class="line">        <span class="keyword">out</span>.endObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> <span class="keyword">User</span> <span class="keyword">read</span>(JsonReader <span class="keyword">in</span>) throws IOException &#123;</span><br><span class="line">        <span class="keyword">User</span> <span class="keyword">user</span> = <span class="built_in">new</span> <span class="keyword">User</span>();</span><br><span class="line">        <span class="keyword">in</span>.beginObject();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">in</span>.hasNext()) &#123;</span><br><span class="line">            switch (<span class="keyword">in</span>.nextName()) &#123;</span><br><span class="line">                <span class="keyword">case</span> &quot;name&quot;:</span><br><span class="line">                    <span class="keyword">user</span>.name = <span class="keyword">in</span>.nextString();</span><br><span class="line">                    break;</span><br><span class="line">                <span class="keyword">case</span> &quot;age&quot;:</span><br><span class="line">                    <span class="keyword">user</span>.age = <span class="keyword">in</span>.nextInt();</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">in</span>.endObject();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">user</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现TypeAdapter后还需要通过registerTypeAdapter注册给GsonBuilder，在注册的时候需要指定要关联的对象以及对应的TypeAdapter类型。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">User</span> <span class="keyword">user</span> = <span class="built_in">new</span> <span class="keyword">User</span>(&quot;jimmy&quot;, <span class="number">28</span>);</span><br><span class="line">Gson gson = <span class="built_in">new</span> GsonBuilder()</span><br><span class="line">        //为<span class="keyword">User</span>注册TypeAdapter</span><br><span class="line">        .registerTypeAdapter(<span class="keyword">User</span>.<span class="keyword">class</span>, <span class="built_in">new</span> UserTypeAdapter())</span><br><span class="line">        .<span class="keyword">create</span>();</span><br></pre></td></tr></table></figure>

<p>  再考虑如下情况，如果有多个类继承自同一个父类，并且我们对这一系列的子类都使用同一种方式序列化以及反序列化，那么这种情况有两种做法，一种是使用registerTypeAdapter对一个个子类进行注册，另一种是使用registerTypeHierarchyAdapter注册父类即可。但是一定要注意registerTypeHierarchyAdapter不支持泛型。</p>
</li>
<li><p>JsonSerializer与JsonDeserializer<br>上面的registerTypeAdapter必须同步指定序列化和反序列化的实现，如果并不是想序列化和反序列化两个过程都重新覆写，只是想实现其中之一那么可以使用JsonSerializer与JsonDeserializer来代替TypeAdapter<br>下面是来自<a target="_blank" rel="noopener" href="http://www.studytrails.com/java/json/java-google-json-custom-serializer-deserializer.jsp">http://www.studytrails.com/java/json/java-google-json-custom-serializer-deserializer.jsp</a> 的JsonDeserializer用法的例子</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> DogDeserialiser implements JsonDeserializer&lt;Dog&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="built_in">public</span> Dog deserialihttp://www.studytrails.com/java/<span class="type">json</span>/java-google-<span class="type">json</span>-custom-serializer-deserializer.jspze(JsonElement <span class="type">json</span>, <span class="keyword">Type</span> typeOfT, JsonDeserializationContext context) throws JsonParseException &#123;</span><br><span class="line">        String <span class="type">name</span> = <span class="type">json</span>.getAsJsonObject().<span class="keyword">get</span>(&quot;name&quot;).getAsString();</span><br><span class="line">        <span class="type">name</span> = <span class="type">name</span>.replace(&quot; &quot;, &quot;_&quot;);</span><br><span class="line">        Dog dog = <span class="built_in">new</span> Dog(<span class="type">name</span>);</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;</span><br><span class="line">        String <span class="type">json</span> = &quot;&#123;\&quot;animal\&quot;:&#123;\&quot;<span class="type">name</span>\&quot;:\&quot;I am a dog\&quot;&#125;&#125;&quot;;</span><br><span class="line">        Gson gson = <span class="built_in">new</span> GsonBuilder().registerTypeAdapter(Dog.<span class="keyword">class</span>, </span><br><span class="line">        <span class="built_in">new</span> DogDeserialiser()).<span class="keyword">create</span>();</span><br><span class="line">        <span class="keyword">Type</span> animalType = <span class="built_in">new</span> TypeToken&lt;Animal&lt;Dog&gt;&gt;() &#123;</span><br><span class="line">        &#125;.getType();</span><br><span class="line">        Animal&lt;Dog&gt; animal = gson.fromJson(<span class="type">json</span>, animalType);</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(animal.<span class="keyword">get</span>().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JsonSerializer</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> DogSerializer implements JsonSerializer&lt;dog&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public JsonElement serialize(Dog src, Type typeOfSrc,JsonSerializationContext context) &#123;</span><br><span class="line">        <span class="comment">// This method gets involved whenever the parser encounters the Dog</span></span><br><span class="line">        <span class="comment">// object (for which this serializer is registered)</span></span><br><span class="line">        JsonObject <span class="keyword">object</span> = <span class="keyword">new</span> <span class="constructor">JsonObject()</span>;</span><br><span class="line">        String name = src.get<span class="constructor">Name()</span>.replace<span class="constructor">All(<span class="string">&quot; &quot;</span>, <span class="string">&quot;_&quot;</span>)</span>;</span><br><span class="line">        <span class="keyword">object</span>.add<span class="constructor">Property(<span class="string">&quot;name&quot;</span>, <span class="params">name</span>)</span>;</span><br><span class="line">        <span class="comment">// we create the json object for the dog and send it back to the</span></span><br><span class="line">        <span class="comment">// Gson serializer</span></span><br><span class="line">        return <span class="keyword">object</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static void main(String<span class="literal">[]</span> args) &#123;</span><br><span class="line">        Animall&lt;Dog&gt; animal = <span class="keyword">new</span> Animall&lt;Dog&gt;<span class="literal">()</span>;</span><br><span class="line">        Dog dog = <span class="keyword">new</span> <span class="constructor">Dog(<span class="string">&quot;I am a dog&quot;</span>)</span>;</span><br><span class="line">        animal.set<span class="constructor">Animal(<span class="params">dog</span>)</span>;</span><br><span class="line">        <span class="comment">// Create the GsonBuilder and register a serializer for the Dog class.</span></span><br><span class="line">        <span class="comment">// Whenever the Dog class is encountered Gson calls the DogSerializer</span></span><br><span class="line">        <span class="comment">// we set pretty printing own to format the json</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> <span class="constructor">GsonBuilder()</span>.register<span class="constructor">TypeAdapter(Dog.<span class="params">class</span>, <span class="params">new</span> DogSerializer()</span>).set<span class="constructor">PrettyPrinting()</span>.create<span class="literal">()</span>;</span><br><span class="line">        <span class="comment">// Since Animal contains generic type create the type using TypeToken</span></span><br><span class="line">        <span class="comment">// class.</span></span><br><span class="line">        Type animalType = <span class="keyword">new</span> TypeToken&lt;Animal&lt;Dog&gt;&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        &#125;.get<span class="constructor">Type()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(gson.<span class="keyword">to</span><span class="constructor">Json(<span class="params">animal</span>, <span class="params">animalType</span>)</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是registerTypeAdapter必须使用包装类型不能使用int.class,long.class,float.class<br>如果一个被序列化的对象本身就带有泛型，且注册了相应的TypeAdapter，那么必须调用Gson.toJson(Object,Type)，明确告诉Gson对象的类型。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Type</span> <span class="keyword">type</span> = <span class="built_in">new</span> TypeToken&lt;List&lt;<span class="keyword">User</span>&gt;&gt;() &#123;&#125;.getType();</span><br><span class="line">TypeAdapter typeAdapter = <span class="built_in">new</span> TypeAdapter&lt;List&lt;<span class="keyword">User</span>&gt;&gt;() &#123;</span><br><span class="line">&#125;;</span><br><span class="line">Gson gson = <span class="built_in">new</span> GsonBuilder()</span><br><span class="line">        .registerTypeAdapter(<span class="keyword">type</span>, typeAdapter)</span><br><span class="line">        .<span class="keyword">create</span>();</span><br><span class="line">List&lt;<span class="keyword">User</span>&gt; list = <span class="built_in">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.<span class="keyword">add</span>(<span class="built_in">new</span> <span class="keyword">User</span>(&quot;jimmy&quot;,<span class="number">28</span>));</span><br><span class="line">list.<span class="keyword">add</span>(<span class="built_in">new</span> <span class="keyword">User</span>(&quot;kitty&quot;,<span class="number">22</span>));</span><br><span class="line">String result = gson.toJson(list, <span class="keyword">type</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>TypeAdapterFactory<br>除了用上述的方式注册TypeAdapter外还可以使用TypeAdapterFactory,可以根据传入的类型来查看目前是否有现有的TypeAdapter，如果有的话就返回对应的TypeAdapter并注册，如果没有就返回null。注册工厂的方法为GsonBuilder.registerTypeAdapterFactory。</p>
</li>
<li><p>@JsonAdapter<br>使用@JsonAdapter注解可以替代registerTypeAdapterFactory以及registerTypeAdapter方法，这样可以避免在每次进行序列化和反序列化的时候都要进行注册。它的参数必须是且必须是TypeAdpater，JsonSerializer&#x2F;JsonDeserializer或者TypeAdapterFactory。<br>用法如下：</p>
  <figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">@JsonAdapter(DogTypeAdapter.<span class="keyword">class</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-常用第三方库/">Android 常用第三方库</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/10/Android-进阶之第三方库的介绍-Gson/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/10/Android-进阶之第三方库的介绍-Gson/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/17/">&lt;span&gt;&lt;&#x2F;span&gt;Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/19/">Next&lt;span&gt;&lt;&#x2F;span&gt;</a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/tbfungeek" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:tbfungeek@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android-小经验/" title="Android 小经验">Android 小经验<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android-源码分析/" title="Android 源码分析">Android 源码分析<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android其他/" title="Android其他">Android其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android初步/" title="Android初步">Android初步<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android进阶/" title="Android进阶">Android进阶<sup>100</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript理论/" title="JavaScript理论">JavaScript理论<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
		  
		
		  
			<li><a href="/categories/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ROS/" title="ROS">ROS<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-工具使用/" title="iOS 工具使用">iOS 工具使用<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/个人收藏/" title="个人收藏">个人收藏<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/代码规范/" title="代码规范">代码规范<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/其他/" title="其他">其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/博客分类目录/" title="博客分类目录">博客分类目录<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/叨叨系列/" title="叨叨系列">叨叨系列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源代码分析/" title="开源代码分析">开源代码分析<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源库分析/" title="开源库分析">开源库分析<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/版本控制/" title="版本控制">版本控制<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/直播/" title="直播">直播<sup>6</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
			
		
			
				<li><a href="/tags/Android-设计模式/" title="Android 设计模式">Android 设计模式<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/Android基础/" title="Android基础">Android基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/AOSP-源码/" title="AOSP 源码">AOSP 源码<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/Android-常用第三方库/" title="Android 常用第三方库">Android 常用第三方库<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ROS/" title="ROS">ROS<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Android-动画进阶/" title="Android 动画进阶">Android 动画进阶<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Android-JNI/" title="Android JNI">Android JNI<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-绘图进阶/" title="Android 绘图进阶">Android 绘图进阶<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android性能优化/" title="Android性能优化">Android性能优化<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自动化测试/" title="Android 自动化测试">Android 自动化测试<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/直播/" title="直播">直播<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-开源源码/" title="Android 开源源码">Android 开源源码<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自定义View进阶/" title="Android 自定义View进阶">Android 自定义View进阶<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://pages.github.com/" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="http://pf18.github.io/" target="_blank" title="PF18">PF18</a>
            
          </li>
        
          <li>
            
            	<a href="http://toutiao.io/" target="_blank" title="开发者头条">开发者头条</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.jcodecraeer.com/" target="_blank" title="泡在网上的日子">泡在网上的日子</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/AOSP-%E6%BA%90%E7%A0%81/" style="font-size: 17.14px;">AOSP 源码</a> <a href="/tags/Android-APK-%E7%AD%BE%E5%90%8D/" style="font-size: 10px;">Android APK 签名</a> <a href="/tags/Android-JNI/" style="font-size: 12.86px;">Android JNI</a> <a href="/tags/Android-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E8%BF%9B%E9%98%B6/" style="font-size: 10.71px;">Android 事件处理进阶</a> <a href="/tags/Android-%E5%8A%A8%E7%94%BB%E8%BF%9B%E9%98%B6/" style="font-size: 13.57px;">Android 动画进阶</a> <a href="/tags/Android-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91/" style="font-size: 10px;">Android 多线程开发</a> <a href="/tags/Android-%E5%B0%8F%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">Android 小经验</a> <a href="/tags/Android-%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" style="font-size: 16.43px;">Android 常用第三方库</a> <a href="/tags/Android-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android 开发流程</a> <a href="/tags/Android-%E5%BC%80%E6%BA%90%E6%BA%90%E7%A0%81/" style="font-size: 12.14px;">Android 开源源码</a> <a href="/tags/Android-%E7%BB%98%E5%9B%BE%E8%BF%9B%E9%98%B6/" style="font-size: 12.86px;">Android 绘图进阶</a> <a href="/tags/Android-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" style="font-size: 12.86px;">Android 自动化测试</a> <a href="/tags/Android-%E8%87%AA%E5%AE%9A%E4%B9%89View%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">Android 自定义View进阶</a> <a href="/tags/Android-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 19.29px;">Android 设计模式</a> <a href="/tags/Android%E5%85%B6%E4%BB%96/" style="font-size: 10px;">Android其他</a> <a href="/tags/Android%E5%9F%BA%E7%A1%80/" style="font-size: 17.86px;">Android基础</a> <a href="/tags/Android%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android开发流程</a> <a href="/tags/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 12.86px;">Android性能优化</a> <a href="/tags/Android%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">Android混淆技术</a> <a href="/tags/Android%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" style="font-size: 11.43px;">Android质量管理工具</a> <a href="/tags/Android%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" style="font-size: 10px;">Android逆向工程</a> <a href="/tags/Git-github/" style="font-size: 10px;">Git && github</a> <a href="/tags/Hexo-%E4%BD%BF%E7%94%A8/" style="font-size: 15px;">Hexo 使用</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Linux-%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">Linux 使用</a> <a href="/tags/Objective-C-%E7%9B%B8%E5%85%B3/" style="font-size: 18.57px;">Objective C 相关</a> <a href="/tags/OpenCV/" style="font-size: 12.86px;">OpenCV</a> <a href="/tags/ROS/" style="font-size: 14.29px;">ROS</a> <a href="/tags/iOS-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 10.71px;">iOS 工具使用</a> <a href="/tags/iOS-%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 20px;">iOS 开源库分析</a> <a href="/tags/iOS-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/" style="font-size: 15.71px;">iOS 理论基础</a> <a href="/tags/iOS-%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">iOS 进阶</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 10px;">代码规范</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E7%9B%AE%E5%BD%95/" style="font-size: 10.71px;">博客分类目录</a> <a href="/tags/%E5%8F%A8%E5%8F%A8%E7%B3%BB%E5%88%97/" style="font-size: 10px;">叨叨系列</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" style="font-size: 11.43px;">工具的使用</a> <a href="/tags/%E5%BC%80%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 10.71px;">开源代码分析</a> <a href="/tags/%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 10px;">开源库分析</a> <a href="/tags/%E6%9D%82%E7%B1%BB/" style="font-size: 10px;">杂类</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 12.14px;">树莓派</a> <a href="/tags/%E7%9B%B4%E6%92%AD/" style="font-size: 12.86px;">直播</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" style="font-size: 10.71px;">编程技巧</a> <a href="/tags/%E7%BD%91%E7%AB%99%E6%94%B6%E8%97%8F/" style="font-size: 10px;">网站收藏</a> <a href="/tags/%E9%87%8D%E8%A6%81%E6%8E%A7%E4%BB%B6/" style="font-size: 11.43px;">重要控件</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2022 
		
		<a href="/about" target="_blank" title="Edgar">Edgar</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7c9443b0374f1cf6b1dbb5ab84d939cb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
