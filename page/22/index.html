
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>Edgar&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Edgar">
    

    
    <meta name="description" content="Android | 全栈工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="Edgar&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/22/index.html">
<meta property="og:site_name" content="Edgar&#39;s Blog">
<meta property="og:description" content="Android | 全栈工程师">
<meta property="og:locale">
<meta property="article:author" content="Edgar">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="atom.xml" title="Edgar&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/unnamed4_n_mSY_icon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Edgar&#39;s Blog">Edgar&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/12/Android-进阶之设计模式-代理模式/" title="Android 进阶之设计模式 代理模式" itemprop="url">Android 进阶之设计模式 代理模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-12T13:29:02.000Z" itemprop="datePublished"> Published 2016-05-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>代理模式通过创建一个代理对象来代替真实的对象，在客户端看来代理对象和真实对象并没有两样。实际的工作还是通过代理对象传到真实对象中。<br>但是这里说完全一样也不尽然，我们可以使用代理对象在真实对象的某个方法上加强些功能，但是主要的核心功能还是由真实对象来提供的。<br>代理模式可以分成如下几种：<br>1.虚代理：根据需要来创建开销很大的对象，该对象只有在需要的时候才会被真正创建。<br>2.远程代理：用来在不同的地址空间上代表同一个对象。<br>3.保护代理：控制对原始对象的访问。<br>4.智能指引：在访问对象时执行一些附加操作，比如对指向实际对象的引用计数，第一次引用一个持久对象时，将它装入内存等。<br><img src="/2016/05/12/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/1.png"></p>
<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">Subject</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span>()</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">request</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;This is from RealSubject&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SubjectProxy</span> <span class="title">implements</span> <span class="title">Subject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Subject realSubject = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubjectProxy</span>(<span class="params">Subject realSubject</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.realSubject = realSubject;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.doBeforeRequest();</span><br><span class="line">        <span class="keyword">if</span>(realSubject != <span class="literal">null</span>) &#123;</span><br><span class="line">            realSubject.request();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.doAfterRequest();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doBeforeRequest</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;This is from doBefore Request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAfterRequest</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;This is from doAfter Request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span> args[]) &#123;</span><br><span class="line">        Subject realSubject = <span class="keyword">new</span> <span class="type">RealSubject</span>();</span><br><span class="line">        Subject subject = <span class="keyword">new</span> <span class="type">SubjectProxy</span>(realSubject);</span><br><span class="line">        subject.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>上面讲的是静态代理，接下来要看到的将是动态代理，动态代理是在实现阶段不用关心代理谁，而在运行阶段才指定代理的对象。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">Subject</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>()</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;This is from RealSubject&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.<span class="built_in">ref</span>lect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.<span class="built_in">ref</span>lect.Proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">DynamicProxy</span> &lt;<span class="symbol">T</span>&gt; &#123;</span><br><span class="line"><span class="keyword">public</span> static &lt;T&gt; T newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] <span class="built_in">int</span>erfaces,InvocationHandler h) &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(loader, <span class="built_in">int</span>erfaces, h);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInvocationHanlder</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyInvocationHanlder</span><span class="params">(Object proxy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.proxy = proxy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>.proxy, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Client &#123;</span><br><span class="line">    public static void main(String args<span class="literal">[]</span>) &#123;</span><br><span class="line">        Subject realsubject = <span class="keyword">new</span> <span class="constructor">RealSubject()</span>;</span><br><span class="line">        MyInvocationHanlder handler = <span class="keyword">new</span> <span class="constructor">MyInvocationHanlder(<span class="params">realsubject</span>)</span>;</span><br><span class="line">        Subject subject = <span class="module-access"><span class="module"><span class="identifier">DynamicProxy</span>.</span></span><span class="keyword">new</span><span class="constructor">ProxyInstance(<span class="params">realsubject</span>.<span class="params">getClass</span>()</span>.get<span class="constructor">ClassLoader()</span>,</span><br><span class="line">                realsubject.get<span class="constructor">Class()</span>.get<span class="constructor">Interfaces()</span>,handler);</span><br><span class="line">        subject.<span class="keyword">do</span><span class="constructor">Something()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/12/Android-进阶之设计模式-代理模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/12/Android-进阶之设计模式-代理模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/11/Android-进阶之设计模式-享元模式/" title="Android 进阶之设计模式 享元模式" itemprop="url">Android 进阶之设计模式 享元模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-11T13:30:28.000Z" itemprop="datePublished"> Published 2016-05-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>有时候系统中存在有大量的细粒度的对象，并且这些细粒度的对象有很多存在重复的对象，<br>还有一种情况是系统中的大量细粒度对象整体上并不重复，但是在每个对象的部分数据上存在重复。<br>为了避免这种现象我们需要通过缓存包含重复数据的对象，让这些对象只出现一次，从而减少内存的消耗。</p>
<p>因此我们需要对这些细粒度的对象的组成进行分类，分出哪些数据是不变的并且重复出现的，称之为内部变量，哪些数据是经常变化的，我们称之为外部变量，我们需要缓存的是哪些不变且重复的内部变量，而哪些变化的外部变量就不需要缓存了，一般我们会把外部状态分离出来，放到外部让应用在使用的时候进行维护并在需要的时候传递给享元对象使用。<br>这就是享元模式的基本思想，它的设计重点在于分离变与不变。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Flyweight</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> long id;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> classNo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> long <span class="title function_">getId</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setId</span>(<span class="params">long id</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setName</span>(<span class="params"><span class="built_in">String</span> name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getSex</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSex</span>(<span class="params"><span class="built_in">String</span> sex</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sex</span> = sex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getClassNo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> classNo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setClassNo</span>(<span class="params"><span class="built_in">String</span> classNo</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">classNo</span> = classNo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Flyweight</span>(<span class="title class_">String</span> key)&#123;</span><br><span class="line">        <span class="title class_">String</span>[] internalkey = key.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sex</span> = internalkey[<span class="number">0</span>];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">classNo</span> = internalkey[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreFlyweight</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Flyweight</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> key;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ConcreFlyweight</span>(<span class="title class_">String</span> key) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getKey</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setKey</span>(<span class="params"><span class="built_in">String</span> key</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Id = &quot;</span>+<span class="variable language_">super</span>.<span class="title function_">getId</span>() +<span class="string">&quot;  Name = &quot;</span>+<span class="variable language_">super</span>.<span class="title function_">getName</span>()</span><br><span class="line">                +<span class="string">&quot; Sex = &quot;</span>+<span class="variable language_">super</span>.<span class="title function_">getSex</span>() +<span class="string">&quot; Class No.&quot;</span>+ <span class="variable language_">super</span>.<span class="title function_">getClassNo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightFactoryHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> FlyweightFactory instance = <span class="keyword">new</span> <span class="type">FlyweightFactory</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> FlyweightFactory()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> FlyweightFactory getInstance() &#123;</span><br><span class="line">        <span class="keyword">return</span> FlyweightFactoryHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;<span class="keyword">String</span>,Flyweight&gt; flyweightCache = <span class="keyword">new</span> <span class="type">HashMap</span>&lt;<span class="keyword">String</span>,Flyweight&gt;();</span><br><span class="line">    <span class="keyword">public</span> Flyweight getFlyweight(<span class="keyword">String</span> key) &#123;</span><br><span class="line">        Flyweight obj = flyweightCache.<span class="keyword">get</span>(key);</span><br><span class="line">        <span class="keyword">if</span>(obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            obj = <span class="keyword">new</span> <span class="type">ConcreFlyweight</span>(key);</span><br><span class="line">            flyweightCache.put(key, obj);</span><br><span class="line">            System.out.println(<span class="string">&quot;新建一个对象，添加到缓存器&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;直接使用缓存器中现有的&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Client &#123;</span><br><span class="line">    public static void main(String args<span class="literal">[]</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span> ; i&lt;<span class="number">2</span> ;i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="built_in">int</span> j =<span class="number">0</span>;j&lt;<span class="number">10</span>;j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">FlyweightFactory</span>.</span></span>get<span class="constructor">Instance()</span>.get<span class="constructor">Flyweight(<span class="string">&quot;Boy-Class&quot;</span>+<span class="params">j</span>)</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">FlyweightFactory</span>.</span></span>get<span class="constructor">Instance()</span>.get<span class="constructor">Flyweight(<span class="string">&quot;Girl-Class&quot;</span>+<span class="params">j</span>)</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Flyweight fly = <span class="module-access"><span class="module"><span class="identifier">FlyweightFactory</span>.</span></span>get<span class="constructor">Instance()</span>.get<span class="constructor">Flyweight(<span class="string">&quot;Boy-Class6&quot;</span>)</span>;</span><br><span class="line">        fly.set<span class="constructor">Id(1001)</span>;</span><br><span class="line">        fly.set<span class="constructor">Name(<span class="string">&quot;jimmy&quot;</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(fly.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line"></span><br><span class="line">        Flyweight fly2 = <span class="module-access"><span class="module"><span class="identifier">FlyweightFactory</span>.</span></span>get<span class="constructor">Instance()</span>.get<span class="constructor">Flyweight(<span class="string">&quot;Boy-Class60&quot;</span>)</span>;</span><br><span class="line">        fly2.set<span class="constructor">Id(1003)</span>;</span><br><span class="line">        fly2.set<span class="constructor">Name(<span class="string">&quot;jimmy2&quot;</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(fly2.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/11/Android-进阶之设计模式-享元模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/11/Android-进阶之设计模式-享元模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/10/Android-进阶之设计模式-中介者模式/" title="Android 进阶之设计模式 中介者模式" itemprop="url">Android 进阶之设计模式 中介者模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-10T13:32:19.000Z" itemprop="datePublished"> Published 2016-05-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><img src="/2016/05/10/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/1.png"></p>
<h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>中介者模式的提出是为了解决：一个系统中多个对象相互交互，使得整个系统变得复杂，对象之间耦合紧密，导致系统不利于维护和扩展这个现象。<br>在中介者模式中用一个中介类来封装对象之间的交互。这样其他对象就不需要维护对象之间的关系了。扩展关系的时候也只需要扩展或者修改中介者对象就可以了。</p>
<p>在中介者模式中，需要交互的对象称为同事类。它们一般都持有中介者对象的引用。但是也可以将中介者设计为一个单例，在同事类需要中介者引用的时候通过getInstance获取中介者引用。<br>同时由于中介者需要维护同事对象之间的关系所以也应该拥有各个同事类的引用。但是也可以在中介者处理方法中通过创建，或者获取，或者通过参数传入的方式获取同事对象。<br>在中介者模式中一旦一个同事发生了变化，需要主动通知中介者，让中介者去处理该变化与其他同事对象的交互。</p>
<h4 id="简化的中介者模式"><a href="#简化的中介者模式" class="headerlink" title="简化的中介者模式"></a>简化的中介者模式</h4><p>去掉同事类的父类，只要需要交互就可以成为同事类<br>不需要中介者接口，直接通过单例模式获取中介者的引用。<br>同事对象不再持有中介者，而是在需要的时候直接获取中介者对象，中介者也不再持有同事对象，在中介方法中通过创建，获取，参数传递的形式得到同事对象的引用。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDReader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">data</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> void readData(String <span class="keyword">data</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="keyword">data</span> = <span class="keyword">data</span>;</span><br><span class="line">        Mediator.getInstance().changed(<span class="keyword">this</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> String getData() &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.<span class="keyword">data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CPU</span> &#123;   </span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> audioData = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> videoData = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">processData</span>(<span class="params"><span class="built_in">String</span> data</span>) &#123;</span><br><span class="line">        <span class="title class_">String</span> [] datas = data.<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        audioData = datas[<span class="number">0</span>];</span><br><span class="line">        videoData = datas[<span class="number">1</span>];</span><br><span class="line">        <span class="title class_">Mediator</span>.<span class="title function_">getInstance</span>().<span class="title function_">changed</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getAudioData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> audioData;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getVideoData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> videoData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediaPlayer</span> &#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">playSound</span>(<span class="params"><span class="built_in">String</span> audio</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(audio);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">playVideo</span>(<span class="params"><span class="built_in">String</span> video</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(video);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Mediator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MediatorHolder</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Mediator</span> <span class="variable">mInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mediator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Mediator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MediatorHolder.mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">audioData</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">videoData</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changed</span><span class="params">(Object colleage)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(colleage <span class="keyword">instanceof</span> CDReader) &#123;</span><br><span class="line">            data = ((CDReader) colleage).getData();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CPU</span>().processData(data);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (colleage <span class="keyword">instanceof</span> CPU) &#123;</span><br><span class="line">            audioData = ((CPU) colleage).getAudioData();</span><br><span class="line">            videoData = ((CPU) colleage).getVideoData();</span><br><span class="line">            <span class="type">MediaPlayer</span> <span class="variable">player</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>();</span><br><span class="line">            player.playSound(audioData);</span><br><span class="line">            player.playVideo(videoData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span> args[]</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CDReader</span>().<span class="title function_">readData</span>(<span class="string">&quot;这是音乐:这是视频&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/10/Android-进阶之设计模式-中介者模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/10/Android-进阶之设计模式-中介者模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/08/Android-进阶之设计模式-工厂方法模式-抽象工厂模式/" title="Android 进阶之设计模式 工厂方法模式 &amp;&amp; 抽象工厂模式" itemprop="url">Android 进阶之设计模式 工厂方法模式 &amp;&amp; 抽象工厂模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-08T13:28:01.000Z" itemprop="datePublished"> Published 2016-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="工厂模式的定义："><a href="#工厂模式的定义：" class="headerlink" title="工厂模式的定义："></a>工厂模式的定义：</h4><p>定义一个用于创建对象的接口，让子类决定实例化哪个类，工厂方法使得一个类的实例化延迟到其子类。<br>上面的定义比较官方，其实就个人的理解工厂方法就相当于一个黑盒，我们传入一个所需产品的识别标示，工厂就会自动产生我们所需要的产品，我们无须理解其中繁杂的创建过程，只要知道所产生产品所能提供的方法就可以了。<br>还有个优点就是，只要产品的接口不变，那么上层的应用就无须修改，我们如果需要扩展或者需要修改具体的实现只要动中间层即可，比如我们要扩展只要增加产品类即可，如果需要修改只需要修改产品类即可。<br><img src="/2016/05/08/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/1.png"></p>
<h4 id="工厂模式的变体："><a href="#工厂模式的变体：" class="headerlink" title="工厂模式的变体："></a>工厂模式的变体：</h4><p>将工厂简化为静态工厂</p>
<h4 id="决定产生何种产品的决定因素可以是如下几种方式："><a href="#决定产生何种产品的决定因素可以是如下几种方式：" class="headerlink" title="决定产生何种产品的决定因素可以是如下几种方式："></a>决定产生何种产品的决定因素可以是如下几种方式：</h4><p>1.工厂类的传入参数<br>2.读取配置文件<br>3.某个运行时参数或者状态量</p>
<h4 id="工厂方法的返回值，可以是接口，抽象类，具体类。"><a href="#工厂方法的返回值，可以是接口，抽象类，具体类。" class="headerlink" title="工厂方法的返回值，可以是接口，抽象类，具体类。"></a>工厂方法的返回值，可以是接口，抽象类，具体类。</h4><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">AbsProduct</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductImplA</span> <span class="title">implements</span> <span class="title">AbsProduct</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;This Message is Come from &quot;</span> + ProductImplA.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductImplB</span> <span class="title">implements</span> <span class="title">AbsProduct</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;This messsage is come from &quot;</span>+ ProductImplB.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductImplC</span> <span class="title">implements</span> <span class="title">AbsProduct</span> &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;This massage is come from &quot;</span>+ ProductImplC.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbsFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> AbsProduct&gt; <span class="function">T <span class="title">createProduct</span><span class="params">(Class&lt;T&gt; clzz)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">AbsFactory</span></span> </span>&#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> &lt;T extends AbsProduct&gt; T createProduct(Class&lt;T&gt; clzz) &#123;</span><br><span class="line"></span><br><span class="line">        AbsProduct product = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            product =  (T) Class.forName(clzz.getName()).<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> FactoryTestMain &#123;</span><br><span class="line">    public static void main(String args<span class="literal">[]</span>) &#123;</span><br><span class="line">        AbsFactory factory = <span class="keyword">new</span> <span class="constructor">FactoryImpl()</span>;</span><br><span class="line">        AbsProduct product;</span><br><span class="line">        product= factory.create<span class="constructor">Product(ProductImplA.<span class="params">class</span>)</span>;</span><br><span class="line">        product.<span class="keyword">do</span><span class="constructor">Something()</span>;</span><br><span class="line">        product = factory.create<span class="constructor">Product(ProductImplB.<span class="params">class</span>)</span>;</span><br><span class="line">        product.<span class="keyword">do</span><span class="constructor">Something()</span>;</span><br><span class="line">        product = factory.create<span class="constructor">Product(ProductImplC.<span class="params">class</span>)</span>;</span><br><span class="line">        product.<span class="keyword">do</span><span class="constructor">Something()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>工厂方法还有种比较好用的变体，其实也算不上什么变体，就是在工厂内部定义完成操作的方法，然后我们扔进去一个类型，指定要什么类型的对象来完成这个操作，这时候外部无须获取产品类型，直接调用工厂里面的方法即可<br>工厂父类一般是抽象方法，主要有两种类型，一个是抽象工厂方法用于产生抽象产品，另一类是使用抽象产品完成的操作方法。这样产品类就不需要抛头露面了。结构如下：<br><img src="/2016/05/08/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/2.png"></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> AbstractProduct product = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> productType = <span class="number">-1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProduct <span class="title">createFactory</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setProductType</span>(<span class="params"><span class="built_in">int</span> type</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeThing</span>()</span> &#123;</span><br><span class="line">        product = createFactory();</span><br><span class="line">        <span class="keyword">if</span>(product != <span class="literal">null</span>) &#123;</span><br><span class="line">            product.doSomethingA();</span><br><span class="line">            product.doSomethingB();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">AbstractProduct</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingA</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingB</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ConcreFactory</span>  <span class="keyword">extends</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">AbstractProduct</span> createFactory() &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">super</span>.productType == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">ConcreProductA</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">super</span>.productType == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">ConcreProductB</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void setProductType(int <span class="class"><span class="keyword">type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.productType = <span class="class"><span class="keyword">type</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreProductA</span> <span class="title">implements</span> <span class="title">AbstractProduct</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingA</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;ConcreProductA doSomething A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingB</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;ConcreProductA doSomething B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreProductB</span> <span class="title">implements</span> <span class="title">AbstractProduct</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingA</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;ConcreProductB doSomething A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomethingB</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;ConcreProductB doSomething B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> Client &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String args<span class="literal">[]</span>) &#123;</span><br><span class="line">        ConcreFactory factory = <span class="keyword">new</span> <span class="constructor">ConcreFactory()</span>;</span><br><span class="line">        factory.<span class="keyword">do</span><span class="constructor">SomeThing()</span>;</span><br><span class="line"></span><br><span class="line">        factory.set<span class="constructor">ProductType(0)</span>;</span><br><span class="line">        factory.<span class="keyword">do</span><span class="constructor">SomeThing()</span>;</span><br><span class="line"></span><br><span class="line">        factory.set<span class="constructor">ProductType(1)</span>;</span><br><span class="line">        factory.<span class="keyword">do</span><span class="constructor">SomeThing()</span>;</span><br><span class="line"></span><br><span class="line">        factory.set<span class="constructor">ProductType(2)</span>;</span><br><span class="line">        factory.<span class="keyword">do</span><span class="constructor">SomeThing()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h4><p>虽然工厂模式与抽象工厂模式都带有“工厂”两个字，但是二者所要解决的问题是不同的，工厂模式主要解决的问题是屏蔽产品类创建的繁杂过程，只要知道想获得什么的时候传入什么，以及产生的产品有哪些方法即可，而抽象工厂模式解决的是如何产生一个产品簇，这种产品往往有一定约束条件的的，与其称之为抽象工厂方法，而不如称其为方案工厂方法，因为往往产生的是一整套配套的方案。<br><img src="/2016/05/08/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/3.png"><br>下面我们用一个萝卜一个坑的例子来演示抽象工厂模式：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">AbsHole</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printHoleSize</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">AbsTurnips</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTuripsSize</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsHole <span class="title">createHole</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsTurnips <span class="title">createTurnips</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BigHole</span> <span class="title">implements</span> <span class="title">AbsHole</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printHoleSize</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;大坑&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BigTurnips</span> <span class="title">implements</span> <span class="title">AbsTurnips</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTuripsSize</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;大萝卜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SmallHole</span> <span class="title">implements</span> <span class="title">AbsHole</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printHoleSize</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;小坑&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SmallTurnips</span> <span class="title">implements</span> <span class="title">AbsTurnips</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTuripsSize</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;小萝卜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreBigFactory</span> <span class="title">implements</span> <span class="title">AbstractFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsHole <span class="title">createHole</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigHole();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsTurnips <span class="title">createTurnips</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigTurnips();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreSmallFactory</span> <span class="title">implements</span> <span class="title">AbstractFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsHole <span class="title">createHole</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SmallHole();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbsTurnips <span class="title">createTurnips</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SmallTurnips();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String args[]</span>)</span> &#123;</span><br><span class="line">        AbstractFactory factory = <span class="keyword">new</span> ConcreBigFactory();</span><br><span class="line">        factory.createHole().printHoleSize();</span><br><span class="line">        factory.createTurnips().printTuripsSize();</span><br><span class="line"></span><br><span class="line">        factory = <span class="keyword">new</span> ConcreSmallFactory();</span><br><span class="line">        factory.createHole().printHoleSize();</span><br><span class="line">        factory.createTurnips().printTuripsSize();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/08/Android-进阶之设计模式-工厂方法模式-抽象工厂模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/08/Android-进阶之设计模式-工厂方法模式-抽象工厂模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/07/Android-进阶之设计模式-原型模式/" title="Android 进阶之设计模式 原型模式" itemprop="url">Android 进阶之设计模式 原型模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-07T13:28:35.000Z" itemprop="datePublished"> Published 2016-05-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="原型模式："><a href="#原型模式：" class="headerlink" title="原型模式："></a>原型模式：</h4><p>原型模式是一种创建型模式，它一般用在需要快速创建大量相似的对象的情景下。<br>它与用new 创建对象的区别如下：<br>原型模式是一种内存二进制拷贝，所以比使用new 产生对象的方式来得快速高效。所以在需要重复地创建相似对象时可以考虑使用原型模式。比如需要在一个循环内创建对象，并且对象创建过程比较复杂或者循环次数很多的情况，使用原型模式不但可以简化创建过程，而且可以使系统的整体性能提高很多。<br>原型模式它创建对象的时候并不调用所创建对象的构造方法。这个是优点同时也是原型模式的缺点。<br>在使用原型模式的时候还需要注意的是浅拷贝和深拷贝<br>一般对于成员变量是基本数据类型，以及String类型的时候只需要使用浅拷贝即可，而对于那些成员变量包含数组，对象的类型，要注意使用深拷贝，否则那些成员变量是非基本变量的成员，在复制出来的对象中只是一个引用，这些引用指向的还是原对象，这样就会导致修改拷贝出的对象时，会对原对象产生干扰。<br>在原型模式中需要实现Cloneable接口。Cloneable它的作用只有一个，就是在运行时通知虚拟机可以安全地在实现了此接口的类上使用clone方法。在java虚拟机中，只有实现了这个接口的类才可以被拷贝，否则在运行时会抛出CloneNotSupportedException异常。<br><img src="/2016/05/07/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/1.png"></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonInfo</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> int age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setName</span>(<span class="params"><span class="built_in">String</span> name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setAge</span>(<span class="params">int age</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title class_">Object</span> <span class="title function_">clone</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">PersonInfo</span> info = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            info = (<span class="title class_">PersonInfo</span>) <span class="variable language_">super</span>.<span class="title function_">clone</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">CloneNotSupportedException</span> e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomInfo</span> <span class="title">implements</span> <span class="title">Cloneable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">long</span> id = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> PersonInfo mPersonInfo = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomInfo</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;调用构造方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">long</span> <span class="title">getId</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span>(<span class="params"><span class="built_in">long</span> id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PersonInfo <span class="title">getmPersonInfo</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mPersonInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setmPersonInfo</span>(<span class="params">PersonInfo mPersonInfo</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mPersonInfo = mPersonInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span>()</span> &#123;</span><br><span class="line">        CustomInfo info = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            info = (CustomInfo) super.clone();</span><br><span class="line">            info.setmPersonInfo((PersonInfo) <span class="keyword">this</span>.mPersonInfo.clone());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;id = &quot;</span>+id +<span class="string">&quot; name = &quot;</span>+ mPersonInfo.getName()+</span><br><span class="line">                <span class="string">&quot; age = &quot;</span> +mPersonInfo.getAge()+<span class="string">&quot; hashCode = &quot;</span>+ <span class="keyword">this</span>.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">import java.util.Random;</span><br><span class="line">public <span class="keyword">class</span> Client &#123;</span><br><span class="line">    public static void main(String args<span class="literal">[]</span>) &#123;</span><br><span class="line">        CustomInfo info = <span class="keyword">new</span> <span class="constructor">CustomInfo()</span>;</span><br><span class="line">        info.set<span class="constructor">Id(<span class="params">new</span> Random()</span>.next<span class="constructor">Long()</span>);</span><br><span class="line">        PersonInfo pinfo = <span class="keyword">new</span> <span class="constructor">PersonInfo()</span>;</span><br><span class="line">        pinfo.set<span class="constructor">Age(<span class="params">new</span> Random()</span>.next<span class="constructor">Int(100)</span>);</span><br><span class="line">        pinfo.set<span class="constructor">Name(<span class="string">&quot;Jimmy&quot;</span>)</span>;</span><br><span class="line">        info.setm<span class="constructor">PersonInfo(<span class="params">pinfo</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(info.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) &#123;</span><br><span class="line">            CustomInfo cinfo = (CustomInfo) info.clone<span class="literal">()</span>;</span><br><span class="line">            cinfo.set<span class="constructor">Id(2222222222222l)</span>;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(cinfo.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(info.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/07/Android-进阶之设计模式-原型模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/07/Android-进阶之设计模式-原型模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/06/Android-进阶之设计模式-创建型模式-单例模式/" title="Android 进阶之设计模式 创建型模式-单例模式" itemprop="url">Android 进阶之设计模式 创建型模式-单例模式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-06T13:25:00.000Z" itemprop="datePublished"> Published 2016-05-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h4><p>如果创建某个对象将会耗费过多的资源，或者需要某个对象作为某种设备或者其他对象的管理者的时候，比如对项目配置文件或者数据库进行读写的情况。</p>
<h4 id="单例模式的定义："><a href="#单例模式的定义：" class="headerlink" title="单例模式的定义："></a>单例模式的定义：</h4><p>确保某个类只有一个实例，并且自行实例化后向系统提供这个实例，单例的主要思想是通过将构造方法私有化从而将创建对象的权利回收，不让外部其他对象显式调用构造方法创建对象。<br><img src="/2016/05/06/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/1.png"></p>
<h4 id="单例写法："><a href="#单例写法：" class="headerlink" title="单例写法："></a>单例写法：</h4><p>单例有五写法：<br>分别是饿汉式，懒汉式，双重判空检查法，内部类，枚举法:</p>
<ul>
<li>饿汉式： 在有多个虚拟机的情况下有可能会创建多个实例<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonHungry</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonHungry</span>()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final SingletonHungry mInstance = <span class="keyword">new</span> SingletonHungry();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> final SingletonHungry <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.print(<span class="string">&quot;Hello I am &quot;</span>+ SingletonHungry.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>懒汉式：在多线程的情况有可能会创建多个实例，解决方法：加synchronized</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonLayzy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonLayzy mInstance = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonLayzy</span>()</span> &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> synchronized SingletonLayzy <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>( mInstance == <span class="literal">null</span> ) &#123;</span><br><span class="line">            mInstance = <span class="keyword">new</span> SingletonLayzy();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Hello I am &quot;</span> + SingletonLayzy.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>双重校验锁：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonDoubleCheck</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingletonDoubleCheck mInstance = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SingletonDoubleCheck</span>()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDoubleCheck <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(mInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">            synchronized(SingletonDoubleCheck.<span class="keyword">class</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(mInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    mInstance = <span class="keyword">new</span> SingletonDoubleCheck();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Hello I am &quot;</span>+ SingletonDoubleCheck.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类级内部类</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonHolder</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonHolder</span>()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">InnerClass</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SingletonHolder mInstance = <span class="keyword">new</span> SingletonHolder();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonHolder <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> InnerClass.mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Hello I am &quot;</span>+ SingletonHolder.<span class="keyword">class</span>.getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>枚举单例：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> SingletonEnum &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonEnum</span>()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span> ()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello I am &quot;</span> + SingletonEnum.<span class="keyword">class</span>.getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>单例池：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonPool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final String SINGLETONE_KEY_PREFIX = <span class="string">&quot;sigleton_prefix&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final <span class="built_in">int</span> MAX_POOL_SIZE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> mCurrentItemId = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, SingletonPool&gt; mSingletonPools = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonPool</span>()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonPool <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        String key = SINGLETONE_KEY_PREFIX + mCurrentItemId;</span><br><span class="line">        SingletonPool item = mSingletonPools.<span class="keyword">get</span>(key);</span><br><span class="line">        <span class="keyword">if</span> ( item == <span class="literal">null</span> ) &#123;</span><br><span class="line">            item = <span class="keyword">new</span> SingletonPool();</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;New Item&quot;</span>);</span><br><span class="line">            mSingletonPools.put(key, item);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;Get From Cache&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mCurrentItemId = (mCurrentItemId + <span class="number">1</span>) % MAX_POOL_SIZE;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello I am &quot;</span> + <span class="keyword">this</span>.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结：单例共有五种写法分别是懒汉，饿汉，双重校验锁，类级内部类，枚举。<br>饿汉：因为加载类的时候就创建实例，所以线程安全。缺点是不能延时加载，同时多个ClassLoader存在时不能保持只有一个实例。<br>懒汉：需要加锁才能实现多线程同步，但是效率会降低。优点是延时加载。<br>双重校验锁：instance &#x3D; new singletone()这种代码在不同编译器上的行为和实现方式不可预知,不推荐使用<br>类级内部类：延迟加载，减少内存开销。<br>枚举：不仅能避免多线程同步问题，而且还能防止反序列化重新创建新的对象，但是失去了类的一些特性。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/06/Android-进阶之设计模式-创建型模式-单例模式/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/06/Android-进阶之设计模式-创建型模式-单例模式/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/05/Android-进阶之设计模式-六大原则/" title="Android 进阶之设计模式 六大原则" itemprop="url">Android 进阶之设计模式 六大原则</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-05T13:19:57.000Z" itemprop="datePublished"> Published 2016-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="1-开闭原则："><a href="#1-开闭原则：" class="headerlink" title="1.开闭原则："></a>1.开闭原则：</h4><p>对扩展开放，对修改关闭</p>
<p>也就是说在增加新特性的时候最好考虑通过扩展已有系统的方式来实现需求的变化，而不是通过直接通过修改系统已有源码的方式。</p>
<p>也就是说一旦程序开发完成，程序中一个类的实现只应该因为错误而修改，新的或者改变的特性应该通过新建不同的类的实现，新建的类可以通过继承的方式来重用已有的代码。</p>
<p>开闭原则的必要性：</p>
<p>因为一个已有的系统一般都是事先经过千万次测试的稳定系统，如果直接对这些稳定系统进行修改，很有可能直接影响到原有系统的稳定性。</p>
<p>同时如果部分系统有测试用例的情况下，每修改一个代码有可能需要修改大量的用例代码</p>
<p>而通过继承可以保证不影响原有系统稳定性的情况下实现变化，这种情况下只需对新增变化进行各项测试即可。</p>
<p>如何使用：</p>
<p>通过抽象类或者接口对可扩展性作适当的限定，这其实就是为了限定整个系统的可扩展范围。</p>
<p>对象引用避免使用具体的实现类，尽可能使用接口或者抽象类。这样可以保证整个系统的可扩展性。（里氏替换原则）</p>
<p>抽象层必须保持稳定。并且预知了所有可能的扩展，在任何扩展下都不会变化。</p>
<h4 id="2-里氏替换原则"><a href="#2-里氏替换原则" class="headerlink" title="2.里氏替换原则"></a>2.里氏替换原则</h4><p>所有父类能够出现的地方，之类都应该可以出现。</p>
<p>用在实际就是在类中调用其他类的时候尽可能使用父类或者接口。</p>
<p>里氏替换原则的核心思想就是通过抽象建立规范，具体的实现在运行时替换掉抽象，从而实现功能扩展。</p>
<h4 id="3-依赖倒置原则"><a href="#3-依赖倒置原则" class="headerlink" title="3.依赖倒置原则"></a>3.依赖倒置原则</h4><p>模块之间的依赖关系需要通过抽象发生，实现类之间不发生直接的依赖关系。其依赖关系是通过接口或者抽象类来产生的。</p>
<p>实现细则：</p>
<p>每个类都应该有接口或者抽象类，或者两者都存在</p>
<p>变量的类型尽量是接口或者是抽象类</p>
<p>任何类都不允许从具体类中派生</p>
<p>一般使用接口定义公开的属性和方法，抽象类负责准确地实现业务逻辑。</p>
<p>比如下图所示通过AbstractClass1 和2 建立起依赖关系。而不是通过具体的之类来直接建立关系。</p>
<p><img src="/2016/05/05/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/1.png"></p>
<h4 id="4-接口隔离原则"><a href="#4-接口隔离原则" class="headerlink" title="4.接口隔离原则"></a>4.接口隔离原则</h4><p>类之间的依赖关系应该建立在最小的接口上，在项目中需要按照职责将臃肿的接口拆封成更小的和更具体的接口，这样客户只需要知道他们感兴趣的方法，</p>
<p>把不需要的接口剔除掉，最好做到一个接口只服务于一个子模块或者业务逻辑。</p>
<h4 id="5-迪米特法则"><a href="#5-迪米特法则" class="headerlink" title="5.迪米特法则"></a>5.迪米特法则</h4><p>一个类应该对自己需要耦合或者调用的类知道得最少。</p>
<h4 id="6-单一职责原则"><a href="#6-单一职责原则" class="headerlink" title="6. 单一职责原则"></a>6. 单一职责原则</h4><p>接口或者类，尽量要做到单一职责，类的设计尽量要做到只有一个原因引起变化，而对于方法则需要满足一个方法尽可能只做一件事情。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/05/Android-进阶之设计模式-六大原则/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/05/Android-进阶之设计模式-六大原则/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/04/Android-进阶之设计模式-转-Android-CleanArchitecture/" title="Android 进阶之设计模式 (转)Android-CleanArchitecture" itemprop="url">Android 进阶之设计模式 (转)Android-CleanArchitecture</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-04T14:13:41.000Z" itemprop="datePublished"> Published 2016-05-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="英文原文："><a href="#英文原文：" class="headerlink" title="英文原文："></a>英文原文：</h4><p><a target="_blank" rel="noopener" href="http://fernandocejas.com/2015/07/18/architecting-android-the-evolution/">http://fernandocejas.com/2015/07/18/architecting-android-the-evolution/</a><br><a target="_blank" rel="noopener" href="http://fernandocejas.com/2014/09/03/architecting-android-the-clean-way/">http://fernandocejas.com/2014/09/03/architecting-android-the-clean-way/</a></p>
<hr>
<h4 id="中文翻译："><a href="#中文翻译：" class="headerlink" title="中文翻译："></a>中文翻译：</h4><p><a target="_blank" rel="noopener" href="http://android.jobbole.com/81153/">http://android.jobbole.com/81153/</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20001838">https://zhuanlan.zhihu.com/p/20001838</a></p>
<h4 id="对应代码："><a href="#对应代码：" class="headerlink" title="对应代码："></a>对应代码：</h4><p><a target="_blank" rel="noopener" href="https://github.com/android10/Android-CleanArchitecture">https://github.com/android10/Android-CleanArchitecture</a><br><a target="_blank" rel="noopener" href="https://github.com/zhengxiaopeng/MVVM_Android-CleanArchitecture">https://github.com/zhengxiaopeng/MVVM_Android-CleanArchitecture</a><br><a target="_blank" rel="noopener" href="https://github.com/zhengxiaopeng/Rocko-Android-Demos/tree/master/architecture/MVVM_Android-CleanArchitecture">https://github.com/zhengxiaopeng/Rocko-Android-Demos/tree/master/architecture/MVVM_Android-CleanArchitecture</a></p>
<p>对于好的文章真的会有一种忍不住要收藏的感觉，现在就无耻得转载这篇文章分享给大家：</p>
<h4 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h4><p>我们知道编写高质量软件是既困难又复杂的：不仅是满足需求方面，还要健壮、可维护、可测试，并且足够灵活以适应增长和变化。这就是“代码整洁之道”的来源，并可以成为开发任何软件应用程序的良好方法。<br>思想很简单：代码整洁之道代表构建系统的一组实践：</p>
<ul>
<li>独立于框架。</li>
<li>可测试性。</li>
<li>独立于UI。</li>
<li>独立于数据库。</li>
<li>独立于任何外部代理。</li>
</ul>
<p><img src="/2016/05/04/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BD%AC-Android-CleanArchitecture/1.png"></p>
<p>我们并不要求一定要用四环结构（如图所示），这只是一个示例图解，但是要考虑的是依赖项规则：源码依赖项只能向内指向，内环里的所有项不能了解外环所发生的东西。</p>
<p>以下是更好地理解和熟悉本方法的一些相关词汇：</p>
<ul>
<li>Entities：是指一款应用的业务对象</li>
<li>Use cases：是指结合数据流和实体中的用例，也称为Interactor</li>
<li>Interface Adapters： 这一组适配器，是负责以最合理的格式转换用例（use cases）和实体（entities）之间的数据，表现层（Presenters ）和控制层（Controllers ），就属于这一块的。</li>
<li>Frameworks and Drivers: 这里是所有具体的实现了：比如：UI，工具类，基础框架，等等。</li>
</ul>
<p>想要更具体，更生动丰富的解释，可以参考这篇文章或者这个视频。</p>
<h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><p>我会设置一个简单的场景来开始：创建一个简单的小app，app中显示从云端获取的一个朋友或用户列表。当点击其中任何一个时，会打开一个新的窗口，显示该用户的详细信息。<br>这里我放了一段视频，大家看看这个视频 (需翻墙)大概就可以对我所描述的东西了解个大概了。</p>
<h4 id="Android应用架构"><a href="#Android应用架构" class="headerlink" title="Android应用架构"></a>Android应用架构</h4><p>这一对象遵循关注分离原则，也就是通过业务规则让内环操作对外环事物一无所知，这样一来，在测试时它们就不会依赖任何的外部元素了。<br>要达到这个目的，我的建议就是把一个项目分成三个层次，每个层次拥有自己的目的并且各自独立于堆放运作。<br>值得一提的是，每一层次使用其自有的数据模型以达到独立性的目的（大家可以看到，在代码中需要一个数据映射器来完成数据转换。如果你不想把你的模型和整个应用交叉使用，这是你要付出的代价）。<br>以下是图解，大家感受下：</p>
<p><img src="/2016/05/04/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BD%AC-Android-CleanArchitecture/2.png"></p>
<h5 id="表现层-Presentation-Layer"><a href="#表现层-Presentation-Layer" class="headerlink" title="表现层 (Presentation Layer)"></a>表现层 (Presentation Layer)</h5><p>表现层在此，表现的是与视图和动画相关的逻辑。这里仅用了一个Model View Presenter（下文简称MVP），但是大家也可以用MVC或MVVM等模式。这里我不再赘述细节，但是需要强调的是，这里的fragment和activity都是View,其内部除了UI逻辑以外没有其他逻辑，这也是所有渲染的东西发生的地方。<br>本层次的Presenter由多个interactor（用例）组成，Presenter在 android UI 线程以外的新线程里工作，并通过回调将要渲染到View上的数据传递回来。</p>
<p><img src="/2016/05/04/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BD%AC-Android-CleanArchitecture/3.png"></p>
<h5 id="领域层-Domain-Layer"><a href="#领域层-Domain-Layer" class="headerlink" title="领域层 (Domain Layer)"></a>领域层 (Domain Layer)</h5><p>这里的业务规则是指所有在本层发生的逻辑。对于Android项目来说，大家还可以看到所有的interactor（用例）实施。这一层是纯粹的java模块，没有任何的Android依赖性。当涉及到业务对象时，所有的外部组件都使用接口。<br><img src="/2016/05/04/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BD%AC-Android-CleanArchitecture/4.png"></p>
<h5 id="数据层-Data-Layer"><a href="#数据层-Data-Layer" class="headerlink" title="数据层 (Data Layer)"></a>数据层 (Data Layer)</h5><p>应用所需的所有数据都来自这一层中的UserRepository实现（接口在领域层）。这一实现采用了Repository Pattern，主要策略是通过一个工厂根据一定的条件选取不同的数据来源。<br>比如，通过ID获取一个用户时，如果这个用户在缓存中已经存在，则硬盘缓存数据源会被选中，否则会通过向云端发起请求获取数据，然后存储到硬盘缓存。<br>这一切背后的原理是由于原始数据对于客户端是透明的，客户端并不关心数据是来源于内存、硬盘还是云端，它需要关心的是数据可以正确地获取到。<br><img src="/2016/05/04/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%BD%AC-Android-CleanArchitecture/5.png"></p>
<h5 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h5><p>这是一个长期待解决的讨论话题，如果大家能够分享各自的解决方案，那真真是极好的。<br>我的策略是使用回调，这样的话，如果数据仓库发生了变化，回调有两个方法：onResponse()和onError(). onError方法将异常信息封装到一个ErrorBundle对象中: 这种方法的难点在于这其中会存在一环扣一环的回调链，错误会沿着这条回调链到达展示层。因此会牺牲一点代码的可读性。另外，如果出现错误，我本来可以通过事件总线系统抛出事件，但是这种实现方式类似于使用C语言的goto语法。在我看来，当你订阅多个事件时，如果不能很好的控制，你可能会被弄得晕头转向。<br>测试</p>
<h5 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h5><p>关于测试方面，我根据不同的层来选择不同的方法:</p>
<p>展示层 ( Presentation Layer) : 使用android instrumentation和 espresso进行集成和功能测试<br>领域层 ( Domain Layer) : 使用JUnit和Mockito进行单元测试；<br>数据层 ( Data Layer) : 使用Robolectric （ 因为依赖于Android SDK中的类 ）进行集成测试和单元测试。</p>
<h5 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h5><p>我猜你现在在想，扯了那么久的淡，代码究竟在哪里呢？ 好吧，这就是你可以找到上述解决方案的github链接。还要提一点，在文件夹结构方面，不同的层是通过以下不同的模块反应的:</p>
<p>presentation: 展示层的Android模块<br>domain: 一个没有android依赖的java模块<br>data: 一个数据获取来源的android模块。<br>data-test: 数据层测试，由于使用Robolectric 存在一些限制，所以我得再独立的java模块中使用。</p>
<h5 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h5><p>正如 Bob大叔 所说：“Architecture is About Intent, not Frameworks” ，我非常同意这个说法，当然了，有很多不同的方法做不同的事情（不同的实现方法），我很确定，你每天（像我一样）会面临很多挑战，但是遵循这些方法，可以确保你的应用会：</p>
<p>易维护<br>易测试<br>高内聚<br>低耦合</p>
<h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><p>Source code: android10&#x2F;Android-CleanArchitecture · GitHub<br>The clean architecture by Uncle Bob<br>Architecture is about Intent, not Frameworks<br>Model View Presenter<br>Repository Pattern by Martin Fowler<br>Android Design Patterns Presentation</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/04/Android-进阶之设计模式-转-Android-CleanArchitecture/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/04/Android-进阶之设计模式-转-Android-CleanArchitecture/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/02/Android-进阶之设计模式-三-MVVM模式-DataBinding2/" title="Android 进阶之设计模式 三 MVVM模式- DataBinding[二]" itemprop="url">Android 进阶之设计模式 三 MVVM模式- DataBinding[二]</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-02T14:07:58.000Z" itemprop="datePublished"> Published 2016-05-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在上一篇博文中我们给出了一个例子，在layout中添加data 节点，并在里面用variable标签声明一个变量，然后在java文件中声明一个对应的变量，将其绑定到layout中。<br>那接下来的部分我们就继续了解下，可以绑定哪些类型：</p>
<h5 id="在绑定某个类型之前需要将当前类型导入到layout布局中，要实现这个目标必须依赖于import标签："><a href="#在绑定某个类型之前需要将当前类型导入到layout布局中，要实现这个目标必须依赖于import标签：" class="headerlink" title="在绑定某个类型之前需要将当前类型导入到layout布局中，要实现这个目标必须依赖于import标签："></a>在绑定某个类型之前需要将当前类型导入到layout布局中，要实现这个目标必须依赖于import标签：</h5><ul>
<li>使用Import在布局中导包</li>
</ul>
<p>使用DataBinding在布局中可以导入类：<br>基本的格式如下：</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">data</span>&gt;</span></span><br><span class="line">    &lt;<span class="keyword">import</span> type=&quot;android.os.Bundle&quot;/&gt;</span><br><span class="line">&lt;/<span class="class"><span class="keyword">data</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这就和Java中导包一样，没特殊的地方：<br>在类名有冲突的时候，还可以使用别名来区别二者，具体的别名使用方法如下：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">import</span> <span class="keyword">type</span>=&quot;android.os.Bundle&quot;/&gt;</span><br><span class="line">&lt;<span class="keyword">import</span> <span class="keyword">type</span>=&quot;com.idealist.testDatabing.Bundle&quot;</span><br><span class="line">        <span class="keyword">alias</span>=&quot;selfBundle&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>基本上包括自定义类型在内的全部类型都可以在layout中声明：</p>
<p>导入的类型还可以在表达式中使用static属性和方法：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">   android:<span class="attribute">text</span>=<span class="string">&quot;@&#123;MyUtils.log(user.lastName)&#125;&quot;</span></span><br><span class="line">   android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">   android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>像JAVA一样，java.lang.*是自动导入的。</p>
<h5 id="导入包后就可以使用这些包声明对应的变量，变量声明方式如下："><a href="#导入包后就可以使用这些包声明对应的变量，变量声明方式如下：" class="headerlink" title="导入包后就可以使用这些包声明对应的变量，变量声明方式如下："></a>导入包后就可以使用这些包声明对应的变量，变量声明方式如下：</h5><ul>
<li>Variables 变量<br>这个就和变量定义一个样，type指定变量类型，name 指定变量名，对于bean类型必须有get&#x2F;set方法</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;variable <span class="attribute">name</span>=<span class="string">&quot;name&quot;</span>  <span class="attribute">type</span>=<span class="string">&quot;String&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当属性名需要用到单引号的时候外面引号需要用双引号，反之，当内部用单引号的时候外部需要用双引号，这个很多语言都有这个用法。</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">android:</span><span class="keyword">text</span>=<span class="comment">&#x27;@&#123;map[&quot;firstName&quot;]&#125;&#x27;</span></span><br><span class="line"><span class="symbol">android:</span><span class="keyword">text</span>=<span class="string">&quot;@&#123;map[`firstName`]&#125;&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在变量中还可以用到对应的资源</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">android:padding=<span class="string">&quot;<span class="subst">@&#123;large? @dimen/largePadding : @dimen/smallPadding&#125;</span>&quot;</span></span><br><span class="line">android:text=<span class="string">&quot;<span class="subst">@&#123;@plurals/banana(bananaCount)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>集合的用法：<br> 集合泛型要特别注意左尖括号需要使用转译：</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">&lt;<span class="built_in">data</span> class=<span class="string">&quot;CollectionsBinding&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> <span class="keyword">type</span>=<span class="string">&quot;java.util.Map&quot;</span> /&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> <span class="keyword">type</span>=<span class="string">&quot;java.util.List&quot;</span> /&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> <span class="keyword">type</span>=<span class="string">&quot;android.util.SparseArray&quot;</span> /&gt;</span><br><span class="line">    &lt;<span class="built_in">variable</span> name=<span class="string">&quot;list&quot;</span> <span class="keyword">type</span>=<span class="string">&quot;List&amp;lt;String&gt;&quot;</span> /&gt;</span><br><span class="line">    &lt;<span class="built_in">variable</span> name=<span class="string">&quot;sparse&quot;</span> <span class="keyword">type</span>=<span class="string">&quot;SparseArray&amp;lt;String&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="built_in">variable</span> name=<span class="string">&quot;map&quot;</span> <span class="keyword">type</span>=<span class="string">&quot;Map&amp;lt;String, String&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="built_in">variable</span> name=<span class="string">&quot;index&quot;</span> <span class="keyword">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span><br><span class="line">    &lt;<span class="built_in">variable</span> name=<span class="string">&quot;key&quot;</span> <span class="keyword">type</span>=<span class="string">&quot;String&quot;</span> /&gt;</span><br><span class="line">&lt;/<span class="built_in">data</span>&gt;</span><br></pre></td></tr></table></figure>
<p>List 用法：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:<span class="attribute">text</span>=<span class="string">&quot;@&#123;list[index]&#125;&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>SparseArray 用法：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:<span class="attribute">text</span>=<span class="string">&quot;@&#123;sparse[index]&#125;&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>Map 用法：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:<span class="attribute">text</span>=<span class="string">&quot;@&#123;map[key]&#125;&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br><span class="line">&lt;TextView</span><br><span class="line">         android:<span class="attribute">text</span>=<span class="string">&#x27;@&#123;map[&quot;firstName&quot;]&#125;&#x27;</span></span><br><span class="line">         android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">         android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br><span class="line">&lt;TextView</span><br><span class="line">    android:<span class="attribute">text</span>=<span class="string">&quot;@&#123;map[`firstName`]&#125;&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Include 用法：<br>注意下面的例子中在name.xml以及contact.xml两个layout文件中必需要有user variable</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:bind</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.User&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">&quot;@layout/name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">           <span class="attr">bind:user</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">&quot;@layout/contact&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">           <span class="attr">bind:user</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>除了上述的用法，目前还支持设置默认值给某个属性</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="title">android:</span>text=<span class="string">&quot;@&#123;String.valueOf(user.age),default=`defaultValue`&#125;&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="除了直接使用变量外还可以使用通过运算符进行运算后的值"><a href="#除了直接使用变量外还可以使用通过运算符进行运算后的值" class="headerlink" title="除了直接使用变量外还可以使用通过运算符进行运算后的值"></a>除了直接使用变量外还可以使用通过运算符进行运算后的值</h5><ul>
<li>支持的运算符：<blockquote>
<p>算术运算符 + - &#x2F; * %<br>逻辑运算符 &amp;&amp; ||<br>二进制运算符 &amp; | ^<br>字符串连接 +<br>一元运算 + - ! ~<br>移位运算 &gt;&gt; &gt;&gt;&gt; &lt;&lt;<br>比较运算 &#x3D;&#x3D; &gt; &lt; &gt;&#x3D; &lt;&#x3D;<br>instanceof<br>null<br>强制转换<br>方法调用<br>数据访问 []<br>三元运算 ?:<br>除了上述基本的运算外下面还有一些特殊的操作符:</p>
</blockquote>
</li>
</ul>
<p>?? - 左边的对象如果它不是null，选择左边的对象；或者如果它是null，选择右边的对象：</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">android:</span><span class="keyword">text</span>=<span class="string">&quot;@&#123;user.displayName ?? user.lastName&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="自定义-Binding-类名称"><a href="#自定义-Binding-类名称" class="headerlink" title="* 自定义 Binding 类名称"></a>* 自定义 Binding 类名称</h4><p>在上一篇博文中介绍到会自动生成ActivityMainBinding ，这个其实是根据布局来创建的，我们上个例子中布局文件名为activity_main，将当中的下划线去掉然后下划线分割的两端首字母大写，在最后加上Binding<br>就构成了ActivityMainBinding。但是我们还可以自己指定一个类名：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span>=<span class="string">&quot;com.idealist.customName&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span>=<span class="string">&quot;CustomBinding&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">data</span>&gt;</span>在apppackage/databinding下生成CustomBinding；</span><br><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span>=<span class="string">&quot;.CustomBinding&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">data</span>&gt;</span>在apppackage下生成CustomBinding；</span><br><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span>=<span class="string">&quot;com.example.CustomBinding&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">data</span>&gt;</span>` 明确指定包名和类名。</span><br></pre></td></tr></table></figure>

<h4 id="实时反馈数据的变化"><a href="#实时反馈数据的变化" class="headerlink" title="* 实时反馈数据的变化"></a>* 实时反馈数据的变化</h4><p>我们上面介绍的可以将数据和layout上的数据进行绑定，但是当绑定数据变化后并不能立刻反映到View杀害能够。Data Binding的真正强大的地方是当数据变化时，可以通知对应的Data对象。<br>有三种不同的数据变化通知机制：Observable对象、ObservableFields以及observable Collections。下面就来介绍下这个用法：</p>
<h5 id="继承BaseObservable的方式"><a href="#继承BaseObservable的方式" class="headerlink" title="继承BaseObservable的方式"></a>继承BaseObservable的方式</h5><p>实现android.databinding.Observable接口的类可以为绑定对象添加一个监听器用于监听所有你想监听的对象的变化。<br>要实现上述的绑定可以分成两步：<br>1 继承BaseObservable的基类来创建Observable对象。<br>2 为getter添加Bindable注释。</p>
<p>下面是一个例子：<br>这个和上一篇博文介绍的一样就不多解释了：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span> = <span class="string">&quot;CustomBindingName&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.idealist.databindingdemo.bean.UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">tools:context</span>=<span class="string">&quot;com.idealist.databindingdemo.MainActivity&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.firstName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.lastName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to IOS&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:onClick</span>=<span class="string">&quot;onChangeName1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to Android&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:onClick</span>=<span class="string">&quot;onChangeName2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这里的Userbean 继承自BaseObservable并且在对应的get方法上添加了@Bindable注释。并在set方法中添加notifyPropertyChanged(BR.lastName);来通知变化</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBean</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseObservable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getFirstName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setFirstName</span>(<span class="params"><span class="built_in">String</span> firstName</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">        <span class="title function_">notifyPropertyChanged</span>(<span class="variable constant_">BR</span>.<span class="property">firstName</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getLastName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setLastName</span>(<span class="params"><span class="built_in">String</span> lastName</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastName</span> = lastName;</span><br><span class="line">        <span class="title function_">notifyPropertyChanged</span>(<span class="variable constant_">BR</span>.<span class="property">lastName</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> firstName;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> lastName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">UserBean</span>(<span class="title class_">String</span> firstName, <span class="title class_">String</span> lastName) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastName</span> = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着就可以在MainActivity中调用set方法来设置对应的值，一旦bean的值一改变对应TextView 上的文本就立刻改变。<br>需要注意的是上面的BR是编译阶段生成的一个类，用 @Bindable 标记过 getter 方法会在 BR 中生成一个 entry。<br>当数据发生变化时还是需要手动发出通知。 通过调用 notifyPropertyChanged(BR.firstName) 可以通知系统 BR.firstName 这个 entry 的数据已经发生变化，需要更新 UI。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserBean userBean = null;</span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">        CustomBindingName binding = <span class="module-access"><span class="module"><span class="identifier">DataBindingUtil</span>.</span></span>set<span class="constructor">ContentView(<span class="params">this</span>, R.<span class="params">layout</span>.<span class="params">activity_main</span>)</span>;</span><br><span class="line">        userBean = <span class="keyword">new</span> <span class="constructor">UserBean(<span class="string">&quot;Android&quot;</span>, <span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">        binding.set<span class="constructor">User(<span class="params">userBean</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void on<span class="constructor">ChangeName1(View <span class="params">view</span>)</span> &#123;</span><br><span class="line">        userBean.set<span class="constructor">FirstName(<span class="string">&quot;IOS&quot;</span>)</span>;</span><br><span class="line">        userBean.set<span class="constructor">LastName(<span class="string">&quot;Jobs&quot;</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void on<span class="constructor">ChangeName2(View <span class="params">view</span>)</span> &#123;</span><br><span class="line">        userBean.set<span class="constructor">FirstName(<span class="string">&quot;Android&quot;</span>)</span>;</span><br><span class="line">        userBean.set<span class="constructor">LastName(<span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：<br><img src="/2016/05/02/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%89-MVVM%E6%A8%A1%E5%BC%8F-DataBinding2/3.png"></p>
<h5 id="ObservableFiled"><a href="#ObservableFiled" class="headerlink" title="ObservableFiled"></a>ObservableFiled</h5><p>这种方法也可以实现Observable 对象的效果，它的好处是不用在set方法中添加notifyXXXXX<br>首先我们在原来例子的基础上添加了一个用于显示年龄的TextView</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span> = <span class="string">&quot;CustomBindingName&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.idealist.databindingdemo.bean.UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">tools:context</span>=<span class="string">&quot;com.idealist.databindingdemo.MainActivity&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.firstName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.lastName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;String.valueOf(user.age)&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to IOS&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:onClick</span>=<span class="string">&quot;onChangeName1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to Android&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:onClick</span>=<span class="string">&quot;onChangeName2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>在原来的Bean中添加如下代码：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title class_">ObservableInt</span> age = <span class="keyword">new</span> <span class="title class_">ObservableInt</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ObservableInt</span> <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setAge</span>(<span class="params">ObservableInt age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了ObservableInt，还提供了如下的类型，基本上所有的基本类型都提供了：</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ObservableInt age = <span class="keyword">new</span> <span class="type">ObservableInt</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableBoolean age1 = <span class="keyword">new</span> <span class="type">ObservableBoolean</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableChar age2 = <span class="keyword">new</span> <span class="type">ObservableChar</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableByte age3 = <span class="keyword">new</span> <span class="type">ObservableByte</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableDouble age4 = <span class="keyword">new</span> <span class="type">ObservableDouble</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableFloat age5 = <span class="keyword">new</span> <span class="type">ObservableFloat</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableLong age6 = <span class="keyword">new</span> <span class="type">ObservableLong</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableShort age7 = <span class="keyword">new</span> <span class="type">ObservableShort</span>();</span><br><span class="line"><span class="keyword">public</span> ObservableField&lt;<span class="keyword">String</span>&gt; age8 = <span class="keyword">new</span> <span class="type">ObservableField</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>接下来就是通过如下的设置bean值，一旦bean值被设置，就会立刻反应到View上：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserBean userBean = null;</span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">        CustomBindingName binding = <span class="module-access"><span class="module"><span class="identifier">DataBindingUtil</span>.</span></span>set<span class="constructor">ContentView(<span class="params">this</span>, R.<span class="params">layout</span>.<span class="params">activity_main</span>)</span>;</span><br><span class="line">        userBean = <span class="keyword">new</span> <span class="constructor">UserBean(<span class="string">&quot;Android&quot;</span>, <span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">        binding.set<span class="constructor">User(<span class="params">userBean</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void on<span class="constructor">ChangeName1(View <span class="params">view</span>)</span> &#123;</span><br><span class="line">        userBean.set<span class="constructor">FirstName(<span class="string">&quot;IOS&quot;</span>)</span>;</span><br><span class="line">        userBean.set<span class="constructor">LastName(<span class="string">&quot;Jobs&quot;</span>)</span>;</span><br><span class="line">        userBean.get<span class="constructor">Age()</span>.set(<span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void on<span class="constructor">ChangeName2(View <span class="params">view</span>)</span> &#123;</span><br><span class="line">        userBean.set<span class="constructor">FirstName(<span class="string">&quot;Android&quot;</span>)</span>;</span><br><span class="line">        userBean.set<span class="constructor">LastName(<span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">        userBean.get<span class="constructor">Age()</span>.set(<span class="number">26</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了上述的基本类型ObServerable 还支持List Map等集合类型：</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">ObservableArrayMap<span class="variable">&lt;String, Object&gt;</span> <span class="keyword">user</span> = new ObservableArrayMap<span class="variable">&lt;&gt;</span>();</span><br><span class="line"><span class="keyword">user</span>.put(<span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;Google&quot;</span>);</span><br><span class="line"><span class="keyword">user</span>.put(<span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;Inc.&quot;</span>);</span><br><span class="line"><span class="keyword">user</span>.put(<span class="string">&quot;age&quot;</span>, <span class="number">17</span>);</span><br></pre></td></tr></table></figure>
<p>在layout文件中，通过String键可以访问map：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;android.databinding.ObservableMap&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;ObservableMap&lt;String, Object&gt;&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">…</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:text</span>=<span class="string">&#x27;@</span></span></span><span class="template-variable">&#123;user[&quot;lastName&quot;]&#125;</span><span class="language-xml"><span class="tag"><span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:text</span>=<span class="string">&#x27;@</span></span></span><span class="template-variable">&#123;String.valueOf(1 + (Integer)user[&quot;age&quot;])&#125;</span><span class="language-xml"><span class="tag"><span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>ObservableArrayList用于键是整数：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">ObservableArrayList&lt;<span class="keyword">Object</span>&gt; <span class="keyword">user</span> = <span class="built_in">new</span> ObservableArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">user</span>.<span class="keyword">add</span>(&quot;Google&quot;);</span><br><span class="line"><span class="keyword">user</span>.<span class="keyword">add</span>(&quot;Inc.&quot;);</span><br><span class="line"><span class="keyword">user</span>.<span class="keyword">add</span>(<span class="number">17</span>);</span><br></pre></td></tr></table></figure>
<p>在layout文件中，通过索引可以访问list：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;android.databinding.ObservableList&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.example.my.app.Fields&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;ObservableList&lt;Object&gt;&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">…</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:text</span>=<span class="string">&#x27;@</span></span></span><span class="template-variable">&#123;user[Fields.LAST_NAME]&#125;</span><span class="language-xml"><span class="tag"><span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:text</span>=<span class="string">&#x27;@</span></span></span><span class="template-variable">&#123;String.valueOf(1 + (Integer)user[Fields.AGE])&#125;</span><span class="language-xml"><span class="tag"><span class="string">&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">   <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="在DataBinding中使用View的id"><a href="#在DataBinding中使用View的id" class="headerlink" title="* 在DataBinding中使用View的id"></a>* 在DataBinding中使用View的id</h4><p>在Bind数据后，我们有时候会需要为某个按钮添加一个响应事件，这时候我们可以这样做：<br>如下布局中有两个按钮，id分别为changeName以及changeName1，我们下面将要为这两个按钮添加点击事件：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span> = <span class="string">&quot;CustomBindingName&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.idealist.databindingdemo.bean.UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">tools:context</span>=<span class="string">&quot;com.idealist.databindingdemo.MainActivity&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.firstName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.lastName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;String.valueOf(user.age)&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to IOS&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;Change Name to Android&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/changeName1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>下面就是为按钮添加事件的办法，很简单吧感觉比findviewById简单不少：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserBean userBean = null;</span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">        CustomBindingName binding = <span class="module-access"><span class="module"><span class="identifier">DataBindingUtil</span>.</span></span>set<span class="constructor">ContentView(<span class="params">this</span>, R.<span class="params">layout</span>.<span class="params">activity_main</span>)</span>;</span><br><span class="line">        userBean = <span class="keyword">new</span> <span class="constructor">UserBean(<span class="string">&quot;Android&quot;</span>, <span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">        binding.set<span class="constructor">User(<span class="params">userBean</span>)</span>;</span><br><span class="line">        binding.changeName.set<span class="constructor">OnClickListener(<span class="params">this</span>)</span>;</span><br><span class="line">        binding.changeName1.set<span class="constructor">OnClickListener(<span class="params">this</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Click(View <span class="params">v</span>)</span> &#123;</span><br><span class="line">        switch (v.get<span class="constructor">Id()</span>) &#123;</span><br><span class="line">            case <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.changeName:</span><br><span class="line">                userBean.set<span class="constructor">FirstName(<span class="string">&quot;IOS&quot;</span>)</span>;</span><br><span class="line">                userBean.set<span class="constructor">LastName(<span class="string">&quot;Jobs&quot;</span>)</span>;</span><br><span class="line">                userBean.get<span class="constructor">Age()</span>.set(<span class="number">23</span>);</span><br><span class="line">                break;</span><br><span class="line">            case <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.changeName1:</span><br><span class="line">                userBean.set<span class="constructor">FirstName(<span class="string">&quot;Android&quot;</span>)</span>;</span><br><span class="line">                userBean.set<span class="constructor">LastName(<span class="string">&quot;OS&quot;</span>)</span>;</span><br><span class="line">                userBean.get<span class="constructor">Age()</span>.set(<span class="number">26</span>);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Event-Binding-事件绑定"><a href="#Event-Binding-事件绑定" class="headerlink" title="Event Binding (事件绑定)"></a>Event Binding (事件绑定)</h5><p>下面例子是实现的是按钮的二值状态切换：</p>
<p>首先定义一个接口</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">public</span> interface UserPressEvent &#123;</span><br><span class="line">    <span class="type">void</span> press(<span class="keyword">View</span> <span class="keyword">view</span>);</span><br><span class="line">    <span class="type">void</span> unPress(<span class="keyword">View</span> <span class="keyword">view</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>布局中使用：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;variable</span><br><span class="line">     <span class="attribute">name</span>=<span class="string">&quot;event&quot;</span></span><br><span class="line">     <span class="attribute">type</span>=<span class="string">&quot;com.idealist.UserPressEvent&quot;</span>/&gt;</span><br><span class="line">     </span><br><span class="line">android:<span class="attribute">onClick</span>=<span class="string">&quot;@&#123;user.isPressed? event.unPress : event.press&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>在Activity实现该接口UserPressEvent：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> press(<span class="keyword">View</span> <span class="keyword">view</span>) &#123;</span><br><span class="line">    <span class="keyword">user</span>.isPressed(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> unPress(<span class="keyword">View</span> <span class="keyword">view</span>) &#123;</span><br><span class="line">    <span class="keyword">user</span>.isPressed(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="自定义转换"><a href="#自定义转换" class="headerlink" title="自定义转换"></a>自定义转换</h5><p>有时候转换应该是自动的在特定类型之间。例如，设置背景的时候：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;View</span><br><span class="line">   android:<span class="attribute">background</span>=<span class="string">&quot;@&#123;isError ? @color/red : @color/white&#125;&quot;</span></span><br><span class="line">   android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">   android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>这里，背景需要Drawable对象，但颜色是一个整数。不管何时有Drawable并且返回值是一个整数，那么整数类型会被转换为ColorDrawable。这个转换是通过使用带有BindingConversion注解的静态方法完成的1</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@BindingConversion</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">ColorDrawable <span class="title">convertColorToDrawable</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> ColorDrawable(color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><p>对于一个属性，Data Binding会试图找到对应的setAttribute方法。<br>比如下面的例子：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;com.idealist.databinding.view.GithubCard</span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;200dp&quot;</span></span><br><span class="line">    android:<span class="attribute">gravity</span>=<span class="string">&quot;center&quot;</span></span><br><span class="line">    app:<span class="attribute">age</span>=<span class="string">&quot;27&quot;</span></span><br><span class="line">    app:<span class="attribute">firstName</span>=<span class="string">&quot;@&#123;@string/firstName&#125;&quot;</span></span><br><span class="line">    app:<span class="attribute">lastName</span>=<span class="string">&quot;@&#123;@string/lastName&#125;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>这里并没有在declare-styleable 中定义 但是我们在自定义GithubCard中有age，firstName，lastName这些属性的setter方法所以可以直接使用上述的方式进行设置：</p>
<p>下面再来看个在网上找的一个例子，下面先列出代码然后展开分析：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.liangfeizc.databinding.sample.attributesetter.AttributeSettersActivity&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;activity&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;AttributeSettersActivity&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;imageUrl&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;String&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">com.liangfeizc.avatarview.AvatarView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">app:error</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;@drawable/error&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">app:imageUrl</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;imageUrl&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">app:onClickListener</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;activity.avatarClickListener&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> AttributeSettersActivity extends BaseActivity &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityAttributeSettersBinding mBinding;</span><br><span class="line"></span><br><span class="line">    public View.OnClickListener avatarClickListener = <span class="keyword">new</span> View.<span class="constructor">OnClickListener()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Click(View <span class="params">v</span>)</span> &#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Toast</span>.</span></span>make<span class="constructor">Text(AttributeSettersActivity.<span class="params">this</span>, <span class="string">&quot;Come on&quot;</span>, Toast.LENGTH_SHORT)</span>.show<span class="literal">()</span>;</span><br><span class="line">            mBinding.set<span class="constructor">ImageUrl(Randoms.<span class="params">nextImgUrl</span>()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line"></span><br><span class="line">        mBinding = <span class="module-access"><span class="module"><span class="identifier">DataBindingUtil</span>.</span></span>set<span class="constructor">ContentView(<span class="params">this</span>, R.<span class="params">layout</span>.<span class="params">activity_attribute_setters</span>)</span>;</span><br><span class="line">        mBinding.set<span class="constructor">Activity(<span class="params">this</span>)</span>;</span><br><span class="line">        mBinding.set<span class="constructor">ImageUrl(Randoms.<span class="params">nextImgUrl</span>()</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="constructor">BindingAdapter(&#123;<span class="string">&quot;bind:imageUrl&quot;</span>, <span class="string">&quot;bind:error&quot;</span>&#125;)</span></span><br><span class="line">    public static void load<span class="constructor">Image(ImageView <span class="params">view</span>, String <span class="params">url</span>, Drawable <span class="params">error</span>)</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(App.TAG, <span class="string">&quot;load image&quot;</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Picasso</span>.</span></span><span class="keyword">with</span>(view.get<span class="constructor">Context()</span>).load(url).error(error).into(view);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先在AttributeSettersActivity onCreate方法中建立DataBinding后会将Activity，和ImageUri传到布局上，<br>我们在AttributeSettersActivity中看到如下方法：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">@BindingAdapter(&#123;&quot;bind:imageUrl&quot;, &quot;bind:error&quot;&#125;)</span><br><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> loadImage(ImageView <span class="keyword">view</span>, String url, Drawable error) &#123;</span><br><span class="line">        <span class="keyword">Log</span>.d(App.TAG, &quot;load image&quot;);</span><br><span class="line">        Picasso.<span class="keyword">with</span>(<span class="keyword">view</span>.getContext()).<span class="keyword">load</span>(url).error(error).<span class="keyword">into</span>(<span class="keyword">view</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是用来干嘛的呢？它的意思是：<br>如果AvatarView中的 imageUrl和 error 参数都存在并且由于imageUrl是string类型error是drawable 类型则就会调用上面定义的绑定适配器，并将对应的参数传入。在匹配适配器的时候，会忽略自定义的命名空间。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/02/Android-进阶之设计模式-三-MVVM模式-DataBinding2/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/02/Android-进阶之设计模式-三-MVVM模式-DataBinding2/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/01/Android-进阶之设计模式-三-MVVM模式-DataBinding/" title="Android 进阶之设计模式 三 MVVM模式 DataBinding [一] 搭建开发环境" itemprop="url">Android 进阶之设计模式 三 MVVM模式 DataBinding [一] 搭建开发环境</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Edgar" target="_blank" itemprop="author">Edgar</a>
		
  <p class="article-time">
    <time datetime="2016-05-01T14:29:54.000Z" itemprop="datePublished"> Published 2016-05-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>今天要讲的是DataBinding，在Google 2015 IO大会上推出了DataBinding 这个新特性， 它是以一个support库的形式发布，所以可以在所有的Android平台上使用它。但是它对Android Studio 以及Gradle的版本有一定的要求。<br>Android Studio 至少是1.3.0-beta1 Gradle至少是1.3以上。这个对大家来说应该是没啥大问题吧，如果没有满足这两个条件，大家Google下就可以解决了。<br>刚开始我们先搭建一个很简单很简单的例子，让大家属性下环境的搭建：</p>
<ul>
<li><p>首先检查下gradle版本是否正确，在项目根目录下检查build.gradle,这是我的配置：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">&#x27;com.android.tools.build:gradle:2.1.0&#x27;</span></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> clean(type: <span class="keyword">Delete</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> rootProject.buildDir</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在模块的build.gradle 中 使用如下配置，打开DataBinding支持：</p>
<figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">dataBinding</span> &#123;</span><br><span class="line">    <span class="literal">enabled</span> <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是我的模块build.gradle</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">apply</span> plugin: <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="attribute">compileSdkVersion</span> <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">&quot;23.0.3&quot;</span></span><br><span class="line"></span><br><span class="line">    dataBinding &#123;</span><br><span class="line">        <span class="attribute">enabled</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        <span class="attribute">applicationId</span> <span class="string">&quot;com.idealist.databindingdemo&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">23</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        <span class="section">release</span> &#123;</span><br><span class="line">            <span class="attribute">minifyEnabled</span> <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="attribute">compile</span> fileTree(dir: <span class="string">&#x27;libs&#x27;</span>, include: [<span class="string">&#x27;*.jar&#x27;</span>])</span><br><span class="line">    testCompile <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.android.support:appcompat-v7:23.3.0&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到此为止已经完成了环境的配置。</p>
</li>
<li><p>修改布局文件：用一个layout节点将原先的布局给包裹住，layout中分成两类，一类是data，一类是布局：<br>重点是data的配置：<br>在data节点中variable是必备的属性，name是这个变量的名字，type一般是包含Bean所处包名的全路径。当然也包含import属性。<br>定义好data节点后就可以使用${} 对 bean进行访问了，比如这里的@{user.lastName}，这时候会调用UserBean的getlastName()方法，所以一般Bean都需要有get&#x2F;set方法</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.idealist.databindingdemo.bean.UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">variable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;UserBean&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">tools:context</span>=<span class="string">&quot;com.idealist.databindingdemo.MainActivity&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.firstName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TextView</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:text</span>=<span class="string">&quot;@</span></span></span><span class="template-variable">&#123;user.lastName&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>下面是Userbean的源码</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBean</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getFirstName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setFirstName</span>(<span class="params"><span class="built_in">String</span> firstName</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getLastName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setLastName</span>(<span class="params"><span class="built_in">String</span> lastName</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastName</span> = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> firstName;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> lastName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">UserBean</span>(<span class="title class_">String</span> firstName, <span class="title class_">String</span> lastName) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastName</span> = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>点击运行，这时候会产生一个ActivityMainBinding类位于&#x2F;DataBindingDemo&#x2F;app&#x2F;build&#x2F;intermediates&#x2F;classes&#x2F;debug&#x2F;com&#x2F;idealist&#x2F;databindingdemo&#x2F;databinding&#x2F;ActivityMainBinding.java<br>这个名字是根据布局生成的，这个类名可以指定的，后面会介绍这点。<br>接下来就可以使用这个Binding将数据绑定到布局上了，修改MainActivity如下所示：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> binding = <span class="type">DataBindingUtil</span>.setContentView(<span class="keyword">this</span>, <span class="type">R</span>.layout.activity_main);</span><br><span class="line">        <span class="type">UserBean</span> userBean = <span class="keyword">new</span> <span class="type">UserBean</span>(<span class="string">&quot;Android&quot;</span>, <span class="string">&quot;OS&quot;</span>);</span><br><span class="line">        binding.setUser(userBean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击运行，会看到如下的结果：<br><img src="/2016/05/01/Android-%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%89-MVVM%E6%A8%A1%E5%BC%8F-DataBinding/1.png"></p>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android-设计模式/">Android 设计模式</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/01/Android-进阶之设计模式-三-MVVM模式-DataBinding/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/01/Android-进阶之设计模式-三-MVVM模式-DataBinding/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/21/">&lt;span&gt;&lt;&#x2F;span&gt;Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/23/">Next&lt;span&gt;&lt;&#x2F;span&gt;</a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/tbfungeek" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:tbfungeek@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android-小经验/" title="Android 小经验">Android 小经验<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android-源码分析/" title="Android 源码分析">Android 源码分析<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android其他/" title="Android其他">Android其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android初步/" title="Android初步">Android初步<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android进阶/" title="Android进阶">Android进阶<sup>100</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript理论/" title="JavaScript理论">JavaScript理论<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
		  
		
		  
			<li><a href="/categories/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ROS/" title="ROS">ROS<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-工具使用/" title="iOS 工具使用">iOS 工具使用<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/个人收藏/" title="个人收藏">个人收藏<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/代码规范/" title="代码规范">代码规范<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/其他/" title="其他">其他<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/博客分类目录/" title="博客分类目录">博客分类目录<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/叨叨系列/" title="叨叨系列">叨叨系列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源代码分析/" title="开源代码分析">开源代码分析<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源库分析/" title="开源库分析">开源库分析<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/版本控制/" title="版本控制">版本控制<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/直播/" title="直播">直播<sup>6</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS-开源库分析/" title="iOS 开源库分析">iOS 开源库分析<sup>36</sup></a></li>
			
		
			
				<li><a href="/tags/Android-设计模式/" title="Android 设计模式">Android 设计模式<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/Objective-C-相关/" title="Objective C 相关">Objective C 相关<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/Android基础/" title="Android基础">Android基础<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/AOSP-源码/" title="AOSP 源码">AOSP 源码<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/Android-常用第三方库/" title="Android 常用第三方库">Android 常用第三方库<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-理论基础/" title="iOS 理论基础">iOS 理论基础<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo-使用/" title="Hexo 使用">Hexo 使用<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ROS/" title="ROS">ROS<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Android-动画进阶/" title="Android 动画进阶">Android 动画进阶<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Android-JNI/" title="Android JNI">Android JNI<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-绘图进阶/" title="Android 绘图进阶">Android 绘图进阶<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android性能优化/" title="Android性能优化">Android性能优化<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自动化测试/" title="Android 自动化测试">Android 自动化测试<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/OpenCV/" title="OpenCV">OpenCV<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/直播/" title="直播">直播<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Android-开源源码/" title="Android 开源源码">Android 开源源码<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android-自定义View进阶/" title="Android 自定义View进阶">Android 自定义View进阶<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/树莓派/" title="树莓派">树莓派<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-进阶/" title="iOS 进阶">iOS 进阶<sup>4</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://pages.github.com/" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="http://pf18.github.io/" target="_blank" title="PF18">PF18</a>
            
          </li>
        
          <li>
            
            	<a href="http://toutiao.io/" target="_blank" title="开发者头条">开发者头条</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.jcodecraeer.com/" target="_blank" title="泡在网上的日子">泡在网上的日子</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/AOSP-%E6%BA%90%E7%A0%81/" style="font-size: 17.14px;">AOSP 源码</a> <a href="/tags/Android-APK-%E7%AD%BE%E5%90%8D/" style="font-size: 10px;">Android APK 签名</a> <a href="/tags/Android-JNI/" style="font-size: 12.86px;">Android JNI</a> <a href="/tags/Android-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E8%BF%9B%E9%98%B6/" style="font-size: 10.71px;">Android 事件处理进阶</a> <a href="/tags/Android-%E5%8A%A8%E7%94%BB%E8%BF%9B%E9%98%B6/" style="font-size: 13.57px;">Android 动画进阶</a> <a href="/tags/Android-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91/" style="font-size: 10px;">Android 多线程开发</a> <a href="/tags/Android-%E5%B0%8F%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">Android 小经验</a> <a href="/tags/Android-%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" style="font-size: 16.43px;">Android 常用第三方库</a> <a href="/tags/Android-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android 开发流程</a> <a href="/tags/Android-%E5%BC%80%E6%BA%90%E6%BA%90%E7%A0%81/" style="font-size: 12.14px;">Android 开源源码</a> <a href="/tags/Android-%E7%BB%98%E5%9B%BE%E8%BF%9B%E9%98%B6/" style="font-size: 12.86px;">Android 绘图进阶</a> <a href="/tags/Android-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" style="font-size: 12.86px;">Android 自动化测试</a> <a href="/tags/Android-%E8%87%AA%E5%AE%9A%E4%B9%89View%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">Android 自定义View进阶</a> <a href="/tags/Android-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 19.29px;">Android 设计模式</a> <a href="/tags/Android%E5%85%B6%E4%BB%96/" style="font-size: 10px;">Android其他</a> <a href="/tags/Android%E5%9F%BA%E7%A1%80/" style="font-size: 17.86px;">Android基础</a> <a href="/tags/Android%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" style="font-size: 10px;">Android开发流程</a> <a href="/tags/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 12.86px;">Android性能优化</a> <a href="/tags/Android%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">Android混淆技术</a> <a href="/tags/Android%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" style="font-size: 11.43px;">Android质量管理工具</a> <a href="/tags/Android%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" style="font-size: 10px;">Android逆向工程</a> <a href="/tags/Git-github/" style="font-size: 10px;">Git && github</a> <a href="/tags/Hexo-%E4%BD%BF%E7%94%A8/" style="font-size: 15px;">Hexo 使用</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Linux-%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">Linux 使用</a> <a href="/tags/Objective-C-%E7%9B%B8%E5%85%B3/" style="font-size: 18.57px;">Objective C 相关</a> <a href="/tags/OpenCV/" style="font-size: 12.86px;">OpenCV</a> <a href="/tags/ROS/" style="font-size: 14.29px;">ROS</a> <a href="/tags/iOS-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 10.71px;">iOS 工具使用</a> <a href="/tags/iOS-%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 20px;">iOS 开源库分析</a> <a href="/tags/iOS-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/" style="font-size: 15.71px;">iOS 理论基础</a> <a href="/tags/iOS-%E8%BF%9B%E9%98%B6/" style="font-size: 12.14px;">iOS 进阶</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 10px;">代码规范</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E7%9B%AE%E5%BD%95/" style="font-size: 10.71px;">博客分类目录</a> <a href="/tags/%E5%8F%A8%E5%8F%A8%E7%B3%BB%E5%88%97/" style="font-size: 10px;">叨叨系列</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" style="font-size: 11.43px;">工具的使用</a> <a href="/tags/%E5%BC%80%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 10.71px;">开源代码分析</a> <a href="/tags/%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%86%E6%9E%90/" style="font-size: 10px;">开源库分析</a> <a href="/tags/%E6%9D%82%E7%B1%BB/" style="font-size: 10px;">杂类</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 12.14px;">树莓派</a> <a href="/tags/%E7%9B%B4%E6%92%AD/" style="font-size: 12.86px;">直播</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" style="font-size: 10.71px;">编程技巧</a> <a href="/tags/%E7%BD%91%E7%AB%99%E6%94%B6%E8%97%8F/" style="font-size: 10px;">网站收藏</a> <a href="/tags/%E9%87%8D%E8%A6%81%E6%8E%A7%E4%BB%B6/" style="font-size: 11.43px;">重要控件</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2022 
		
		<a href="/about" target="_blank" title="Edgar">Edgar</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7c9443b0374f1cf6b1dbb5ab84d939cb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
